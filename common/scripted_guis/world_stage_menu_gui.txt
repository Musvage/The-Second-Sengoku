scripted_gui = {

	# indexes of World Stage actions
	@action_none = 0
	@action_reinforce = 1
	@action_equipment = 2
	@action_offensive = 3
	@action_defenses = 4
	@action_retreat = 5
	# costs of World Stage actions	# reinforce/reatread will use some more dynamic variables, specific overall strength costs are not shown here
	@reinforce_cp = 10
	@reinforce_cooldown = 7
	@equipment_cp = 10
	@equipment_cooldown = 7
	@equipment_amount = 1000
	@reinforce_cooldown_near = 7
	@reinforce_cooldown_mid = 21
	@reinforce_cooldown_distant = 42
	@offensive_cp = 25
	@offensive_cooldown = 14
	@defenses_cp = 25
	@defenses_cooldown = 14
	@retreat_cp = 15
	@retreat_cooldown = 7

	##### POLITICS MENU INTERFACE #####
	
#	SS_worldstage_hidden_button = {
#		context_type = player_context
#		window_name = "SS_worldstage_hidden_button_container"
#		parent_window_token = top_bar
#		
#		visible = {
#			is_ai = no
#			OR = {
#				check_variable = { show_SS_trade = 1 }
#				check_variable = { show_SS_religion = 1 }
#				check_variable = { show_SS_unification = 1 }
#				check_variable = { show_SS_worldstage = 1 }
#			}
#		}
#		
#		effects = {
#			button_off_ui_click = {
#				set_variable = { show_SS_trade = 0 }
#				set_variable = { show_SS_religion = 0 }
#				set_variable = { show_SS_unification = 0 }
#				set_variable = { show_SS_worldstage = 0 }
#				set_variable = { current_theater = 0 }
#				clear_alternative_theater = yes	# this bit may be redundant but we'll run it here just for safety
#			}
#		}
#	}
		
	SS_worldstage_open = {
		context_type = player_context
		window_name = "SS_worldstage_open_container"
		parent_window_token = politics_tab

		visible = {
			is_ai = no
			OR = {
				NOT = { has_variable = show_SS_worldstage }
				NOT = { check_variable = { show_SS_worldstage = 1 } }
			}
		}

		triggers = {
			worldstage_open_button_click_enabled = {
				OR = {
					NOT = { has_variable = show_SS_worldstage }
					NOT = { check_variable = { show_SS_worldstage = 1 } }
				}
			}
		}

		effects = {
			worldstage_open_button_click = {
				set_variable = { show_SS_trade = 0 }
				set_variable = { show_SS_religion = 0 }
				set_variable = { show_SS_unification = 0 }
				set_variable = { show_SS_worldstage = 1 }
				set_variable = { current_theater = 0 }
				set_variable = { show_SS_switch_leader = 0 }
				if = {
					limit = {
						NOT = { has_country_flag = worldstage_menu_show_asia }
						NOT = { has_country_flag = worldstage_menu_show_europe }
						NOT = { has_country_flag = worldstage_menu_show_ledger }
					}
					set_country_flag = worldstage_menu_show_europe
				}
				world_stage_get_country_icon = yes
			}
		}
	}

	SS_worldstage_close = {
		context_type = player_context
		window_name = "SS_worldstage_close_container"
		parent_window_token = politics_tab

		visible = {
			is_ai = no
			NOT = { check_variable = { show_SS_worldstage = 0 } }
		}

		triggers = {
			worldstage_open_button_click_enabled = {
				NOT = { check_variable = { show_SS_worldstage = 0 } }
			}
		}

		effects = {
			worldstage_open_button_click = {
				set_variable = { show_SS_worldstage = 0 }
				set_variable = { current_theater = 0 }
				clear_alternative_theater = yes	# this bit may be redundant but we'll run it here just for safety
			}
		}

	}
	
	SS_worldstage_base = {
		context_type = player_context
		window_name = "SS_worldstage_container_base"
		parent_window_token = politics_tab
		#dirty = show_SS_worldstage

		visible = { check_variable = { show_SS_worldstage = 1 } }
		
		triggers = {
			worldstage_notification_on_button_visible = { NOT = { has_country_flag = hide_worldstage_notification } }
			worldstage_notification_off_button_visible = { has_country_flag = hide_worldstage_notification }
		}
		
		effects = {
			worldstage_notification_on_button_click = { set_country_flag = hide_worldstage_notification }
			worldstage_notification_off_button_click = { clr_country_flag = hide_worldstage_notification }
		}
	}

	SS_worldstage_europe = {
		context_type = player_context
		window_name = "SS_worldstage_container_europe"
		parent_window_token = politics_tab
		#dirty = show_SS_worldstage

		visible = {
			check_variable = { show_SS_worldstage = 1 }
			has_country_flag = worldstage_menu_show_europe
			NOT = { has_country_flag = worldstage_menu_show_ledger }
		}
		
		triggers = {
			map_background_europe_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
			map_detail_finland_visible = { has_global_flag = worldstage_menu_annex_baltic }
			map_detail_baltic_visible = { has_global_flag = worldstage_menu_annex_karelia }
			worldstage_header_europe_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
			worldstage_power_display_visible = {
				has_variable = world_stage_metropolis
				NOT = { check_variable = { world_stage_metropolis = 100 } }	# should be redundant, but just in case...
				NOT = { check_variable = { world_stage_metropolis = 111 } }	# internationally recognized Japan
			}
			worldstage_power_frame_icon_visible = {
				has_variable = world_stage_metropolis
				NOT = { check_variable = { world_stage_metropolis = 100 } }	# should be redundant, but just in case...
				NOT = { check_variable = { world_stage_metropolis = 111 } }	# internationally recognized Japan
			}
			map_faction_display_allies_visible = { NOT = { has_global_flag = league_of_nations_exists } }
			map_faction_display_komintern_visible = { OR = { has_global_flag = SOV_expelled_from_lon has_global_flag = world_stage_world_war_2_happened } }
			map_faction_display_komintern_disabled_visible = { NOT = { has_global_flag = SOV_expelled_from_lon has_global_flag = world_stage_world_war_2_happened } }
			map_faction_display_axis_visible = { NOT = { has_global_flag = league_of_nations_exists } }
			#map_faction_display_nonaligned_visible = { always = yes }
			map_faction_display_leagueofnations_visible = { has_global_flag = league_of_nations_exists }
			map_faction_display_pactofsteel_visible = { has_global_flag = league_of_nations_exists }
	#		theater_icon_england_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_france_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_germany_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_alsace_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_westphalia_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_netherlands_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_lybia_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_egypt_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_sicily_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_italy_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_alpes_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_austria_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_poland_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_belarus_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_smolensk_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
	#		theater_icon_russia_visible = { NOT = { has_country_flag = worldstage_menu_show_asia } }
			theater_icon_normandy_visible = {
				NOT = { has_country_flag = worldstage_menu_show_asia }
				has_global_flag = world_stage_theater_normandy_is_active
			}
			theater_icon_sealion_visible = {
				NOT = { has_country_flag = worldstage_menu_show_asia }
				has_global_flag = world_stage_theater_sealion_is_active
			}
			# active fronts
			active_front_england_visible = { 30 = { has_state_flag = theater_is_active } }
			active_front_france_visible = { 8 = { has_state_flag = theater_is_active } }
			active_front_germany_visible = { 7 = { has_state_flag = theater_is_active } }
			active_front_alsace_visible = { 5 = { has_state_flag = theater_is_active } }
			active_front_westphalia_visible = { 6 = { has_state_flag = theater_is_active } }
			active_front_netherlands_visible = { 27 = { has_state_flag = theater_is_active } }
			active_front_lybia_visible = { 14 = { has_state_flag = theater_is_active } }
			active_front_egypt_visible = { 15 = { has_state_flag = theater_is_active } }
			active_front_sicily_visible = { 24 = { has_state_flag = theater_is_active } }
			active_front_italy_visible = { 23 = { has_state_flag = theater_is_active } }
			active_front_alpes_visible = { 25 = { has_state_flag = theater_is_active } }
			active_front_austria_visible = { 26 = { has_state_flag = theater_is_active } }
			active_front_poland_visible = { 3 = { has_state_flag = theater_is_active } }
			active_front_belarus_visible = { 9 = { has_state_flag = theater_is_active } }
			active_front_smolensk_visible = { 10 = { has_state_flag = theater_is_active } }
			active_front_russia_visible = { 11 = { has_state_flag = theater_is_active } }
			active_front_portugal_visible = { 34 = { has_state_flag = theater_is_active } }
			active_front_madrid_visible = { 35 = { has_state_flag = theater_is_active } }
			active_front_zaragoza_visible = { 36 = { has_state_flag = theater_is_active } }
			active_front_barcelona_visible = { 37 = { has_state_flag = theater_is_active } }
			active_front_marseille_visible = { 38 = { has_state_flag = theater_is_active } }
			active_front_morocco_visible = { 39 = { has_state_flag = theater_is_active } }
			active_front_normandy_visible = { always = no } #= {  = { has_state_flag = theater_is_active } }
			active_front_sealion_visible = { always = no } #= {  = { has_state_flag = theater_is_active } }
		}
		
		properties = {			
			map_background_europe = { frame = var:global.worldstage_europe_map_frame }
			country_icon = { frame = var:world_stage_icon_country }
			faction_icon = { frame = var:world_stage_icon_coalition }
			theater_icon_england = { frame = var:30.theater_owner_coalition }
			theater_icon_france = { frame = var:8.theater_owner_coalition }
			theater_icon_germany = { frame = var:7.theater_owner_coalition }
			theater_icon_alsace = { frame = var:5.theater_owner_coalition }
			theater_icon_westphalia = { frame = var:6.theater_owner_coalition }
			theater_icon_netherlands = { frame = var:27.theater_owner_coalition }
			theater_icon_lybia = { frame = var:14.theater_owner_coalition }
			theater_icon_egypt = { frame = var:15.theater_owner_coalition }
			theater_icon_sicily = { frame = var:24.theater_owner_coalition }
			theater_icon_italy = { frame = var:23.theater_owner_coalition }
			theater_icon_alpes = { frame = var:25.theater_owner_coalition }
			theater_icon_austria = { frame = var:26.theater_owner_coalition }
			theater_icon_poland = { frame = var:3.theater_owner_coalition }
			theater_icon_belarus = { frame = var:9.theater_owner_coalition }
			theater_icon_smolensk = { frame = var:10.theater_owner_coalition }
			theater_icon_russia = { frame = var:11.theater_owner_coalition }
			theater_icon_portugal = { frame = var:34.theater_owner_coalition }
			theater_icon_madrid = { frame = var:35.theater_owner_coalition }
			theater_icon_zaragoza = { frame = var:36.theater_owner_coalition }
			theater_icon_barcelona = { frame = var:37.theater_owner_coalition }
			theater_icon_marseille = { frame = var:38.theater_owner_coalition }
			theater_icon_morocco = { frame = var:39.theater_owner_coalition }
			#theater_icon_normandy = { frame = var: }
			#theater_icon_sealion = { frame = var: }
		}
		
		effects = {
			theater_icon_poland_click = { if = { limit = { 3 = { can_open_theater = yes } } set_variable = { current_theater = 3 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_alsace_click = { if = { limit = { 5 = { can_open_theater = yes } } set_variable = { current_theater = 5 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_westphalia_click = { if = { limit = { 6 = { can_open_theater = yes } } set_variable = { current_theater = 6 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_germany_click = { if = { limit = { 7 = { can_open_theater = yes } } set_variable = { current_theater = 7 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_france_click = { if = { limit = { 8 = { can_open_theater = yes } } set_variable = { current_theater = 8 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_belarus_click = { if = { limit = { 9 = { can_open_theater = yes } } set_variable = { current_theater = 9 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_smolensk_click = { if = { limit = { 10 = { can_open_theater = yes } } set_variable = { current_theater = 10 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_russia_click = { if = { limit = { 11 = { can_open_theater = yes } } set_variable = { current_theater = 11 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_lybia_click = { if = { limit = { 14 = { can_open_theater = yes } } set_variable = { current_theater = 14 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_egypt_click = { if = { limit = { 15 = { can_open_theater = yes } } set_variable = { current_theater = 15 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_italy_click = { if = { limit = { 23 = { can_open_theater = yes } } set_variable = { current_theater = 23 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_sicily_click = { if = { limit = { 24 = { can_open_theater = yes } } set_variable = { current_theater = 24 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_alpes_click = { if = { limit = { 25 = { can_open_theater = yes } } set_variable = { current_theater = 25 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_austria_click = { if = { limit = { 26 = { can_open_theater = yes } } set_variable = { current_theater = 26 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_netherlands_click = { if = { limit = { 27 = { can_open_theater = yes } } set_variable = { current_theater = 27 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_england_click = { if = { limit = { 30 = { can_open_theater = yes } } set_variable = { current_theater = 30 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }	# add proxy-specific triggers for all, triggers should be more precise
			theater_icon_portugal_click = { if = { limit = { 34 = { can_open_theater = yes } } set_variable = { current_theater = 34 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }	# add proxy-specific triggers for all, triggers should be more precise
			theater_icon_madrid_click = { if = { limit = { 35 = { can_open_theater = yes } } set_variable = { current_theater = 35 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }	# add proxy-specific triggers for all, triggers should be more precise
			theater_icon_zaragoza_click = { if = { limit = { 36 = { can_open_theater = yes } } set_variable = { current_theater = 36 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }	# add proxy-specific triggers for all, triggers should be more precise
			theater_icon_barcelona_click = { if = { limit = { 37 = { can_open_theater = yes } } set_variable = { current_theater = 37 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }	# add proxy-specific triggers for all, triggers should be more precise
			theater_icon_marseille_click = { if = { limit = { 38 = { can_open_theater = yes } } set_variable = { current_theater = 38 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }	# add proxy-specific triggers for all, triggers should be more precise
			theater_icon_morocco_click = { if = { limit = { 39 = { can_open_theater = yes } } set_variable = { current_theater = 39 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }	# add proxy-specific triggers for all, triggers should be more precise
			switch_asia_button_click = {
				if = {
					limit = { has_country_flag = worldstage_menu_show_europe }
					clr_country_flag = worldstage_menu_show_europe
				}
				if = {
					limit = { has_country_flag = worldstage_menu_show_ledger }
					clr_country_flag = worldstage_menu_show_ledger
				}
				set_country_flag = worldstage_menu_show_asia
			}
		}
	}
	
	SS_worldstage_asia = {
		context_type = player_context
		window_name = "SS_worldstage_container_asia"
		parent_window_token = politics_tab
		#dirty = show_SS_worldstage

		visible = {
			check_variable = { show_SS_worldstage = 1 }
			has_country_flag = worldstage_menu_show_asia
			NOT = { has_country_flag = worldstage_menu_show_ledger }
		}
		
		triggers = {
			map_background_asia_visible = { has_country_flag = worldstage_menu_show_asia }
			worldstage_header_asia_visible = { has_country_flag = worldstage_menu_show_asia }
			worldstage_power_display_visible = {
				has_variable = world_stage_metropolis
				NOT = { check_variable = { world_stage_metropolis = 100 } }	# should be redundant, but just in case...
				NOT = { check_variable = { world_stage_metropolis = 111 } }	# internationally recognized Japan
			}
			worldstage_power_frame_icon_visible = {
				has_variable = world_stage_metropolis
				NOT = { check_variable = { world_stage_metropolis = 100 } }	# should be redundant, but just in case...
				NOT = { check_variable = { world_stage_metropolis = 111 } }	# internationally recognized Japan
			}
			map_faction_display_allies_visible = { NOT = { has_global_flag = league_of_nations_exists } }
			map_faction_display_komintern_visible = { OR = { has_global_flag = SOV_expelled_from_lon has_global_flag = world_stage_world_war_2_happened } }
			map_faction_display_komintern_disabled_visible = { NOT = { has_global_flag = SOV_expelled_from_lon has_global_flag = world_stage_world_war_2_happened } }
			map_faction_display_axis_visible = { NOT = { has_global_flag = league_of_nations_exists } }
			#map_faction_display_nonaligned_visible = { always = yes }
			map_faction_display_leagueofnations_visible = { has_global_flag = league_of_nations_exists }
			map_faction_display_pactofsteel_visible = { has_global_flag = league_of_nations_exists }
	#		theater_icon_urals_visible = { has_country_flag = worldstage_menu_show_asia }
	#		theater_icon_siberia_visible = { has_country_flag = worldstage_menu_show_asia }
	#		theater_icon_mongolia_visible = { has_country_flag = worldstage_menu_show_asia }
	#		theater_icon_tibet_visible = { has_country_flag = worldstage_menu_show_asia }
	#		theater_icon_guanxi_visible = { has_country_flag = worldstage_menu_show_asia }
	#		theater_icon_china_visible = { has_country_flag = worldstage_menu_show_asia }
	#		theater_icon_bengal_visible = { has_country_flag = worldstage_menu_show_asia }
	#		theater_icon_india_visible = { has_country_flag = worldstage_menu_show_asia }
	#		theater_icon_indies_visible = { has_country_flag = worldstage_menu_show_asia }
	#		theater_icon_philipines_visible = { has_country_flag = worldstage_menu_show_asia }
			# active front
			active_front_urals_visible = { 29 = { has_state_flag = theater_is_active } }
			active_front_siberia_visible = { 22 = { has_state_flag = theater_is_active } }
			active_front_mongolia_visible = { 2 = { has_state_flag = theater_is_active } }
			active_front_tibet_visible = { 18 = { has_state_flag = theater_is_active } }
			active_front_guanxi_visible = { 28 = { has_state_flag = theater_is_active } }
			active_front_china_visible = { 19 = { has_state_flag = theater_is_active } }
			active_front_bengal_visible = { 17 = { has_state_flag = theater_is_active } }
			active_front_india_visible = { 16 = { has_state_flag = theater_is_active } }
			active_front_indies_visible = { 20 = { has_state_flag = theater_is_active } }
			active_front_philipines_visible = { 21 = { has_state_flag = theater_is_active } }
			active_front_taiwan_visible = { 33 = { has_state_flag = theater_is_active } }
		}
		
		effects = {
			theater_icon_mongolia_click = { if = { limit = { 2 = { can_open_theater = yes } } set_variable = { current_theater = 2 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_india_click = { if = { limit = { 16 = { can_open_theater = yes } } set_variable = { current_theater = 16 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_bengal_click = { if = { limit = { 17 = { can_open_theater = yes } } set_variable = { current_theater = 17 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_tibet_click = { if = { limit = { 18 = { can_open_theater = yes } } set_variable = { current_theater = 18 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_china_click = { if = { limit = { 19 = { can_open_theater = yes } } set_variable = { current_theater = 19 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_indies_click = { if = { limit = { 20 = { can_open_theater = yes } } set_variable = { current_theater = 20 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_philipines_click = { if = { limit = { 21 = { can_open_theater = yes } } set_variable = { current_theater = 21 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_siberia_click = { if = { limit = { 22 = { can_open_theater = yes } } set_variable = { current_theater = 22 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_guanxi_click = { if = { limit = { 28 = { can_open_theater = yes } } set_variable = { current_theater = 28 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_urals_click = { if = { limit = { 29 = { can_open_theater = yes } } set_variable = { current_theater = 29 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			theater_icon_taiwan_click = { if = { limit = { 33 = { can_open_theater = yes } } set_variable = { current_theater = 33 } get_number_of_connected_theaters = yes get_current_theater_info = yes } }
			switch_europe_button_click = {
				if = {
					limit = { has_country_flag = worldstage_menu_show_asia }
					clr_country_flag = worldstage_menu_show_asia
				}
				if = {
					limit = { has_country_flag = worldstage_menu_show_ledger }
					clr_country_flag = worldstage_menu_show_ledger
				}
				set_country_flag = worldstage_menu_show_europe
			}
		}
		
		properties = {
			map_background_asian = { frame = var:global.worldstage_asia_map_frame }
			country_icon = { frame = var:world_stage_icon_country }
			faction_icon = { frame = var:world_stage_icon_coalition }
			theater_icon_urals = { frame = var:29.theater_owner_coalition }
			theater_icon_siberia = { frame = var:22.theater_owner_coalition }
			theater_icon_mongolia = { frame = var:2.theater_owner_coalition }
			theater_icon_tibet = { frame = var:18.theater_owner_coalition }
			theater_icon_guanxi = { frame = var:28.theater_owner_coalition }
			theater_icon_china = { frame = var:19.theater_owner_coalition }
			theater_icon_bengal = { frame = var:17.theater_owner_coalition }
			theater_icon_india = { frame = var:16.theater_owner_coalition }
			theater_icon_indies = { frame = var:20.theater_owner_coalition }
			theater_icon_philipines = { frame = var:21.theater_owner_coalition }
			theater_icon_taiwan = { frame = var:33.theater_owner_coalition }
		}
	}
	
	SS_worldstage_theater = {
		context_type = player_context
		window_name = "SS_worldstage_container_theater"
		parent_window_token = politics_tab
		#dirty = show_SS_worldstage
		
		visible = { NOT = { check_variable = { current_theater = 0 } has_country_flag = view_alternative_theater_display } }
		
		properties = {
			world_stage_theater_map = {
				image = "[THIS.WorldStageGetMapGfx]"
			}
			world_stage_theater_background = {
				image = "[THIS.WorldStageGetMapBackgroundGfx]"
			}
			world_stage_defender_symbol = { frame = var:defender_symbol }
			world_stage_attacker_symbol = { frame = var:attacker_symbol }
			world_stage_clock_counter = { frame = var:clock_frame }
			#world_stage_clock_counter = { frame = "[THIS.Get_clock_frame]" }
		}
		
		triggers = {
			worldstage_go_to_connection_1_visible = { always = yes }
			worldstage_go_to_connection_2_visible = { if = { check_variable = { number_of_connections_displayed > 1 } } }
			worldstage_go_to_connection_3_visible = { if = { check_variable = { number_of_connections_displayed > 2 } } }			
			worldstage_go_to_connection_4_visible = { if = { check_variable = { number_of_connections_displayed > 3 } } }
			worldstage_go_to_connection_1_click_enabled = { var:current_theater:connects_to^0 = { can_open_theater = yes  } }
			worldstage_go_to_connection_2_click_enabled = { var:current_theater:connects_to^1 = { can_open_theater = yes  } }
			worldstage_go_to_connection_3_click_enabled = { var:current_theater:connects_to^2 = { can_open_theater = yes  } }
			worldstage_go_to_connection_4_click_enabled = { var:current_theater:connects_to^3 = { can_open_theater = yes  } }
			world_stage_go_to_background_12_visible = {if = { check_variable = { number_of_connections_displayed > 1 } } }
			world_stage_go_to_background_23_visible = {if = { check_variable = { number_of_connections_displayed > 2 } } }
			world_stage_go_to_background_34_visible = {if = { check_variable = { number_of_connections_displayed > 3 } } }
			world_stage_naval_based_theater_visible = { var:current_theater = { has_state_flag = is_navy_theater } }
			world_stage_land_based_theater_visible = { NOT = { var:current_theater = { has_state_flag = is_navy_theater } } }
			world_stage_clock_base_visible = { var:current_theater = { has_state_flag = theater_is_active } }
			world_stage_clock_counter_visible = { var:current_theater = { has_state_flag = theater_is_active } }
			world_stage_clock_display_visible = { var:current_theater = { has_state_flag = theater_is_active } }
		#	world_stage_allies_header_visible = { OR = { has_world_stage_coalition_axis = no has_state_flag = theater_is_active } }
		#	world_stage_allies_visible = { OR = { has_world_stage_coalition_axis = no has_state_flag = theater_is_active } }
		#	world_stage_allies_power_display_visible = { OR = { has_world_stage_coalition_axis = no has_state_flag = theater_is_active } }
		#	world_stage_axis_header_visible = { OR = { has_world_stage_coalition_axis = yes has_state_flag = theater_is_active } }
		#	world_stage_axis_visible = { OR = { has_world_stage_coalition_axis = yes has_state_flag = theater_is_active } }
		#	world_stage_axis_power_display_visible = { OR = { has_world_stage_coalition_axis = yes has_state_flag = theater_is_active } }
			button_reinforce_click_enabled = {													# placeholder triggers, change later to add actual costs
				var:current_theater = { has_state_flag = theater_is_active }					# placeholder triggers, change later to add actual costs
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }	# placeholder triggers, change later to add actual costs
				command_power > 24.9
				check_variable = { var:world_stage_metropolis:world_stage_power > 0 }
				world_stage_has_permission_no_tooltip = yes
			}
			button_equipment_click_enabled = {
				var:current_theater = { has_state_flag = theater_is_active }
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }
				command_power > 24.9
				has_equipment = { infantry_equipment > 499 }
				has_equipment = { convoy > 4 }
				has_manpower > 4999
				OR = {
					check_variable = { current_theater = 16 }
					check_variable = { current_theater = 17 }
					check_variable = { current_theater = 18 }
					check_variable = { current_theater = 19 }
					check_variable = { current_theater = 20 }
					check_variable = { current_theater = 21 }
					check_variable = { current_theater = 22 }
					check_variable = { current_theater = 28 }
					check_variable = { current_theater = 33 }
				}
			}
			button_offensive_click_enabled = {
				var:current_theater = { has_state_flag = theater_is_active }
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }
				command_power > 24.9
				check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 1 }
				world_stage_has_permission_no_tooltip = yes
			}
			button_defenses_click_enabled = {
				var:current_theater = { has_state_flag = theater_is_active }
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }
				command_power > 24.9
				check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 1 }
				world_stage_has_permission_no_tooltip = yes
			}
			button_retreat_click_enabled = {
				var:current_theater = { has_state_flag = theater_is_active }
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }
				command_power > 24.9
				check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 1.1 }	# min = 2
				world_stage_has_permission_no_tooltip = yes
			}
			world_stage_attacker_header_visible = { var:current_theater = { has_state_flag = theater_is_active } }
			world_stage_attacker_symbol_visible = { var:current_theater = { has_state_flag = theater_is_active } }
			world_stage_attacker_power_display_visible = { var:current_theater = { has_state_flag = theater_is_active } }
		}
		
		effects = {
			button_close_theater_click = { set_variable = { current_theater = 0 } clear_alternative_theater = yes }
			worldstage_go_to_connection_1_click = {
				var:current_theater = { set_variable = { ROOT.current_theater = connects_to^0 } }
				switch_theater_displayed = yes
				get_current_theater_info = yes
			}
			worldstage_go_to_connection_2_click = {
				var:current_theater = { set_variable = { ROOT.current_theater = connects_to^1 } }
				switch_theater_displayed = yes
				get_current_theater_info = yes
			}
			worldstage_go_to_connection_3_click = {
				var:current_theater = { set_variable = { ROOT.current_theater = connects_to^2 } }
				switch_theater_displayed = yes
				get_current_theater_info = yes
			}
			worldstage_go_to_connection_4_click = {
				var:current_theater = { set_variable = { ROOT.current_theater = connects_to^3 } }
				switch_theater_displayed = yes
				get_current_theater_info = yes
			}
			button_reinforce_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = @reinforce_cooldown } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @action_reinforce } # type of action taken
					add_command_power = -25
					set_temp_variable = { reinforce_value = 1 }
					if = { limit = { check_variable = { var:world_stage_metropolis:world_stage_power > 10 } } add_to_temp_variable = { reinforce_value = 4 } }	# easier to add values step by step
					if = { limit = { check_variable = { var:world_stage_metropolis:world_stage_power > 50 } } add_to_temp_variable = { reinforce_value = 5 } }
					if = { limit = { check_variable = { var:world_stage_metropolis:world_stage_power > 100 } } add_to_temp_variable = { reinforce_value = 5 } }
					subtract_from_variable = { var:world_stage_metropolis:world_stage_power = reinforce_value }
					add_to_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis = reinforce_value }
					var:current_theater = { world_stage_state_update_current_day = yes }
					log = "debug: button_reinforce theater nº[?var:current_theater] by [?reinforce_value], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
			button_equipment_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = @equipment_cooldown } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @actionsupply } # type of action taken
					add_command_power = -25
					add_equipment_to_stockpile = { type = infantry_equipment amount = -500 }
					add_equipment_to_stockpile = {
						type = convoy_1
						amount = -5
					}
					add_manpower = -5000
					if = {
						limit = { check_variable = { world_stage_metropolis > 100 } }	# has a presence outside Japan
						add_to_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis = 5 }
						var:current_theater = { world_stage_state_update_current_day = yes }
					} else = {
						# this tag does not have a presence outside Japan: it will pick a suitable ally and reinforce it
						if = {
							limit = { check_variable = { PREV.world_stage_coalition = theater_owner_coalition } }	# it's a defender
							var:current_theater = {
								for_each_loop = {
									array = world_stage_power_deployed_by
									index = this_metropolis
									value = deployed_power
									break = end_loop
									if = {
										limit = { check_variable = { this_metropolis > 100 } }	# unspecified minors DO NOT count here
										if = {
											var:this_metropolis = {
												if = {
													limit = {
														check_variable = { world_stage_coalition = PREV.theater_owner_coalition }	# it's a defender
														check_variable = { PREV.world_stage_power_deployed_by^this_metropolis > 0 }
													}
													PREV.world_stage_power_deployed_by^this_metropolis = 5
													set_temp_variable = { end_loop = 1 }
												}
											}
										}
									}
								}
							}
						} else = {																# it's an attacker
							var:current_theater = {
								for_each_loop = {
									array = world_stage_power_deployed_by
									index = this_metropolis
									value = deployed_power
									break = end_loop
									if = {
										limit = { check_variable = { this_metropolis > 100 } }	# unspecified minors DO NOT count here
										if = {
											var:this_metropolis = {
												if = {
													limit = {
														check_variable = { world_stage_coalition = PREV.coalition_side_attack }	# it's an attacker
														check_variable = { PREV.world_stage_power_deployed_by^this_metropolis > 0 }
													}
													PREV.world_stage_power_deployed_by^this_metropolis = 5
													set_temp_variable = { end_loop = 1 }
												}
											}
										}
									}
								}
							}
						}
					}
					log = "debug: button_equipment theater nº[?var:current_theater] by [?5], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
			button_offensive_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = 5 } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @action_offensive } # type of action taken
					add_command_power = -25
					var:current_theater = {
						random_list = {
							1 = { set_temp_variable = { offensive_bonus = 0.025 } }
							1 = { set_temp_variable = { offensive_bonus = 0.05 } }
							1 = { set_temp_variable = { offensive_bonus = 0.075 } }
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 5 } }
							random_list = {
								1 = { set_temp_variable = { offensive_bonus = 0.05 } }
								1 = { set_temp_variable = { offensive_bonus = 0.1 } }
								1 = { set_temp_variable = { offensive_bonus = 0.15 } }
							}
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 15 } }
							random_list = {
								1 = { set_temp_variable = { offensive_bonus = 0.075 } }
								1 = { set_temp_variable = { offensive_bonus = 0.15 } }
								1 = { set_temp_variable = { offensive_bonus = 0.225 } }
							}
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 30 } }
							random_list = {
								1 = { set_temp_variable = { offensive_bonus = 0.1 } }
								1 = { set_temp_variable = { offensive_bonus = 0.2 } }
								1 = { set_temp_variable = { offensive_bonus = 0.3 } }
							}
						}
						if = {
							limit = { check_variable = { PREV.world_stage_coalition = theater_owner_coalition } }	# it's a defender
							add_to_variable = { defender_strategic_advantage = offensive_bonus }
						} else = {																# it's an attacker
							add_to_variable = { attacker_strategic_advantage = offensive_bonus }
						}
					}
					log = "debug: button_offensive theater nº[?var:current_theater], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
			button_defenses_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = 5 } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @action_defenses } # type of action taken
					add_command_power = -25
					var:current_theater = {
						set_temp_variable = { defenses_bonus = 0.05 }
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 15 } }
							 set_temp_variable = { defenses_bonus = 0.1 }
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 30 } }
							set_temp_variable = { defenses_bonus = 0.15 }
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 45 } }
							set_temp_variable = { defenses_bonus = 0.2 }
						}
						if = {
							limit = { check_variable = { PREV.world_stage_coalition = theater_owner_coalition } }	# it's a defender
							add_to_variable = { defender_strategic_advantage = defenses_bonus }
						} else = {																# it's an attacker
							add_to_variable = { attacker_strategic_advantage = defenses_bonus }
						}
					}
					log = "debug: button_defenses theater nº[?var:current_theater], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
			button_retreat_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = 5 } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @action_retreat } # type of action taken
					add_command_power = -25
					set_temp_variable = { retreat_value = var:current_theater:world_stage_power_deployed_by^world_stage_metropolis }
					set_temp_variable = { rear_guard = 1 }
					if = { limit = { check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 49 } set_temp_variable = { rear_guard = 5 } } }
					if = { limit = { check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 100 } set_temp_variable = { rear_guard = 10 } } }
					if = { limit = { check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 110 } set_temp_variable = { retreat_value = 100 } } set_temp_variable = { rear_guard = 0 } }
					subtract_from_temp_variable = { retreat_value = rear_guard }
					subtract_from_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis = retreat_value }
					var:world_stage_metropolis = { add_to_variable = { world_stage_power = retreat_value } }
					var:current_theater = { world_stage_state_update_current_day = yes }
					log = "debug: button_retreat theater nº[?var:current_theater] by [?retreat_value], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
		}
	}
	
	SS_worldstage_theater_alternative = {
		context_type = player_context
		window_name = "SS_worldstage_container_theater_alternative"
		parent_window_token = politics_tab
		#dirty = show_SS_worldstage
		
		visible = { NOT = { check_variable = { current_theater = 0 } } has_country_flag = view_alternative_theater_display }
		
		properties = {
			world_stage_theater_map = {
				image = "[THIS.WorldStageGetMapGfx]"
			}
			world_stage_theater_background = {
				image = "[THIS.WorldStageGetMapBackgroundGfx]"
			}
			world_stage_defender_symbol = { frame = var:defender_symbol }
			world_stage_attacker_symbol = { frame = var:attacker_symbol }
			world_stage_clock_counter = { frame = var:current_theater:clock_frame }
			#world_stage_clock_counter = { frame = "[THIS.Get_clock_frame]" }
		}
		
		triggers = {
			worldstage_go_to_connection_1_visible = { always = yes }
			worldstage_go_to_connection_2_visible = { if = { check_variable = { number_of_connections_displayed > 1 } } }
			worldstage_go_to_connection_3_visible = { if = { check_variable = { number_of_connections_displayed > 2 } } }			
			worldstage_go_to_connection_4_visible = { if = { check_variable = { number_of_connections_displayed > 3 } } }
			worldstage_go_to_connection_1_click_enabled = { var:current_theater:connects_to^0 = { can_open_theater = yes  } }
			worldstage_go_to_connection_2_click_enabled = { var:current_theater:connects_to^1 = { can_open_theater = yes  } }
			worldstage_go_to_connection_3_click_enabled = { var:current_theater:connects_to^2 = { can_open_theater = yes  } }
			worldstage_go_to_connection_4_click_enabled = { var:current_theater:connects_to^3 = { can_open_theater = yes  } }
			world_stage_go_to_background_12_visible = {if = { check_variable = { number_of_connections_displayed > 1 } } }
			world_stage_go_to_background_23_visible = {if = { check_variable = { number_of_connections_displayed > 2 } } }
			world_stage_go_to_background_34_visible = {if = { check_variable = { number_of_connections_displayed > 3 } } }
			world_stage_land_based_theater_visible = { NOT = { var:current_theater = { has_state_flag = is_navy_theater } } }
			world_stage_clock_base_visible = { var:current_theater = { has_state_flag = theater_is_active } }
			world_stage_clock_counter_visible = { var:current_theater = { has_state_flag = theater_is_active } }
			world_stage_clock_display_visible = { var:current_theater = { has_state_flag = theater_is_active } }
		#	world_stage_allies_header_visible = { OR = { has_world_stage_coalition_axis = no has_state_flag = theater_is_active } }
		#	world_stage_allies_visible = { OR = { has_world_stage_coalition_axis = no has_state_flag = theater_is_active } }
		#	world_stage_allies_power_display_visible = { OR = { has_world_stage_coalition_axis = no has_state_flag = theater_is_active } }
		#	world_stage_axis_header_visible = { OR = { has_world_stage_coalition_axis = yes has_state_flag = theater_is_active } }
		#	world_stage_axis_visible = { OR = { has_world_stage_coalition_axis = yes has_state_flag = theater_is_active } }
		#	world_stage_axis_power_display_visible = { OR = { has_world_stage_coalition_axis = yes has_state_flag = theater_is_active } }
			button_reinforce_click_enabled = {													# placeholder triggers, change later to add actual costs
				var:current_theater = { has_state_flag = theater_is_active }					# placeholder triggers, change later to add actual costs
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }	# placeholder triggers, change later to add actual costs
				command_power > 24.9
				check_variable = { var:world_stage_metropolis:world_stage_power > 0 }
				world_stage_has_permission_no_tooltip = yes
			}
			button_equipment_click_enabled = {
				var:current_theater = { has_state_flag = theater_is_active }
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }
				command_power > 24.9
				has_equipment = { infantry_equipment > 499 }
				has_equipment = { convoy > 4 }
				has_manpower > 4999
				OR = {
					check_variable = { current_theater = 16 }
					check_variable = { current_theater = 17 }
					check_variable = { current_theater = 18 }
					check_variable = { current_theater = 19 }
					check_variable = { current_theater = 20 }
					check_variable = { current_theater = 21 }
					check_variable = { current_theater = 22 }
					check_variable = { current_theater = 28 }
					check_variable = { current_theater = 33 }
				}
			}
			button_offensive_click_enabled = {
				var:current_theater = { has_state_flag = theater_is_active }
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }
				command_power > 24.9
				check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 1 }
				world_stage_has_permission_no_tooltip = yes
			}
			button_defenses_click_enabled = {
				var:current_theater = { has_state_flag = theater_is_active }
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }
				command_power > 24.9
				check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 1 }
				world_stage_has_permission_no_tooltip = yes
			}
			button_retreat_click_enabled = {
				var:current_theater = { has_state_flag = theater_is_active }
				check_variable = { array_worldstage_action_cooldown^var:current_theater < 1 }
				command_power > 24.9
				check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 1.1 }	# min = 2
				world_stage_has_permission_no_tooltip = yes
			}
			world_stage_attacker_header_visible = { var:current_theater = { has_state_flag = theater_is_active } }
			world_stage_attacker_symbol_visible = { var:current_theater = { has_state_flag = theater_is_active } }
			world_stage_attacker_power_display_visible = { var:current_theater = { has_state_flag = theater_is_active } }
		}
		
		effects = {
			button_close_theater_click = { set_variable = { current_theater = 0 } clear_alternative_theater = yes }
			worldstage_go_to_connection_1_click = {
				var:current_theater = { set_variable = { ROOT.current_theater = connects_to^0 } }
				switch_theater_displayed = yes
				get_current_theater_info = yes
			}
			worldstage_go_to_connection_2_click = {
				var:current_theater = { set_variable = { ROOT.current_theater = connects_to^1 } }
				switch_theater_displayed = yes
				get_current_theater_info = yes
			}
			worldstage_go_to_connection_3_click = {
				var:current_theater = { set_variable = { ROOT.current_theater = connects_to^2 } }
				switch_theater_displayed = yes
				get_current_theater_info = yes
			}
			worldstage_go_to_connection_4_click = {
				var:current_theater = { set_variable = { ROOT.current_theater = connects_to^3 } }
				switch_theater_displayed = yes
				get_current_theater_info = yes
			}
			button_reinforce_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = @reinforce_cooldown } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @action_reinforce } # type of action taken
					add_command_power = -25
					set_temp_variable = { reinforce_value = 1 }
					if = { limit = { check_variable = { var:world_stage_metropolis:world_stage_power > 10 } } add_to_temp_variable = { reinforce_value = 4 } }	# easier to add values step by step
					if = { limit = { check_variable = { var:world_stage_metropolis:world_stage_power > 50 } } add_to_temp_variable = { reinforce_value = 5 } }
					if = { limit = { check_variable = { var:world_stage_metropolis:world_stage_power > 100 } } add_to_temp_variable = { reinforce_value = 5 } }
					subtract_from_variable = { var:world_stage_metropolis:world_stage_power = reinforce_value }
					add_to_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis = reinforce_value }
					var:current_theater = { world_stage_state_update_current_day = yes }
					log = "debug: button_reinforce theater nº[?var:current_theater] by [?reinforce_value], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
			button_equipment_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = @equipment_cooldown } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @actionsupply } # type of action taken
					add_command_power = -25
					add_equipment_to_stockpile = { type = infantry_equipment amount = -500 }
					add_equipment_to_stockpile = { type = convoy_1 amount = -5 }
					add_manpower = -5000
					if = {
						limit = { check_variable = { world_stage_metropolis > 100 } }	# has a presence outside Japan
						add_to_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis = 5 }
						var:current_theater = { world_stage_state_update_current_day = yes }
					} else = {
						# this tag does not have a presence outside Japan: it will pick a suitable ally and reinforce it
						if = {
							limit = { check_variable = { PREV.world_stage_coalition = theater_owner_coalition } }	# it's a defender
							var:current_theater = {
								for_each_loop = {
									array = world_stage_power_deployed_by
									index = this_metropolis
									value = deployed_power
									break = end_loop
									if = {
										limit = { check_variable = { this_metropolis > 100 } }	# unspecified minors DO NOT count here
										if = {
											var:this_metropolis = {
												if = {
													limit = {
														check_variable = { world_stage_coalition = PREV.theater_owner_coalition }	# it's a defender
														check_variable = { PREV.world_stage_power_deployed_by^this_metropolis > 0 }
													}
													PREV.world_stage_power_deployed_by^this_metropolis = 5
													set_temp_variable = { end_loop = 1 }
												}
											}
										}
									}
								}
							}
						} else = {																# it's an attacker
							var:current_theater = {
								for_each_loop = {
									array = world_stage_power_deployed_by
									index = this_metropolis
									value = deployed_power
									break = end_loop
									if = {
										limit = { check_variable = { this_metropolis > 100 } }	# unspecified minors DO NOT count here
										if = {
											var:this_metropolis = {
												if = {
													limit = {
														check_variable = { world_stage_coalition = PREV.coalition_side_attack }	# it's an attacker
														check_variable = { PREV.world_stage_power_deployed_by^this_metropolis > 0 }
													}
													PREV.world_stage_power_deployed_by^this_metropolis = 5
													set_temp_variable = { end_loop = 1 }
												}
											}
										}
									}
								}
							}
						}
					}
					log = "debug: button_equipment theater nº[?var:current_theater] by [?5], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
			button_offensive_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = 5 } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @action_offensive } # type of action taken
					add_command_power = -25
					var:current_theater = {
						random_list = {
							1 = { set_temp_variable = { offensive_bonus = 0.025 } }
							1 = { set_temp_variable = { offensive_bonus = 0.05 } }
							1 = { set_temp_variable = { offensive_bonus = 0.075 } }
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 5 } }
							random_list = {
								1 = { set_temp_variable = { offensive_bonus = 0.05 } }
								1 = { set_temp_variable = { offensive_bonus = 0.1 } }
								1 = { set_temp_variable = { offensive_bonus = 0.15 } }
							}
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 15 } }
							random_list = {
								1 = { set_temp_variable = { offensive_bonus = 0.075 } }
								1 = { set_temp_variable = { offensive_bonus = 0.15 } }
								1 = { set_temp_variable = { offensive_bonus = 0.225 } }
							}
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 30 } }
							random_list = {
								1 = { set_temp_variable = { offensive_bonus = 0.1 } }
								1 = { set_temp_variable = { offensive_bonus = 0.2 } }
								1 = { set_temp_variable = { offensive_bonus = 0.3 } }
							}
						}
						if = {
							limit = { check_variable = { PREV.world_stage_coalition = theater_owner_coalition } }	# it's a defender
							add_to_variable = { defender_strategic_advantage = offensive_bonus }
						} else = {																# it's an attacker
							add_to_variable = { attacker_strategic_advantage = offensive_bonus }
						}
					}
					log = "debug: button_offensive theater nº[?var:current_theater], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
			button_defenses_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = 5 } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @action_defenses } # type of action taken
					add_command_power = -25
					var:current_theater = {
						set_temp_variable = { defenses_bonus = 0.05 }
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 15 } }
							 set_temp_variable = { defenses_bonus = 0.1 }
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 30 } }
							set_temp_variable = { defenses_bonus = 0.15 }
						}
						if = {
							limit = { check_variable = { world_stage_power_deployed_by^world_stage_metropolis > 45 } }
							set_temp_variable = { defenses_bonus = 0.2 }
						}
						if = {
							limit = { check_variable = { PREV.world_stage_coalition = theater_owner_coalition } }	# it's a defender
							add_to_variable = { defender_strategic_advantage = defenses_bonus }
						} else = {																# it's an attacker
							add_to_variable = { attacker_strategic_advantage = defenses_bonus }
						}
					}
					log = "debug: button_defenses theater nº[?var:current_theater], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
			button_retreat_click = {
				if = {
					limit = { command_power > 24.9 }
					set_variable = { array_worldstage_action_cooldown^var:current_theater = 5 } # number of days of cooldown
					set_variable = { array_worldstage_action_ongoing^var:current_theater = @action_retreat } # type of action taken
					add_command_power = -25
					set_temp_variable = { retreat_value = var:current_theater:world_stage_power_deployed_by^world_stage_metropolis }
					set_temp_variable = { rear_guard = 1 }
					if = { limit = { check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 49 } set_temp_variable = { rear_guard = 5 } } }
					if = { limit = { check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 100 } set_temp_variable = { rear_guard = 10 } } }
					if = { limit = { check_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis > 110 } set_temp_variable = { retreat_value = 100 } } set_temp_variable = { rear_guard = 0 } }
					subtract_from_temp_variable = { retreat_value = rear_guard }
					subtract_from_variable = { var:current_theater:world_stage_power_deployed_by^world_stage_metropolis = retreat_value }
					var:world_stage_metropolis = { add_to_variable = { world_stage_power = retreat_value } }
					var:current_theater = { world_stage_state_update_current_day = yes }
					log = "debug: button_retreat theater nº[?var:current_theater] by [?retreat_value], cooldown: [?array_worldstage_action_cooldown^var:current_theater] days"
				}
			}
		}
	}
	
	SS_worldstage_notification_on = {
		context_type = player_context
		window_name = "SS_worldstage_notification_on"
		parent_window_token = politics_tab
		#dirty = show_SS_worldstage
		
		visible = {
			NOT = { has_country_flag = hide_worldstage_notification }
			check_variable = { show_SS_worldstage = 1 }
		}
		
		effects = {
			worldstage_notification_on_button_click = { set_country_flag = hide_worldstage_notification }
		}
	}
	
	SS_worldstage_notification_off = {
		context_type = player_context
		window_name = "SS_worldstage_notification_off"
		parent_window_token = politics_tab
		#dirty = show_SS_worldstage
		
		visible = {
			has_country_flag = hide_worldstage_notification
			check_variable = { show_SS_worldstage = 1 }
		}
		
		effects = {
			worldstage_notification_off_button_click = { clr_country_flag = hide_worldstage_notification }
		}
	}
	
	SS_worldstage_autopilot_on = {
		context_type = player_context
		window_name = "SS_worldstage_autopilot_on"
		parent_window_token = politics_tab
		#dirty = show_SS_worldstage
		
		visible = {
			has_country_flag = enable_worldstage_autopilot
			check_variable = { show_SS_worldstage = 1 }
		}
		
		effects = {
			worldstage_autopilot_on_button_click = { clr_country_flag = enable_worldstage_autopilot }
		}
	}
	
	SS_worldstage_autopilot_off = {
		context_type = player_context
		window_name = "SS_worldstage_autopilot_off"
		parent_window_token = politics_tab
		#dirty = show_SS_worldstage
		
		visible = {
			NOT = { has_country_flag = enable_worldstage_autopilot }
			check_variable = { show_SS_worldstage = 1 }
		}
		
		effects = {
			worldstage_autopilot_off_button_click = { set_country_flag = enable_worldstage_autopilot }
		}
	}
}
