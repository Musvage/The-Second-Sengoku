scripted_gui = {
	TWR_UN_open = {
		context_type = player_context
		parent_window_token = politics_tab
		window_name = "TWR_UN_open_container"
		dirty = show_UN_main

		visible = {
			is_ai = no
		}

		effects = {
			view_UN_button_click = {
				if = {
					limit = { has_variable = show_UN_main }
					clear_variable = show_UN_main
				}
				else = {
					set_variable = { show_UN_main = 1 }
				}
				if = {
					limit = {
						is_in_array = { global.TWR_UNSC_array = ROOT }
					}
					set_variable = { voting_button_x = 0 }
				}
				else = {
					set_variable = { voting_button_x = -1000 }
				}
			}
		}
	}

	TWR_UN_member = {
		context_type = selected_country_context
		parent_window_token = selected_country_view_diplomacy
		window_name = "TWR_UN_member_container"
		dirty = show_UN_main

		visible = {
			is_in_array = { global.LON_members = THIS }
		}
	}

	TWR_UN_main = {
		context_type = player_context
		window_name = "TWR_UN_main_container"
		dirty = show_UN_main

		visible = {
			check_variable = { show_UN_main > 0 }
		}

		dynamic_lists = {
			TWR_UNSC_grid = {
				array = global.TWR_UNSC_array
				change_scope = yes
				entry_container = TWR_UNSC_entry
			}
			TWR_UN_grid = {
				array = global.LON_members
				change_scope = yes
				entry_container = TWR_UN_entry
			}
		}

		effects = {
			vote_yes_button_click = {
				if = {
					limit = {
						tag = CHI
						NOT = { has_global_flag = COUNTRY_PATH_CHI_UN_NO_VETO_VIETNAM_RESOLUTION }
						check_variable = { global.un_resolution = 5 }
					}
					CHI = {
						country_event = { id = twrchinaforeign.107 days = 0 }
					}
				}
				else = {
					set_variable = { un_resolution_vote = 1 }
					add_to_variable = { global.un_resolution_vote_yes = 1 }
					set_variable = { voted_for_resolution = 1 }
					add_to_variable = { show_UN_main = 1 }
					end_resolution = yes
				}
			}
			vote_no_button_click = {
				set_variable = { un_resolution_vote = 2 }
				add_to_variable = { global.un_resolution_vote_no = 1 }
				set_variable = { voted_for_resolution = 1 }
				add_to_variable = { show_UN_main = 1 }
				end_resolution = yes
			}
			abstain_button_click = {
				set_variable = { un_resolution_vote = 3 }
				add_to_variable = { global.un_resolution_vote_abstain = 1 }
				set_variable = { voted_for_resolution = 1 }
				add_to_variable = { show_UN_main = 1 }
				end_resolution = yes
			}
			close_UN_button_click = {
				clear_variable = show_UN_main
			}
			open_resolution_button_click = {
				if = {
					limit = { has_variable = show_UN_resolution }
					clear_variable = show_UN_resolution
				}
				else = {
					set_variable = { show_UN_resolution = 1 }
				}
			}
		}

		triggers = {
			vote_yes_button_click_enabled = {
				check_variable = { global.un_resolution > 0 }
				check_variable = { voted_for_resolution < 1 }
			}
			vote_no_button_click_enabled = {
				check_variable = { global.un_resolution > 0 }
				check_variable = { voted_for_resolution < 1 }
			}
			abstain_button_click_enabled = {
				check_variable = { global.un_resolution > 0 }
				check_variable = { voted_for_resolution < 1 }
			}
		}

		properties = {
			TWR_UNSC_flag_icon = {
				image = "[THIS.GetFlag]"
				x = global.unsc_position_flag
			}
			TWR_UN_flag_icon = {
				image = "[THIS.GetFlag]"
			}
			TWR_UNSC_vote_text = {
				x = global.unsc_position_text
			}
			vote_yes_button = {
				x = voting_button_x
			}
			vote_no_button = {
				x = voting_button_x
			}
			abstain_button = {
				x = voting_button_x
			}
		}
	}

	TWR_UN_resolution = {
		context_type = player_context
		window_name = "TWR_UN_resolution_container"
		dirty = show_UN_resolution

		visible = {
			check_variable = { show_UN_resolution > 0 }
		}

		dynamic_lists = {
			TWR_resolution_grid = {
				array = global.TWR_resolution_array
				change_scope = yes
				entry_container = TWR_resolution_entry
			}
		}

		effects = {
			close_resolution_button_click = {
				if = {
					limit = { has_variable = show_UN_resolution }
					clear_variable = show_UN_resolution
				}
				else = {
					set_variable = { show_UN_resolution = 1 }
				}
			}
		}
	}

	TWR_UN_ai = {
		context_type = player_context
		parent_window_token = top_bar
		window_name = "TWR_UN_ai_container"

		visible = {
			is_ai = yes
			is_in_array = { global.TWR_UNSC_array = THIS }
		}

		effects = {
			ai_vote_yes_button_click = {
				if = {
					limit = { has_variable = vote_block }
					clear_variable = vote_block
					set_variable = { un_resolution_vote = 1 }
					add_to_variable = { global.un_resolution_vote_yes = 1 }
					set_variable = { voted_for_resolution = 1 }
					every_country = {
						limit = { is_ai = no }
						if = {
							limit = { has_variable = show_UN_main }
							add_to_variable = { show_UN_main = 1 }
						}
					}
					end_resolution = yes
				}
				else = {
					set_variable = { vote_block = 1 }
				}
			}
			ai_vote_no_button_click = {
				if = {
					limit = { has_variable = vote_block }
					clear_variable = vote_block
					set_variable = { un_resolution_vote = 2 }
					add_to_variable = { global.un_resolution_vote_no = 1 }
					set_variable = { voted_for_resolution = 1 }
					every_country = {
						limit = { is_ai = no }
						if = {
							limit = { has_variable = show_UN_main }
							add_to_variable = { show_UN_main = 1 }
						}
					}
					end_resolution = yes
				}
				else = {
					set_variable = { vote_block = 1 }
				}
			}
			ai_vote_abstain_button_click = {
				if = {
					limit = { has_variable = vote_block }
					clear_variable = vote_block
					set_variable = { un_resolution_vote = 3 }
					add_to_variable = { global.un_resolution_vote_abstain = 1 }
					set_variable = { voted_for_resolution = 1 }
					every_country = {
						limit = { is_ai = no }
						if = {
							limit = { has_variable = show_UN_main }
							add_to_variable = { show_UN_main = 1 }
						}
					}
					end_resolution = yes
				}
				else = {
					set_variable = { vote_block = 1 }
				}
			}
		}

		triggers = {
			ai_vote_yes_button_click_enabled = {
				check_variable = { global.un_resolution > 0 }
				check_variable = { voted_for_resolution < 1 }
			}
			ai_vote_no_button_click_enabled = {
				check_variable = { global.un_resolution > 0 }
				check_variable = { voted_for_resolution < 1 }
			}
			ai_vote_abstain_button_click_enabled = {
				check_variable = { global.un_resolution > 0 }
				check_variable = { voted_for_resolution < 1 }
			}
		}

		ai_enabled = {
			always = yes
        }

		ai_test_interval = 120
		ai_test_variance = 0.5

		ai_check = {
			check_variable = { global.un_resolution > 0 }
			check_variable = { voted_for_resolution < 1 }
        }

		ai_weights = {
			ai_vote_yes_button_click = {
				ai_will_do = {
					base = -1
					modifier = {
						check_variable = { ai_vote_choice_resolution = 1 }
						add = 10
					}
				}
			}
			ai_vote_no_button_click = {
				ai_will_do = {
					base = -1
					modifier = {
						check_variable = { ai_vote_choice_resolution = 2 }
						add = 10
					}
				}
			}
			ai_vote_abstain_button_click = {
				ai_will_do = {
					base = -1
					modifier = {
						check_variable = { ai_vote_choice_resolution = 3 }
						add = 10
					}
				}
			}
		}
	}
}

