# indexes for theater
@spanish_cw		= 1
@mongolia		= 2
@poland			= 3
@ardennes		= 4
@alsace			= 5
@westphalia		= 6
@germany		= 7
@france			= 8
@belarus		= 9
@smolensk		= 10
@russia			= 11
@norway			= 12
@ethiopia		= 13
@lybia			= 14
@egypt			= 15
@india			= 16
@bengal			= 17
@tibet			= 18
@china			= 19
@indies			= 20
@philipines		= 21
@sibeira		= 22
@italy			= 23
@sicily			= 24
@alpes			= 25
@austria		= 26
@netherlands	= 27
@guanxi			= 28
@urals			= 29
@england		= 30
@normandy		= 31
@sealion		= 32
@taiwan			= 33

set_up_ai_for_world_stage = {
	# 1st step: list theaters by priority order for each country
	# 2nd step: list theaters that the country does not want to interfere
	# 3nd step: set up variables for behaviour
	101 = { # Germany
		# priority
		add_to_array = { world_stage_priority_theater = @germany }		# the first theater (index 0 on this list) should always be the capital, where AI will defend to the death
		add_to_array = { world_stage_priority_theater = @westphalia }
		add_to_array = { world_stage_priority_theater = @austria }
		add_to_array = { world_stage_priority_theater = @poland }
		add_to_array = { world_stage_priority_theater = @alsace }
		add_to_array = { world_stage_priority_theater = @france }
		add_to_array = { world_stage_priority_theater = @moscow }
		add_to_array = { world_stage_priority_theater = @smolensk }
		add_to_array = { world_stage_priority_theater = @belaus }
		add_to_array = { world_stage_priority_theater = @sealion }
		add_to_array = { world_stage_priority_theater = @england }
		add_to_array = { world_stage_priority_theater = @normandy }
		# ignore
		add_to_array = { world_stage_ignore_theater = @mongolia }
		add_to_array = { world_stage_ignore_theater = @philipines }
		add_to_array = { world_stage_ignore_theater = @indies }
		add_to_array = { world_stage_ignore_theater = @tibet }
		add_to_array = { world_stage_ignore_theater = @bengal }
		add_to_array = { world_stage_ignore_theater = @india }
		add_to_array = { world_stage_ignore_theater = @guanxi }
		add_to_array = { world_stage_ignore_theater = @sibeira }
		add_to_array = { world_stage_ignore_theater = @taiwan }
		add_to_array = { world_stage_ignore_theater = @china }
	}
	102 = {	# England
		# priority
		add_to_array = { world_stage_priority_theater = @england }
		add_to_array = { world_stage_priority_theater = @france }
		add_to_array = { world_stage_priority_theater = @germany }
		add_to_array = { world_stage_priority_theater = @westphalia }
		add_to_array = { world_stage_priority_theater = @egypt }
		add_to_array = { world_stage_priority_theater = @alsace }
		add_to_array = { world_stage_priority_theater = @india }
		add_to_array = { world_stage_priority_theater = @bengal }
		add_to_array = { world_stage_priority_theater = @guanxi }
		add_to_array = { world_stage_priority_theater = @china }
		# ignore
		add_to_array = { world_stage_ignore_theater = @taiwan }
		add_to_array = { world_stage_ignore_theater = @philipines }
		add_to_array = { world_stage_ignore_theater = @indies }
		add_to_array = { world_stage_ignore_theater = @monoglia }
		add_to_array = { world_stage_ignore_theater = @siberia }
		add_to_array = { world_stage_ignore_theater = @urals }
	}
	103 = {	# France
		# priority
		add_to_array = { world_stage_priority_theater = @france }
		add_to_array = { world_stage_priority_theater = @alsace }
		add_to_array = { world_stage_priority_theater = @westphalia }
		add_to_array = { world_stage_priority_theater = @germany }
		add_to_array = { world_stage_priority_theater = @england }
		add_to_array = { world_stage_priority_theater = @poland }
		# ignore
		add_to_array = { world_stage_ignore_theater = @taiwan }
		add_to_array = { world_stage_ignore_theater = @philipines }
		add_to_array = { world_stage_ignore_theater = @indies }
		add_to_array = { world_stage_ignore_theater = @monoglia }
		add_to_array = { world_stage_ignore_theater = @siberia }
		add_to_array = { world_stage_ignore_theater = @urals }
	}
	104 = {	# Soviet Union
		# priority
		add_to_array = { world_stage_priority_theater = @russia }
		add_to_array = { world_stage_priority_theater = @smolensk }
		add_to_array = { world_stage_priority_theater = @urals }
		add_to_array = { world_stage_priority_theater = @belarus }
		add_to_array = { world_stage_priority_theater = @poland }
		add_to_array = { world_stage_priority_theater = @siberia }
		add_to_array = { world_stage_priority_theater = @germany }
		add_to_array = { world_stage_priority_theater = @mongolia }
		add_to_array = { world_stage_priority_theater = @guanxi }
		add_to_array = { world_stage_priority_theater = @china }
		# ignore
		add_to_array = { world_stage_ignore_theater = @bengal }
		add_to_array = { world_stage_ignore_theater = @india }
		add_to_array = { world_stage_ignore_theater = @taiwan }
		add_to_array = { world_stage_ignore_theater = @philipines }
		add_to_array = { world_stage_ignore_theater = @indies }
		add_to_array = { world_stage_ignore_theater = @india }
	}
	105 = {	# USA
		# priority
		add_to_array = { world_stage_priority_theater = @taiwan }
		add_to_array = { world_stage_priority_theater = @england }
		add_to_array = { world_stage_priority_theater = @france }
		add_to_array = { world_stage_priority_theater = @germany }
		add_to_array = { world_stage_priority_theater = @westphalia }
		add_to_array = { world_stage_priority_theater = @alsace }
		add_to_array = { world_stage_priority_theater = @italy }
		add_to_array = { world_stage_priority_theater = @egypt }
		add_to_array = { world_stage_priority_theater = @sicily }
		add_to_array = { world_stage_priority_theater = @lybia }
		add_to_array = { world_stage_priority_theater = @philipines }
		# ignore
		add_to_array = { world_stage_ignore_theater = @siberia }
		add_to_array = { world_stage_ignore_theater = @mongolia }
		add_to_array = { world_stage_ignore_theater = @tibet }
		add_to_array = { world_stage_ignore_theater = @urals }
		add_to_array = { world_stage_ignore_theater = @bengal }
	}
	106 = {	# China
		# priority
		add_to_array = { world_stage_priority_theater = @china }
		add_to_array = { world_stage_priority_theater = @guanxi }
		add_to_array = { world_stage_priority_theater = @tibet }
		add_to_array = { world_stage_priority_theater = @taiwan }
		add_to_array = { world_stage_priority_theater = @philipines }
		add_to_array = { world_stage_priority_theater = @indies }
		add_to_array = { world_stage_priority_theater = @bengal }
		add_to_array = { world_stage_priority_theater = @mongolia }
		add_to_array = { world_stage_priority_theater = @india }
		add_to_array = { world_stage_priority_theater = @siberia }
		add_to_array = { world_stage_priority_theater = @urals }
		add_to_array = { world_stage_priority_theater = @russia }
		# ignore
		add_to_array = { world_stage_ignore_theater = @lybia }
		add_to_array = { world_stage_ignore_theater = @egypt }
		add_to_array = { world_stage_ignore_theater = @belarus }
		add_to_array = { world_stage_ignore_theater = @smolensk }
		add_to_array = { world_stage_ignore_theater = @poland }
		add_to_array = { world_stage_ignore_theater = @alpes }
		add_to_array = { world_stage_ignore_theater = @sicily }
		add_to_array = { world_stage_ignore_theater = @italy }
		add_to_array = { world_stage_ignore_theater = @alsace }
		add_to_array = { world_stage_ignore_theater = @westphalia }
		add_to_array = { world_stage_ignore_theater = @france }
		add_to_array = { world_stage_ignore_theater = @germany }
		add_to_array = { world_stage_ignore_theater = @england }
	}
	107 = {	# Netherlands
		# priority
		add_to_array = { world_stage_priority_theater = @netherlands }
		add_to_array = { world_stage_priority_theater = @indies }
		add_to_array = { world_stage_priority_theater = @westphalia }
		add_to_array = { world_stage_priority_theater = @france }
		add_to_array = { world_stage_priority_theater = @england }
		# ignore
		add_to_array = { world_stage_ignore_theater = @mongolia }
		add_to_array = { world_stage_ignore_theater = @urals }
		add_to_array = { world_stage_ignore_theater = @smolensk }
		add_to_array = { world_stage_ignore_theater = @tibet }
		add_to_array = { world_stage_ignore_theater = @siberia }
		add_to_array = { world_stage_ignore_theater = @smolensk }
		add_to_array = { world_stage_ignore_theater = @belarus }
		add_to_array = { world_stage_ignore_theater = @poland }
		add_to_array = { world_stage_ignore_theater = @russia }
	}
	108 = {	# Portugal
		# priority
		add_to_array = { world_stage_priority_theater = @germany }
		add_to_array = { world_stage_priority_theater = @france }
		add_to_array = { world_stage_priority_theater = @england }
		# ignore
		add_to_array = { world_stage_ignore_theater = @urals }
		add_to_array = { world_stage_ignore_theater = @smolensk }
		add_to_array = { world_stage_ignore_theater = @tibet }
		add_to_array = { world_stage_ignore_theater = @siberia }
		add_to_array = { world_stage_ignore_theater = @smolensk }
		add_to_array = { world_stage_ignore_theater = @belarus }
		add_to_array = { world_stage_ignore_theater = @poland }
		add_to_array = { world_stage_ignore_theater = @russia }
	}
	109 = {	# Italy
		# priority
		add_to_array = { world_stage_priority_theater = @italy }
		add_to_array = { world_stage_priority_theater = @alpes }
		add_to_array = { world_stage_priority_theater = @sicily }
		add_to_array = { world_stage_priority_theater = @lybia }
		add_to_array = { world_stage_priority_theater = @egypt }
		add_to_array = { world_stage_priority_theater = @austria }
		add_to_array = { world_stage_priority_theater = @germany }
		add_to_array = { world_stage_priority_theater = @westphalia }
		add_to_array = { world_stage_priority_theater = @france }
		add_to_array = { world_stage_priority_theater = @alsace }
		# ignore
		add_to_array = { world_stage_ignore_theater = @taiwan }
		add_to_array = { world_stage_ignore_theater = @indies }
		add_to_array = { world_stage_ignore_theater = @philipines }
		add_to_array = { world_stage_ignore_theater = @china }
		add_to_array = { world_stage_ignore_theater = @tibet }
		add_to_array = { world_stage_ignore_theater = @bengal }
		add_to_array = { world_stage_ignore_theater = @india }
		add_to_array = { world_stage_ignore_theater = @guanxi }
		add_to_array = { world_stage_ignore_theater = @sibeira }
	}
}

chose_theater_to_act = {
	# 1st step: check all priority theater, pick the first on the list that is active
	# 2nd step: check all non-ingnored theaters, pick random one that is active
	# 3rd step: check all ingored theaters, pick last on the list that is active
		
	set_variable = { selected_theater = 0 }	# always set to zero at the start: if no theater is selected, "0" means no action will be taken further down the code
	clr_state_flag = selected_theater_is_priority
	clr_state_flag = selected_theater_is_ignored
	
	for_each_loop = {
		array = world_stage_priority_theater
		index = this_theater	# this index IS NOT a theater index!
		value = theater_index	# this is the theater index, which is a state id
		break = break			# if we use set_temp_variable = { break = 1 }, it breaks the code (any value other than 0)
		
		var:theater_index = {
			if = {
				limit = { has_state_flag = theater_is_active }
				PREV = { set_variable = { selected_theater = theater_index } set_state_flag = selected_theater_is_priority }
				set_temp_variable = { break = 1 }
			}
		}
	}
	if = {
		limit = { check_variable = { selected_theater = 0 } }	# if this is zero, then no priority theater was chosen, let's choose a regular
		for_each_loop = {
			array = global.theater_list
			index = this_theater	# this index IS NOT a theater index!
			value = theater_index	# this is the theater index, which is a state id
			
			var:theater_index = {
				if = {
					limit = { has_state_flag = theater_is_active }
					PREV = { set_variable = { selected_theater = theater_index } }
					# now we check to see if we should ignore it
					for_each_loop = {
						array = PREV.world_stage_ignore_theater
						index = this_theater_B	# this index IS NOT a theater index!
						value = theater_index_B	# this is the theater index, which is a state id
						
						if = {
							limit = { check_temp_variable = { theater_index = theater_index_B } }	# if this is true, AI picked a theater it should ignore
							PREV = { set_variable = { selected_theater = 0 } }						# setting to zero means no theater was picked yet
						}
					}
			
				}
			}
		}
	}
	if = {
		limit = { check_variable = { selected_theater = 0 } }	# if this is zero, then no regular theater was chosen, let's choose an ignored
		for_each_loop = {
			array = world_stage_ignore_theater
			index = this_theater	# this index IS NOT a theater index!
			value = theater_index	# this is the theater index, which is a state id
			break = break			# if we use set_temp_variable = { break = 1 }, it breaks the code (any value other than 0)
			
			var:theater_index = {
				if = {
					limit = { has_state_flag = theater_is_active }
					PREV = { set_variable = { selected_theater = theater_index } set_state_flag = selected_theater_is_ignored }
					set_temp_variable = { break = 1 }
				}
			}
		}
	}
	var:theater_index = { log = "selected theater [?theater_index] ([THIS.GetTheaterName])" }
} d_chose_theater_to_act = { 101 = { log = "GERMANY: chose_theater_to_act" chose_theater_to_act = yes } }	# this is just for testing

choose_an_action = {
	# here, AI weights each action and chooses one
	# if victory is assured, it is less likely to reinforce
	# if theater is ignored, it is less likely to reinforce
	# if defeat is inevitable, it is likely to retreat
	# if it is winning, it will never retreat
	# if current theater is priority, it is less likely to retreat
	# if current theater is the hightest priority, it will never retreat
	# if it has more strategic advantage, it is less likely to retreat (makes sense given how this minigame works)
	# offensive or defenses depend on strategic advantage of the enemy
	# all probabilities are zero if the triggers for each 'button' are not met (if no action is taken, resets AI_took_an_action to make another action tomorrow )
	
	# base weights
	set_temp_variable = { want_to_reinforce = 100 }
	set_temp_variable = { want_to_supply = 100 }
	set_temp_variable = { want_to_offensive = 100 }
	set_temp_variable = { want_to_defenses = 100 }
	set_temp_variable = { want_to_retreat = 50 }
	# modifiers for weights
	if = {
		limit = { has_state_flag = selected_theater_is_ignored }
		multiply_temp_variable = { want_to_reinforce = 0.5 }
	}
	if = {
		limit = { has_state_flag = selected_theater_is_priority }
		multiply_temp_variable = { want_to_retreat = 0.5 }
	}
	if = {
		limit = { check_variable = { selected_theater = world_stage_priority_theater^0 } }
		set_temp_variable = { want_to_retreat = 0 }
	}
	# TODO TO-DO TO DO: finish this later
	#I may have to add an "Axis AI" and a "Allies AI"
	
	# now, cast the die!
	if = {
		limit = {
			OR = {
				check_temp_variable = { want_to_reinforce > 0 }
				check_temp_variable = { want_to_supply > 0 }
				check_temp_variable = { want_to_offensive > 0 }
				check_temp_variable = { want_to_defenses > 0 }
				check_temp_variable = { want_to_retreat > 0 }
			}
		}
		random_list = {
			var:want_to_reinforce = { log = "want_to_reinforce"}
			var:want_to_supply = { log = "want_to_supply" }
			var:want_to_offensive = { log = "want_to_offensive" }
			var:want_to_defenses = { log = "want_to_defenses"}
			var:want_to_retreat = { log = "want_to_retreat"}
		}
	} else = { clr_state_flag = AI_took_an_action set_state_flag = AI_took_an_action }	# try again tomorrow...
}

### NOTE TO MYSELF: REORDER "IGNORE LISTS" (less important should be at the botton)