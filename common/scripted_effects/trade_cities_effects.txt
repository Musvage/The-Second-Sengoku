# Hirado, 16
# Kobe, 27
# Osaka, 99
# Chiba, 21
# Yawatahawa, 143
# Okinawa, 141
# Nagasaki, 140

check_trade_cities = {

	if = {	# Check if city is lost
		limit = {
			OR = {
				has_idea_with_trait = trade_port_trait_hirado
				has_idea_with_trait = trade_port_trait_kobe
				has_idea_with_trait = trade_port_trait_osaka
				has_idea_with_trait = trade_port_trait_chiba
				has_idea_with_trait = trade_port_trait_yawatahawa	# not implemented yet
				#has_idea_with_trait = trade_port_trait_okinawa	# not implemented yet
				has_idea_with_trait = trade_port_trait_nagasaki
			}
		}
		if = {
			limit = {
				has_idea_with_trait = trade_port_trait_hirado
				NOT = { controls_state = 16 }
			}
			remove_ideas_with_trait = trade_port_trait_hirado
		}
		if = {
			limit = {
				has_idea_with_trait = trade_port_trait_kobe
				NOT = { controls_state = 27 }
			}
			remove_ideas_with_trait = trade_port_trait_kobe
		}
		if = {
			limit = {
				has_idea_with_trait = trade_port_trait_osaka
				NOT = { controls_state = 99 }
			}
			remove_ideas_with_trait = trade_port_trait_osaka
		}
		if = {
			limit = {
				has_idea_with_trait = trade_port_trait_chiba
				NOT = { controls_state = 21 }
			}
			remove_ideas_with_trait = trade_port_trait_chiba
		}
		if = {
			limit = {
				has_idea_with_trait = trade_port_trait_yawatahawa
				NOT = { controls_state = 143 }
			}
			remove_ideas_with_trait = trade_port_trait_yawatahawa
		}
		if = {
			limit = {
				has_idea_with_trait = trade_port_trait_okinawa
				NOT = { controls_state = 141 }
			}
			remove_ideas_with_trait = trade_port_trait_okinawa
		}
		if = {
			limit = {
				has_idea_with_trait = trade_port_trait_nagasaki
				NOT = { controls_state = 140 }
			}
			remove_ideas_with_trait = trade_port_trait_nagasaki
		}
	}
	
	if = {
		limit = { controls_state = 16 }
		if = {
			limit = { tag = HIR }
			if = {
				limit = { is_puppet = no }
				if = {
					limit = { NOT = { has_idea = trade_city_idea_hirado_independent } }
					add_ideas = trade_city_idea_hirado_independent
				}
				if = {
					limit = { has_idea = trade_city_idea_hirado_puppet }
					remove_ideas = trade_city_idea_hirado_puppet
				}
			} else = {	# is puppet
				if = {
					limit = { has_idea = trade_city_idea_hirado_independent }
					remove_ideas = trade_city_idea_hirado_independent
				}
				if = {
					limit = { NOT = { has_idea = trade_city_idea_hirado_puppet } }
					add_ideas = trade_city_idea_hirado_puppet
				}
			}
		} else = {	# not the city
			if = {
				limit = { NOT = { has_idea = trade_city_idea_hirado_occupied } }
				add_ideas = trade_city_idea_hirado_occupied
			}
		}
	}
	if = {
		limit = { controls_state = 27 }
		if = {
			limit = { tag = KOB }
			if = {
				limit = { is_puppet = no }
				if = {
					limit = { NOT = { has_idea = trade_city_idea_kobe_independent } }
					add_ideas = trade_city_idea_kobe_independent
				}
				if = {
					limit = { has_idea = trade_city_idea_kobe_puppet }
					remove_ideas = trade_city_idea_kobe_puppet
				}
			} else = {	# is puppet
				if = {
					limit = { has_idea = trade_city_idea_kobe_independent }
					remove_ideas = trade_city_idea_kobe_independent
				}
				if = {
					limit = { NOT = { has_idea = trade_city_idea_kobe_puppet } }
					add_ideas = trade_city_idea_kobe_puppet
				}
			}
		} else = {	# not the city
			if = {
				limit = { NOT = { has_idea = trade_city_idea_kobe_occupied } }
				add_ideas = trade_city_idea_kobe_occupied
			}
		}
	}
	if = {
		limit = { controls_state = 99 }
		if = {
			limit = { tag = OSA }
			if = {
				limit = { is_puppet = no }
				if = {
					limit = { NOT = { has_idea = trade_city_idea_osaka_independent } }
					add_ideas = trade_city_idea_osaka_independent
				}
				if = {
					limit = { has_idea = trade_city_idea_osaka_puppet }
					remove_ideas = trade_city_idea_osaka_puppet
				}
			} else = {	# is puppet
				if = {
					limit = { has_idea = trade_city_idea_osaka_independent }
					remove_ideas = trade_city_idea_osaka_independent
				}
				if = {
					limit = { NOT = { has_idea = trade_city_idea_osaka_puppet } }
					add_ideas = trade_city_idea_osaka_puppet
				}
			}
		} else = {	# not the city
			if = {
				limit = { NOT = { has_idea = trade_city_idea_osaka_occupied } }
				add_ideas = trade_city_idea_osaka_occupied
			}
		}
	}
	if = {
		limit = { controls_state = 21 }
		if = {
			limit = { tag = AMC }
			if = {
				limit = { is_puppet = no }
				if = {
					limit = { NOT = { has_idea = trade_city_idea_chiba_independent } }
					add_ideas = trade_city_idea_chiba_independent
				}
				if = {
					limit = { has_idea = trade_city_idea_chiba_puppet }
					remove_ideas = trade_city_idea_chiba_puppet
				}
			} else = {	# is puppet
				if = {
					limit = { has_idea = trade_city_idea_chiba_independent }
					remove_ideas = trade_city_idea_chiba_independent
				}
				if = {
					limit = { NOT = { has_idea = trade_city_idea_chiba_puppet } }
					add_ideas = trade_city_idea_chiba_puppet
				}
			}
		} else = {	# not the city
			if = {
				limit = { NOT = { has_idea = trade_city_idea_chiba_occupied } }
				add_ideas = trade_city_idea_chiba_occupied
			}
		}
	}
	if = {
		limit = { controls_state = 143 }
		if = {
			limit = { tag = REI }
			if = {
				limit = { is_puppet = no }
				if = {
					limit = { NOT = { has_idea = trade_city_idea_yawatahawa_independent } }
					add_ideas = trade_city_idea_yawatahawa_independent
				}
				if = {
					limit = { has_idea = trade_city_idea_yawatahawa_puppet }
					remove_ideas = trade_city_idea_yawatahawa_puppet
				}
			} else = {	# is puppet
				if = {
					limit = { has_idea = trade_city_idea_yawatahawa_independent }
					remove_ideas = trade_city_idea_yawatahawa_independent
				}
				if = {
					limit = { NOT = { has_idea = trade_city_idea_yawatahawa_puppet } }
					add_ideas = trade_city_idea_yawatahawa_puppet
				}
			}
		} else = {	# not the city
			if = {
				limit = { NOT = { has_idea = trade_city_idea_yawatahawa_occupied } }
				add_ideas = trade_city_idea_yawatahawa_occupied
			}
		}
	}
	if = {
		limit = { controls_state = 141 always = no }	# not implemented yet
		if = {
			limit = { tag = OKI }
			if = {
				limit = { is_puppet = no }
				if = {
					limit = { NOT = { has_idea = trade_city_idea_okinawa_independent } }
					add_ideas = trade_city_idea_okinawa_independent
				}
				if = {
					limit = { has_idea = trade_city_idea_okinawa_puppet }
					remove_ideas = trade_city_idea_okinawa_puppet
				}
			} else = {	# is puppet
				if = {
					limit = { has_idea = trade_city_idea_okinawa_independent }
					remove_ideas = trade_city_idea_okinawa_independent
				}
				if = {
					limit = { NOT = { has_idea = trade_city_idea_okinawa_puppet } }
					add_ideas = trade_city_idea_okinawa_puppet
				}
			}
		} else = {	# not the city
			if = {
				limit = { NOT = { has_idea = trade_city_idea_okinawa_occupied } }
				add_ideas = trade_city_idea_okinawa_occupied
			}
		}
	}
	if = {
		limit = { controls_state = 140 }
		if = {
			limit = { tag = PRT }
			if = {
				limit = { is_puppet = no }
				if = {
					limit = { NOT = { has_idea = trade_city_idea_nagasaki_independent } }
					add_ideas = trade_city_idea_nagasaki_independent
				}
				if = {
					limit = { has_idea = trade_city_idea_nagasaki_puppet }
					remove_ideas = trade_city_idea_nagasaki_puppet
				}
			} else = {	# is puppet
				if = {
					limit = { has_idea = trade_city_idea_nagasaki_independent }
					remove_ideas = trade_city_idea_nagasaki_independent
				}
				if = {
					limit = { NOT = { has_idea = trade_city_idea_nagasaki_puppet } }
					add_ideas = trade_city_idea_nagasaki_puppet
				}
			}
		} else = {	# not the city
			if = {
				limit = { NOT = { has_idea = trade_city_idea_nagasaki_occupied } }
				add_ideas = trade_city_idea_nagasaki_occupied
			}
		}
	}

}