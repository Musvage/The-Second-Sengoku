get_number_of_connected_theaters = {
	log = "getting number of connections for [THIS.GetCurrentTheaterName] (held by state n.[?current_theater]"
	var:current_theater = {
		for_each_loop = {
			array = connects_to
			value = my_value
			index = my_index
			break = 4
			#effects
			set_variable = { ROOT.number_of_connections_displayed = my_index }
		}
	}
	add_to_variable = { number_of_connections_displayed = 1 }
	log = "show [?number_of_connections_displayed] connection(s)"	
}

get_current_theater_info = {
	var:current_theater = {
		# VARS FOR COMBAT
		set_variable = { PREV.current_defender_deployed_power = defender_deployed_power }
		set_variable = { PREV.current_attacker_deployed_power = attacker_deployed_power }
		log = "PREV.current_defender_deployed_power [?PREV.current_defender_deployed_power]"
		log = "defender_deployed_power [?defender_deployed_power]"
		log = "PREV.current_attacker_deployed_power [?PREV.current_attacker_deployed_power]"
		log = "attacker_deployed_power [?attacker_deployed_power]"
		# SYMBOLS
		## generic rules
		set_variable = { PREV.defender_symbol = theater_owner_coalition }
		set_variable = { PREV.attacker_symbol = coalition_side_attack }
	}
	## special cases
	if = {
		limit = { check_variable = { current_theater = 1 } }	# spanish civil war
		set_variable = { defender_symbol = 7 }	# rep√∫blica
		set_variable = { attacker_symbol = 8 }	# falange
	}
}

switch_theater_displayed = {
	get_number_of_connected_theaters = yes	# there is not situation in which "switch_theater_displayed" is used that "get_number_of_connected_theaters" is not!
	if = {
		limit = { has_country_flag = view_alternative_theater_display }
		clr_country_flag = view_alternative_theater_display
	} else = {
		set_country_flag = view_alternative_theater_display
	}
}

clear_alternative_theater = {
	if = {
		limit = { has_country_flag = view_alternative_theater_display }
		clr_country_flag = view_alternative_theater_display
	}
}

world_stage_get_timer_frame = {	# this effect is used by the daily tick of World Stage theaters
	set_variable = { clock_frame = theater_timer }
	divide_variable = { clock_frame = theater_timer_base }
	multiply_variable = { clock_frame = 9 }
	round_variable = multiply_variable
	clamp_variable = { var = clock_frame min = 1 max = 9 }
}

world_stage_get_timer_frame_daily = {	# this effect is used on on_actions daily to update the timer, affecting the player tag
	var:current_theater = {
		set_variable = { PREV.clock_days_max = theater_timer_base }
		set_variable = { PREV.clock_days_left = theater_timer }
	}
}