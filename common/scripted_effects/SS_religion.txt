### Religion System 2.0 ###

# the game sets up variables for the base value of religion effects on start

# every country has a dynamic modifier with the effects of its official religion, the base effects scale to its popularity on owned-and-core states

# every state has a set of variables related to religion popularity (values range from 0 to 1)
# every state has a variable for the most popular religion (numerical value, indexes the religion)
# every state has a dynamic modifier for compliance bonus/penalty depending on the controller's official religion & laws & ideas

# the game sets up initial religions on the state's history file
# the game checks monthly for changes in religion popularity for each state
# the game checks monthly for compliance dynamic modifier
# the game checks upon each state changing control for compliance dynamic modifier
# the game checks weekly for the effects of laws & ideas over the effects of religion

# everytime the player changes religious & laws it triggers a check for its effects over religion
# every focus & decision that deals with religion should trigger a check for its effects over religion

#index of religions
#1 buddhism
#2 shinto
#3 christianity
#4 taoism
#5 confucianism
#6 secularism
#7 cult of cthulhu

# the Cult of Cthulhu believes that ph'nglui mglw'nafh Cthulhu R'lyeh wgah'nagl fhtagn

# Setting Up Base Values
set_up_global_religion_variables = {
	set_variable = { global.religion_base_buddhism_compliance_growth = 0.2 }
	set_variable = { global.religion_base_buddhism_resistance_growth = -0.2 }
	set_variable = { global.religion_base_buddhism_resistance_growth_on_our_occupied_states = -0.2 }
	set_variable = { global.religion_base_shinto_conscription = 0.1 }
	set_variable = { global.religion_base_shinto_surrender_limit = 0.1 }
	set_variable = { global.religion_base_christianity_conversion_speed = 0.2 }
	set_variable = { global.religion_base_christianity_resistance_growth_on_our_occupied_states = 0.2 }
	set_variable = { global.religion_base_taoism_stability_factor = 0.1 }
	set_variable = { global.religion_base_taoism_compliance_growth = 0.1 }
	set_variable = { global.religion_base_confucianism_political_advisor_cost = -0.15 }
	set_variable = { global.religion_base_confucianism_theorist_cost = -0.15 }
	set_variable = { global.religion_base_secularism_political_power = 0.1 }
	set_variable = { global.religion_base_secularism_compliance_growth = 0.1 }
	set_variable = { global.religion_base_cthulhu_stability_factor = -0.25 }
	set_variable = { global.religion_base_cthulhu_intel_factor = 0.25 }
	set_variable = { global.religion_base_cthulhu_research_speed = 0.25 }
	set_variable = { global.religion_base_cthulhu_nuke_production = 0.50 }
}

state_religion_error_catcher = {
	
	every_state = {
		if = {
			limit = { NOT = { has_variable = state_religion_buddhism } }
			log = "[THIS.GetName] is missing state_religion_buddhism"
			set_variable = { state_religion_buddhism = 0 }
		}
		if = {
			limit = { NOT = { has_variable = state_religion_shinto } }
			log = "[THIS.GetName] is missing state_religion_shinto"
			set_variable = { state_religion_shinto = 0 }
		}
		if = {
			limit = { NOT = { has_variable = state_religion_christianity } }
			log = "[THIS.GetName] is missing state_religion_christianity"
			set_variable = { state_religion_christianity = 0 }
		}
		if = {
			limit = { NOT = { has_variable = state_religion_taoism } }
			log = "[THIS.GetName] is missing state_religion_taoism"
			set_variable = { state_religion_taoism = 0 }
		}
		if = {
			limit = { NOT = { has_variable = state_religion_confucianism } }
			log = "[THIS.GetName] is missing state_religion_confucianism"
			set_variable = { state_religion_confucianism = 0 }
		}
		if = {
			limit = { NOT = { has_variable = state_religion_secularism } }
			log = "[THIS.GetName] is missing state_religion_secularism"
			set_variable = { state_religion_secularism = 0 }
		}
		if = {
			limit = { NOT = { has_variable = state_religion_cthulhu } }
			log = "[THIS.GetName] is missing state_religion_cthulhu"
			set_variable = { state_religion_cthulhu = 0 }
		}
	}
}

get_official_religion_popularity = {
	set_temp_variable = { total_population = 0 }	# of core states
	set_temp_variable = { total_population_religion = 0 }	# members of official religion on core states
	
	every_owned_state = {
		if = {
			limit = { is_core_of = PREV }
			set_temp_variable = { state_population_temp = state_population_k }
			add_to_temp_variable = { PREV.total_population = state_population_temp }
			if = {
				limit = { check_variable = { PREV.country_religion = 1 } } 	# Buddhism
				multiply_temp_variable = { state_population_temp = var:state_religion_buddhism }
			}
			if = {
				limit = { check_variable = { PREV.country_religion = 2 } } 	# Shinto
				multiply_temp_variable = { state_population_temp = var:state_religion_shinto }
			}
			if = {
				limit = { check_variable = { PREV.country_religion = 3 } } 	# Christianity
				multiply_temp_variable = { state_population_temp = var:state_religion_christianity }
			}
			if = {
				limit = { check_variable = { PREV.country_religion = 4 } } 	# Taoism
				multiply_temp_variable = { state_population_temp = var:state_religion_taoism }
			}
			if = {
				limit = { check_variable = { PREV.country_religion = 5 } } 	# Confucianism
				multiply_temp_variable = { state_population_temp = var:state_religion_confucianism }
			}
			if = {
				limit = { check_variable = { PREV.country_religion = 6 } } 	# Secularism
				multiply_temp_variable = { state_population_temp = var:state_religion_secularism }
			}
			if = {
				limit = { check_variable = { PREV.country_religion = 7 } } 	# Cult of Cthulhu
				multiply_temp_variable = { state_population_temp = var:state_religion_cthulhu }
			}
			add_to_temp_variable = { PREV.total_population_religion = state_population_temp }
		}
	}
	
	set_variable = { country_official_religion_popularity = total_population_religion }
	divide_variable = { country_official_religion_popularity = total_population }
}

scale_country_religion_effect = {
	set_variable = { religion_buddhism_compliance_growth = 0 }
	set_variable = { religion_buddhism_resistance_growth = 0 }
	set_variable = { religion_buddhism_resistance_growth_on_our_occupied_states = 0 }
	set_variable = { religion_shinto_conscription = 0 }
	set_variable = { religion_shinto_surrender_limit = 0 }
	set_variable = { religion_christianity_conversion_speed = 0 }
	set_variable = { religion_christianity_resistance_growth_on_our_occupied_states = 0 }
	set_variable = { religion_taoism_stability_factor = 0 }
	set_variable = { religion_taoism_compliance_growth = 0 }
	set_variable = { religion_confucianism_political_advisor_cost = 0 }
	set_variable = { religion_confucianism_theorist_cost = 0 }
	set_variable = { religion_secularism_political_power = 0 }
	set_variable = { religion_secularism_compliance_growth = 0 }
	set_variable = { religion_cthulhu_stability_factor = 0 }
	set_variable = { religion_cthulhu_intel_factor = 0 }
	set_variable = { religion_cthulhu_research_speed = 0 }
	set_variable = { religion_cthulhu_nuke_production = 0 }
	
	if = {
		limit = { check_variable = { country_religion = 1 } } 	# Buddhism
		set_variable = { religion_buddhism_compliance_growth = global.religion_base_buddhism_compliance_growth }
		set_variable = { religion_buddhism_resistance_growth = global.religion_base_buddhism_resistance_growth }
		set_variable = { religion_buddhism_resistance_growth_on_our_occupied_states = global.religion_base_buddhism_resistance_growth_on_our_occupied_states }
		multiply_variable = { religion_buddhism_compliance_growth = country_official_religion_popularity }
		multiply_variable = { religion_buddhism_resistance_growth = country_official_religion_popularity }
		multiply_variable = { religion_buddhism_resistance_growth_on_our_occupied_states =country_official_religion_popularity }
	}
	if = {
		limit = { check_variable = { country_religion = 2 } } 	# Shinto	
		set_variable = { religion_shinto_conscription = global.religion_base_shinto_conscription }
		set_variable = { religion_shinto_surrender_limit = global.religion_base_shinto_surrender_limit }
		multiply_variable = { religion_shinto_conscription = country_official_religion_popularity }
		multiply_variable = { religion_shinto_surrender_limit = country_official_religion_popularity }
	}
	if = {
		limit = { check_variable = { country_religion = 3 } } 	# Christianity	
		set_variable = { religion_christianity_conversion_speed = global.religion_base_christianity_conversion_speed }
		set_variable = { religion_christianity_resistance_growth_on_our_occupied_states = global.religion_base_christianity_resistance_growth_on_our_occupied_states }
		multiply_variable = { religion_christianity_conversion_speed = country_official_religion_popularity }
		multiply_variable = { religion_christianity_resistance_growth_on_our_occupied_states = country_official_religion_popularity }
	}
	if = {
		limit = { check_variable = { country_religion = 4 } } 	# Taoism	
		set_variable = { religion_taoism_stability_factor = global.religion_base_taoism_stability_factor }
		set_variable = { religion_taoism_compliance_growth = global.religion_base_taoism_compliance_growth }
		multiply_variable = { religion_taoism_stability_factor = country_official_religion_popularity }
		multiply_variable = { religion_taoism_compliance_growth = country_official_religion_popularity }
	}
	if = {
		limit = { check_variable = { country_religion = 5 } } 	# Confucianism	
		set_variable = { religion_confucianism_political_advisor_cost = global.religion_base_confucianism_political_advisor_cost }
		set_variable = { religion_confucianism_theorist_cost = global.religion_base_confucianism_theorist_cost }
		multiply_variable = { religion_confucianism_political_advisor_cost = country_official_religion_popularity }
		multiply_variable = { religion_confucianism_theorist_cost = country_official_religion_popularity }
	}
	if = {
		limit = { check_variable = { country_religion = 6 } } 	# Secularism	
		set_variable = { religion_secularism_political_power = global.religion_base_secularism_political_power }
		set_variable = { religion_secularism_compliance_growth = global.religion_base_secularism_compliance_growth }
		multiply_variable = { religion_secularism_political_power = country_official_religion_popularity }
		multiply_variable = { religion_secularism_compliance_growth = country_official_religion_popularity }
	}
	if = {
		limit = { check_variable = { country_religion = 7 } } 	# Cult of Cthulhu	
		set_variable = { religion_cthulhu_stability_factor = global.religion_base_cthulhu_stability_factor }
		set_variable = { religion_cthulhu_intel_factor = global.religion_base_cthulhu_intel_factor }
		set_variable = { religion_cthulhu_research_speed = global.religion_base_cthulhu_research_speed }
		set_variable = { religion_cthulhu_nuke_production = global.religion_base_cthulhu_nuke_production }
		multiply_variable = { religion_cthulhu_stability_factor = country_official_religion_popularity }
		multiply_variable = { religion_cthulhu_intel_factor = country_official_religion_popularity }
		multiply_variable = { religion_cthulhu_research_speed = country_official_religion_popularity }
		multiply_variable = { religion_cthulhu_nuke_production = country_official_religion_popularity }
	}
}

set_country_religion_modifier = {
	if = {
		limit = { check_variable = { country_religion = 1 } } 	# Buddhism
		add_dynamic_modifier = { modifier = religion_buddhism_modifier }
	} else = { if = {
		limit = { has_dynamic_modifier = { modifier = religion_buddhism_modifier } }
		remove_dynamic_modifier = { modifier = religion_buddhism_modifier }
	} }
	if = {
		limit = { check_variable = { country_religion = 2 } } 	# Shinto
		add_dynamic_modifier = { modifier = religion_shinto_modifier }
	} else = { if = {
		limit = { has_dynamic_modifier = { modifier = religion_shinto_modifier } }
		remove_dynamic_modifier = { modifier = religion_shinto_modifier }
	} }
	if = {
		limit = { check_variable = { country_religion = 3 } } 	# Christianity
		add_dynamic_modifier = { modifier = religion_christianity_modifier }
	} else = { if = {
		limit = { has_dynamic_modifier = { modifier = religion_christianity_modifier } }
		remove_dynamic_modifier = { modifier = religion_christianity_modifier }
	} }
	if = {
		limit = { check_variable = { country_religion = 4 } } 	# Taoism
		add_dynamic_modifier = { modifier = religion_taoism_modifier }
	} else = { if = {
		limit = { has_dynamic_modifier = { modifier = religion_taoism_modifier } }
		remove_dynamic_modifier = { modifier = religion_taoism_modifier }
	} }
	if = {
		limit = { check_variable = { country_religion = 5 } } 	# Confucianism
		add_dynamic_modifier = { modifier = religion_confucianism_modifier }
	} else = { if = {
		limit = { has_dynamic_modifier = { modifier = religion_confucianism_modifier } }
		remove_dynamic_modifier = { modifier = religion_confucianism_modifier }
	} }
	if = {
		limit = { check_variable = { country_religion = 6 } } 	# Secularism
		add_dynamic_modifier = { modifier = religion_secularism_modifier }
	} else = { if = {
		limit = { has_dynamic_modifier = { modifier = religion_secularism_modifier } }
		remove_dynamic_modifier = { modifier = religion_secularism_modifier }
	} }
	if = {
		limit = { check_variable = { country_religion = 7 } } 	# Cult of Cthulhu
		add_dynamic_modifier = { modifier = religion_cthulhu_modifier }
	} else = { if = {
		limit = { has_dynamic_modifier = { modifier = religion_cthulhu_modifier } }
		remove_dynamic_modifier = { modifier = religion_cthulhu_modifier }
	} }
	if = {
		limit = { NOT = { has_variable = country_religion } }
		log = "[THIS.GetName] does not have an official religion"
	}
}