add_namespace = shogunate
add_namespace = sho_assembly

country_event = {	# Opening Congress (never fires, it's just to avoid a spolier in the focus tree)
	id = shogunate.1001
	title = shogunate.1001.t
	desc = "this should not appear"
	picture = GFX_report_event_yamamoto_1
	
	is_triggered_only = yes
	
	option = {
		name = "this should not appear"
	}
}


country_event = {	# Assassination (automatic event)
	id = shogunate.1
	title = shogunate.1.t
	desc = shogunate.1.d
	picture = GFX_report_event_yamamoto_1
	
	is_triggered_only = no
	major = yes
	
	trigger = {
		has_country_leader = {
			character = SHO_tokugawa_iesato
			ruling_only = yes
		}
		NOT = { focus_progress = { focus = SHO_call_congress progress > 0.01 } focus_progress = { focus = SHO_suppress_opposition progress > 0.01 } focus_progress = { focus = SHO_burakumin_terrorists progress > 0.01 } }
		NOT = {
			focus_progress = {
				focus = SHO_call_congress
				progress > 0.5
			}
			focus_progress = {
				focus = SHO_suppress_opposition
				progress > 0.5
			}
			focus_progress = {
				focus = SHO_burakumin_terrorists
				progress > 0.01
			}
		}
		date > 1936.10.20
	}
	
	mean_time_to_happen = {
		days = 140
		modifier = {
			factor = 0.5
			autocracy < 0.5
		}
	}
	
	immediate = {
		hidden_efect = {
			SHO = {
				set_country_flag = shogun_assassination_attempt_happened
				hidden_effect = {
					remove_country_leader_role = {
						character = SHO_tokugawa_iesato	# we don't kill him right here and now because it would make easier for tooltipping to have him loose his role. he actually dies (offscreem) in the next event
						ideology = autocracy_subtype
					}
				}
				unlock_national_focus = SHO_call_congress
			}
		}
	}
	
	option = {
		name = shogunate.1.self
		trigger = { tag = SHO }
		effect_tooltip = {
			SHO_tokugawa_iesato = {
				custom_effect_tooltip = character_dies
			}
			custom_effect_tooltip = loc_paragraph
			custom_effect_tooltip = trigger_succession_crisis_tt
			add_stability = -0.1
		}
		hidden_effect = {
			remove_country_leader_role = {
				character = SHO_tokugawa_iesato	# we don't kill him right here and now because it would make easier for tooltipping to have him loose his role. he actually dies (offscreem) in the next event
				ideology = autocracy_subtype
			}
		}
	}
	option = {
		name = shogunate.1.kan
		trigger = { tag = KAN }
		effect_tooltip = {
			SHO = {
				SHO_tokugawa_iesato = {
					custom_effect_tooltip = character_dies
				}
			}
		}
		custom_effect_tooltip = loc_paragraph
		custom_effect_tooltip = shogunate.2.kantt
	}
	option = {
		name = shogunate.1.other
		trigger = { NOT = { tag = SHO tag = KAN } }
		effect_tooltip = {
			SHO = {
				SHO_tokugawa_iesato = {
					custom_effect_tooltip = character_dies
				}
			}
		}
		if = {
			limit = { has_global_flag = eastereggs_enabled }
			custom_effect_tooltip = shogunate.2.f
		}
	}
}

country_event = {	# Assassination (focus event)
	id = shogunate.2
	title = shogunate.2.t
	desc = shogunate.2.d
	picture = GFX_report_event_yamamoto_1
	
	is_triggered_only = yes
	major = yes
	
	immediate = {
		hidden_effect = {
			SHO = {
				set_country_flag = shogun_assassination_attempt_happened
				hidden_effect = {
					remove_country_leader_role = {
						character = SHO_tokugawa_iesato	# we don't kill him right here and now because it would make easier for tooltipping to have him loose his role. he actually dies (offscreem) in the next event
						ideology = autocracy_subtype
					}
				}
			}
		}
	}
	
	option = {
		name = shogunate.2.self
		trigger = { tag = SHO }
		effect_tooltip = {
			SHO_tokugawa_iesato = {
				custom_effect_tooltip = character_dies
			}
			custom_effect_tooltip = loc_paragraph
			custom_effect_tooltip = trigger_succession_crisis_tt
			add_stability = -0.1
		}
	}
	option = {
		name = shogunate.2.kan
		trigger = { tag = KAN }
		effect_tooltip = {
			SHO = {
				SHO_tokugawa_iesato = {
					custom_effect_tooltip = character_dies
				}
			}
		}
		custom_effect_tooltip = loc_paragraph
		custom_effect_tooltip = shogunate.2.kantt
	}
	option = {
		name = shogunate.2.other
		trigger = { NOT = { tag = SHO tag = KAN } }
		effect_tooltip = {
			SHO = {
				SHO_tokugawa_iesato = {
					custom_effect_tooltip = character_dies
				}
			}
		}
		if = {
			limit = { has_global_flag = eastereggs_enabled }
			custom_effect_tooltip = loc_paragraph
			custom_effect_tooltip = shogunate.2.f
		}
	}
}

country_event = {	# Congress, appoint successor (automatic event) [note: the focus-triggered event does not lead to this option, since there are specific focuses for each candidate]
	id = shogunate.3
	title = shogunate.3.t
	desc = shogunate.3.d
	picture = GFX_report_event_yamamoto_1
	
	is_triggered_only = no
	
	trigger = {
		has_country_flag = shogun_assassination_attempt_happened
		date > 1936.06.10
		NOT = {
			focus_progress = { focus = SHO_successor_owari progress > 0.01 }
			focus_progress = { focus = SHO_successor_mito progress > 0.01 }
			focus_progress = { focus = SHO_successor_kii progress > 0.01 }
		}
		NOT = {
			has_completed_focus = SHO_successor_owari
			has_completed_focus = SHO_successor_mito
			has_completed_focus = SHO_successor_kii
		}
	}
	
	mean_time_to_happen = {
		days = 70
	}
	
	immediate = { hidden_effect = { retire_character = SHO_tokugawa_iesato } }
	
	option = {
		name = shogunate.3.autocracy
		trigger = { NOT = { focus_progress = { focus = SHO_successor_kii progress > 0.01 } focus_progress = { focus = SHO_successor_owari progress > 0.01 } } }
		if = {
			limit = { focus_progress = { focus = SHO_successor_mito progress > 0.5 } }
			complete_national_focus = SHO_successor_mito
		} else = {
			SHO_tokugawa_kuniyuki = {
				custom_effect_tooltip = become_secondary_leader
				custom_effect_tooltip = loc_paragraph
				effect_tooltip = { add_trait = { ideology = autocracy_subtype trait = persuasive_monarchist } }
			}
			hidden_effect = {
				SHO_council_of_roju = {
					set_character_flag = dual_leader_id_tokugawa_kuniyuki
					set_character_flag = dual_leader_second_title_regent
				}
				add_ideas = persuasive_monarchist_spirit
			}
			unlock_national_focus = SHO_successor_mito
			custom_effect_tooltip = loc_paragraph
			custom_effect_tooltip = effect_succession_crisis_tt
			add_stability = -0.1
		}
	}
	option = {
		name = shogunate.3.democratic
		trigger = { NOT = { focus_progress = { focus = SHO_successor_mito progress > 0.01 } focus_progress = { focus = SHO_successor_owari progress > 0.01 } } }
		if = {
			limit = { focus_progress = { focus = SHO_successor_kii progress > 0.5 } }
			complete_national_focus = SHO_successor_kii
		} else = {
			promote_character = SHO_tokugawa_yorisada
			SHO_tokugawa_yorisada = {
				custom_effect_tooltip = become_secondary_leader
				custom_effect_tooltip = loc_paragraph
				effect_tooltip = { add_trait = { ideology = conservatism trait = democratic_reformer } }
			}
			hidden_effect = {
				SHO_council_of_roju = {
					set_character_flag = democratic_reformer_secondary
					set_character_flag = dual_leader_id_tokugawa_yorisada
					set_character_flag = dual_leader_second_title_regent
				}
				add_ideas = democratic_reformer_spirit
			}
			unlock_national_focus = SHO_successor_kii
			custom_effect_tooltip = loc_paragraph
			custom_effect_tooltip = effect_succession_crisis_tt
			add_stability = -0.1
			set_country_flag = allowed_path_democratic	# this is for allowing advisers
			clr_country_flag = initial_ideology_autocracy
		}
	}
	option = {
		name = shogunate.3.fascism
		trigger = { NOT = { focus_progress = { focus = SHO_successor_mito progress > 0.01 } focus_progress = { focus = SHO_successor_kii progress > 0.01 } } }
		if = {
			limit = { focus_progress = { focus = SHO_successor_owari progress > 0.5 } }
			complete_national_focus = SHO_successor_owari
		} else = {
			promote_character = SHO_tokugawa_yoshichika
			SHO_tokugawa_yoshichika = {
				custom_effect_tooltip = become_secondary_leader
				custom_effect_tooltip = loc_paragraph
				effect_tooltip = { add_trait = { ideology = fascism_ideology trait = fascist_demagogue } }
			}
			hidden_effect = {
				SHO_council_of_roju = {
					set_character_flag = fascist_demagogue_secondary
					set_character_flag = dual_leader_id_tokugawa_yoshichika
					set_character_flag = dual_leader_second_title_regent
				}
				add_ideas = fascist_demagogue_spirit
			}
			unlock_national_focus = SHO_successor_owari
			custom_effect_tooltip = loc_paragraph
			custom_effect_tooltip = effect_succession_crisis_tt
			add_stability = -0.1
			set_country_flag = allowed_path_fascism	# this is for allowing advisers
			clr_country_flag = initial_ideology_autocracy
		}
	}
}

country_event = {	# Build Coalition event
	id = shogunate.4
	title = shogunate.4.t
	desc = shogunate.4.d
	picture = GFX_report_event_yamamoto_1
	
	is_triggered_only = yes
	
	option = {
		name = shogunate.4.democratic
		trigger = { has_completed_focus = SHO_successor_kii }
		custom_effect_tooltip = "slow but steady democratic support"
		SHO_osachi_hamaguchi = {
			custom_effect_tooltip = shogunate.4.switcheroo_tt
		}
		set_country_flag = shogunate_build_coalition_democratic
	}
	option = {
		name = shogunate.4.fascism
		trigger = { has_completed_focus = SHO_successor_owari }
		custom_effect_tooltip = "slow but steady democratic support"
		SHO_mitsuru_toyama = {
			custom_effect_tooltip = shogunate.4.switcheroo_tt
		}
		set_country_flag = shogunate_build_coalition_fascism
	}
	option = {
		name = shogunate.4.communism
		trigger = { has_completed_focus = SHO_successor_kii }
		add_popularity = {
			ideology = democratic
			popularity = 0.1
		}
		SHO_sakai_toshihiko = {	# change later
			custom_effect_tooltip = shogunate.4.switcheroo_tt
		}
		set_country_flag = shogunate_build_coalition_communism
	}
	option = {
		name = shogunate.4.neutrality
		if = {
			limit = { has_completed_focus = SHO_successor_owari }
			add_popularity = {
				ideology = fascism
				popularity = 0.1
			}
		} else = {
			add_popularity = {
				ideology = democratic
				popularity = 0.1
			}
		}
		SHO_senjuro_hayashi = {
			custom_effect_tooltip = shogunate.4.switcheroo_tt
		}
		set_country_flag = shogunate_build_coalition_neutrality
	}
	option = {
		name = shogunate.4.autocarcy
		trigger = { has_completed_focus = SHO_successor_owari }
		add_popularity = {
			ideology = fascism
			popularity = 0.1
		}
		SHO_tokugawa_kuniyuki = {
			custom_effect_tooltip = shogunate.4.switcheroo_tt
		}
		set_country_flag = shogunate_build_coalition_autocracy
	}
}

country_event = {	# Officers Purged (AMO event, cosmetic)
	id = shogunate.5
	title = shogunate.5.t
	desc = shogunate.5.d
	picture = GFX_report_event_yamamoto_1
	
	is_triggered_only = yes
	
	option = {
		name = shogunate.5.a
		effect_tooltip = {
			add_days_mission_timeout = {
				mission = AMO_countdown_to_war
				days = 30
			}
		}
		custom_effect_tooltip = SHO_army_purge_disloyalty_tt
	}
}

country_event = {	# Officers Purged (SHO event, kills officer)
	id = shogunate.6
	title = shogunate.6.t
	desc = shogunate.6.d
	picture = GFX_report_event_yamamoto_1
	
	is_triggered_only = yes
	
	option = {
		name = shogunate.6.a
		character_list_tooltip = {
			limit = {
				has_character_flag = SHO_kill_this_character
			}
			clr_character_flag = SHO_kill_this_character
			custom_effect_tooltip = character_executed
		}
		hidden_effect = { retire_character = var:char_kill_id }
	}
}

country_event = {	# Shogun is Sick
	id = shogunate.101
	title = shogunate.101.t
	desc = shogunate.101.d
	picture = GFX_report_event_yamamoto_1
	
	fire_only_once = yes
	
	trigger = {
		tag = SHO
		has_country_leader = {
			character = SHO_tokugawa_iesato
			ruling_only = yes
		}
		date > 1938.6.1
	}
	
	mean_time_to_happen = {
		years = 2
		modifier = {
			factor = 0.5
			SHO = {
				SHO_tokugawa_iesato = {
					OR = {
						has_trait = wounded
						has_trait = sick
					}
				}
			}
		}
	}
	
	immediate = { hidden_effect = { SHO = { set_country_flag = SHO_shogun_is_sick } } }
	
	option = {
		name = shogunate.101.a
		add_trait = {
			 character = SHO_tokugawa_iesato
			 ideology = autocracy_subtype
			 trait = severely_ill_leader
		}
		hidden_effect = { add_trait = { character = SHO_tokugawa_iesato trait = severely_ill_commander } }
	}
}

country_event = {	# Shogun Dies!
	id = shogunate.102
	title = shogunate.102.t
	desc = shogunate.102.d
	picture = GFX_report_event_yamamoto_1
	
	fire_only_once = yes
	
	trigger = {
		tag = SHO
		set_country_flag = SHO_shogun_is_sick
		SHO = { has_character = SHO_tokugawa_iesato }
	}
	
	mean_time_to_happen = {
		years = 2
		modifier = {
			factor = 0.1
			SHO = {
				SHO_tokugawa_iesato = {
					OR = {
						has_trait = wounded
						has_trait = sick
					}
				}
			}
		}
	}
	
	immediate = { hidden_effect = { SHO = { clr_country_flag = SHO_shogun_is_sick } } 
	
	option = {
		trigger = { tag = SHO }
		name = shogunate.102.self
		hidden_effect = { retire_character = SHO_tokugawa_iesato }
		SHO_tokugawa_iesato = { custom_effect_tooltip = character_dies }
		custom_effect_tooltip = loc_paragraph
		promote_character = {
			character = SHO_tokugawa_iemasa
			ideology = autocracy_subtype
		}
		add_timed_idea = { idea = SHO_shogun_died_recently_spirit days = 180 }
		custom_effect_tooltip = loc_paragraph
		custom_effect_tooltip = shogunate.102.tt
	}
	
	option = {
		trigger = { tag = KAN }
		name = shogunate.102.kan
		effect_tooltip = {
			hidden_effect = { retire_character = SHO_tokugawa_iesato }
			SHO_tokugawa_iesato = { custom_effect_tooltip = character_dies }
			custom_effect_tooltip = loc_paragraph
			promote_character = {
				character = SHO_tokugawa_iemasa
				ideology = autocracy_subtype
			}
		}
	}
	option = {
		trigger = {
			NOT = { tag = SHO tag = KAN }
			NOT ={ SHO = { has_country_flag = SHO_clear_reputation } }
		}
		name = shogunate.102.other1
		effect_tooltip = {
			hidden_effect = { retire_character = SHO_tokugawa_iesato }
			SHO_tokugawa_iesato = { custom_effect_tooltip = character_dies }
			custom_effect_tooltip = loc_paragraph
			promote_character = {
				character = SHO_tokugawa_iemasa
				ideology = autocracy_subtype
			}
		}
	}
	option = {
		trigger = {
			NOT = { tag = SHO tag = KAN }
			SHO = { has_country_flag = SHO_clear_reputation }
		}
		name = shogunate.102.other2
		effect_tooltip = {
			hidden_effect = { retire_character = SHO_tokugawa_iesato }
			SHO_tokugawa_iesato = { custom_effect_tooltip = character_dies }
			custom_effect_tooltip = loc_paragraph
			promote_character = {
				character = SHO_tokugawa_iemasa
				ideology = autocracy_subtype
			}
		}
	}
}