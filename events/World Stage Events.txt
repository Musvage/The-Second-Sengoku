### EVENTS for diplomatic and military plays in the WORLD STAGE
												  #and we are merely players
add_namespace = worldstage 						  #performers and portrayers
add_namespace = worldstage_automatic			  #each anothers audience outside the gilded cage										  
add_namespace = worldstage_surrender
add_namespace = worldstage_exhaust

########################################################################
############################## worldstage ##############################	# the ones here are actually in the game
########################################################################

### SPANISH CIVIL WAR

# Spanish Civil War - Start
news_event = {
	id = worldstage.4
	title = worldstage.4.t
	desc = worldstage.4.d 
	picture = GFX_news_event_spr_spanish_civil_war

	is_triggered_only = yes

	major = yes
	
	immediate = {
		set_global_flag = world_stage_theater_spanish_cw_is_active
	}
	
	option = {
		name = worldstage.4.axis
		trigger = {
			has_government = fascism
		}
	}
	option = {
		name = worldstage.4.komin
		trigger = {
			has_government = communism
		}
	}
	option = {
		name = worldstage.4.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
	}
}

# Spanish Civil War - Guernica
news_event = {
	id = worldstage.10
	title = worldstage.10.t
	desc = worldstage.10.d 
	picture = GFX_worldstage_news_guernica

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	# immediate = {
		# add_to_variable = { global.REP_strength_spain = -1 }
	# }
	
	option = {
		name = worldstage.10.axis
		trigger = {
			has_government = fascism
		}
		custom_effect_tooltip = worldstage.10.tt2
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_falange }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.5
				# category = air_doctrine
			# }
		# }
		# effect_tooltip = {
			# custom_effect_tooltip = country_name_republica
			# add_to_variable = {
				# global.REP_strength_spain = -1
				# tooltip = world_stage_add_local_power
			# }
		# }
	}
	option = {
		name = worldstage.10.komin
		trigger = {
			has_government = communism
		}
		custom_effect_tooltip = worldstage.10.tt1
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_falange }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.5
				# category = air_doctrine
			# }
		# }
		# effect_tooltip = {
			# custom_effect_tooltip = country_name_republica
			# add_to_variable = {
				# global.REP_strength_spain = -1
				# tooltip = world_stage_add_local_power
			# }
		# }
	}
	option = {
		name = worldstage.10.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		custom_effect_tooltip = worldstage.10.tt1
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_falange }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.5
				# category = air_doctrine
			# }
		# }
		# effect_tooltip = {
			# custom_effect_tooltip = country_name_republica
			# add_to_variable = {
				# global.REP_strength_spain = -1
				# tooltip = world_stage_add_local_power
			# }
		# }
	}
}

# Spanish Civil War - Falange Wins
news_event = {
	id = worldstage.12
	title = worldstage.12.t
	desc = worldstage.12.d 
	picture = GFX_news_event_033

	is_triggered_only = yes

	major = yes
	
	immediate = { clr_global_flag = world_stage_theater_spanish_cw_is_active }
	
	option = {
		name = worldstage.12.axis
		trigger = {
			has_government = fascism
		}
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_falange }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = air_doctrine
			# }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = land_doctrine
			# }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = naval_doctrine
			# }
		# }
	}
	option = {
		name = worldstage.12.komin
		trigger = {
			has_government = communism
		}
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_republica }	# maybe check a tag....
			# GETS EXILED REPUBLICAN GENERALS
		# }
	}
	option = {
		name = worldstage.12.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_falange }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = air_doctrine
			# }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.9
				# category = land_doctrine
			# }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = naval_doctrine
			# }
		# }
	}
}

### MONGOLIA MEDDLING

# ROC wins in Mongolia
news_event = {
	id = worldstage.2
	title = worldstage.2.t
	desc = worldstage.2.d
	picture = GFX_worldstage_news_mongolian_nationalists

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			2 = { set_variable = { theater_owner = 106 } set_variable = { theater_owner_coalition = 106.world_stage_coalition } }
		}
	}
	
	option = {
		name = worldstage.2.axis
		trigger = {
			OR = { has_government = fascism tag = ROC }
		}
		custom_effect_tooltip = worldstage.2.tt
	}
	option = {
		name = worldstage.2.komin
		trigger = {
			OR = { has_government = communism tag = FER }
		}
		custom_effect_tooltip = worldstage.2.tt
	}
	option = {
		name = worldstage.2.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
				tag = ROC
				tag = FER
			}
		}
		custom_effect_tooltip = worldstage.2.tt
	}
}

# SOV wins in Mongolia: this is the default, if ROC does not interfere
news_event = {
	id = worldstage.3
	title = worldstage.3.t
	desc = worldstage.3.d
	picture = GFX_worldstage_news_mongolian_communist

	is_triggered_only = no
	fire_only_once = yes
	
	trigger = {
		ROC = {
			NOT = {
				has_completed_focus = ROC_aid_mongolia
				focus_progress = { focus = ROC_aid_mongolia progress > 0.01 }
			}
		}
		date > 1937.1.1
	}
	
	mean_time_to_happen = {
		days = 180
		modifier = {
			factor = 0.5
			threat > 0.25
		}
		modifier = {
			factor = 0.01
			REI = { has_completed_focus = REI_sudetenland }	# we need to wrap this up before WWII
		}
	}

	major = yes
	
	immediate = {
		hidden_effect = {
			2 = { set_variable = { theater_owner = 104 } set_variable = { theater_owner_coalition = 104.world_stage_coalition } }
		}
	}
	
	option = {
		name = worldstage.3.axis
		trigger = {
			OR = { has_government = fascism tag = ROC }
		}
		custom_effect_tooltip = worldstage.3.tt
	}
	option = {
		name = worldstage.3.komin
		trigger = {
			has_government = communism
		}
		custom_effect_tooltip = worldstage.3.tt
	}
	option = {
		name = worldstage.3.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
				tag = ROC
			}
		}
		custom_effect_tooltip = worldstage.3.tt
	}
}

### INVASION OF POLAND

# Invasion of Poland - Start of WW2
news_event = {
	id = worldstage.15
	title = worldstage.15.t
	desc = {
		text = worldstage.15.d1
		trigger = { NOT = { REI = { has_government = autocracy } } }	# normal event
	}
	desc = {
		text = worldstage.15.d2
		trigger = { REI = { has_government = autocracy } } 			# monarchist event (cannot use 2nd leader text)
	}
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					country_exists = OSA
					country_exists = KOB
					NOT = { KOB = { is_in_faction_with = OSA } }
				}
				OSA = { add_to_faction = KOB }
			}
			set_global_flag = world_stage_phoney_war_rages_on
			every_possible_country = {
				limit = { tag = OSA }
				country_event = { id = britishosaka.1 days = 120 random = 60 }	# Churchil or Chamberlain? Note: replace this event being fired by the OSA tree itself, when we make its Expansion DLC
			}
			if = {
				limit = { ROC = { NOT = { has_war_with = OSA has_war_with = OKI has_war_with = AMC has_war_with = KOB has_war_with = REI has_war_with = HIR has_war_with = PRT } } }
				set_global_flag = modus_vivendi_pacific
				ROC = { country_event = { id = worldstage.79 hours = 12 } }
			}
			every_country = {
				limit = { check_variable = { world_stage_metropolis > 100 } }
				if = {
					limit = {
						OR = {
							tag = KOB
							tag = OSA
							has_country_flag = will_join_allies
						}
					}
					activate_mission = world_stage_phoney_war_countdown_allies
				} else = {	# everyone else gets the axis versions
					activate_mission = world_stage_phoney_war_countdown_axis
				}
			}
			# ACTIVATE AIs
			101 = { set_state_flag = worldstage_AI_active }	# germany
			115 = { set_state_flag = worldstage_AI_active }	# poland	# other allies do not start due to Phoney War
		}
	}
	
	option = {
		name = worldstage.15.axis
		trigger = { OR = { check_variable = { world_stage_coalition = 3 } check_variable = { world_stage_coalition = 6 } } }
		if = {
			limit = { check_variable = { world_stage_metropolis > 100 } }
			effect_tooltip = { activate_mission = world_stage_phoney_war_countdown_axis }
		}
	}
	option = {
		name = worldstage.15.komin1
		trigger = {
			check_variable = { world_stage_coalition = 2 }
			NOT = { has_global_flag = GER_SOV_pact_enabled }
		}
		if = {
			limit = { check_variable = { world_stage_metropolis > 100 } }
			effect_tooltip = { activate_mission = world_stage_phoney_war_countdown_axis }
		}
	}
	option = {
		name = worldstage.15.komin2
		trigger = {
			check_variable = { world_stage_coalition = 2 }
			has_global_flag = GER_SOV_pact_enabled
		}
		if = {
			limit = { check_variable = { world_stage_metropolis > 100 } }
			effect_tooltip = { activate_mission = world_stage_phoney_war_countdown_axis }
		}
	}
	option = {
		name = worldstage.15.allies
		trigger = { OR = { check_variable = { world_stage_coalition = 1 } check_variable = { world_stage_coalition = 5 } } }
		if = {
			limit = { check_variable = { world_stage_metropolis > 100 } }
			effect_tooltip = { activate_mission = world_stage_phoney_war_countdown_axis }
		}
	}
	option = {
		name = worldstage.15.other
		trigger = {
			OR = { check_variable = { world_stage_coalition = 4 } NOT = { has_variable = world_stage_coalition } }
		}
		if = {
			limit = { check_variable = { world_stage_metropolis > 100 } }
			effect_tooltip = { activate_mission = world_stage_phoney_war_countdown_axis }
		}
	}
}

# Invasion of Poland - Soviet Invasion
news_event = {
	id = worldstage.16
	title = worldstage.16.t
	desc = worldstage.16.d 
	picture = GFX_news_nazi_soviet_handshake_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			 3 = { world_stage_end_round_axis_victory = yes }
			 115 = { clr_state_flag = worldstage_AI_active }	# poland
		}
	}
	
	option = {
		name = worldstage.16.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		custom_effect_tooltip = theater_scope_poland
		custom_effect_tooltip = worldstage.16.tt_green
		custom_effect_tooltip = worldstage.16.tt_inactive
	}
	option = {
		name = worldstage.16.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		custom_effect_tooltip = theater_scope_poland
		custom_effect_tooltip = worldstage.16.tt_green
		custom_effect_tooltip = worldstage.16.tt_inactive
	}
	option = {
		name = worldstage.16.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		custom_effect_tooltip = theater_scope_poland
		custom_effect_tooltip = worldstage.16.tt_red
		custom_effect_tooltip = worldstage.16.tt_inactive
	}
	option = {
		name = worldstage.16.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		custom_effect_tooltip = theater_scope_poland
		custom_effect_tooltip = worldstage.16.tt_orange
		custom_effect_tooltip = worldstage.16.tt_inactive
	}
}

# Invasion of Germany - Phoney War Ends!	# Saarland Offensive
news_event = {
	id = worldstage.21
	title = worldstage.21.t
	desc = worldstage.21.d 
	picture = GFX_news_ww2_saarland_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			clr_global_flag = world_stage_phoney_war_rages_on
			103 = {
				set_temp_variable = { french_forces = world_stage_power }
				clamp_temp_variable = { var = french_forces min = 0 max = 90 }
				round_temp_variable = french_forces
				subtract_from_variable = { world_stage_power = french_forces }
			}
			101 = {
				set_temp_variable = { german_forces = world_stage_power }
				divide_temp_variable = { german_forces = 2 }
				round_temp_variable = german_forces
				clamp_temp_variable = { var = german_forces min = 0 max = 60 }
				subtract_from_variable = { world_stage_power = german_forces }
			}
			6 = { # proxy for Western Germany
				set_state_flag = theater_is_active
				add_to_variable = { world_stage_power_deployed_by^103 = french_forces }
				add_to_variable = { world_stage_power_deployed_by^101 = german_forces }
				set_variable = { coalition_side_attack = 1 }
				world_stage_state_update_current_day = yes
			}
			news_event = worldstage.53
			news_event = { id = worldstage.22 days = 7 random_days = 7 }	# Italy Joins the War	# TODO TO-DO TO DO make specific event for Italy Joining the War after Saarland
			### ACTIVATE AIs
			102 = { set_state_flag = worldstage_AI_active } # england
			103 = { set_state_flag = worldstage_AI_active } # france
			109 = { set_state_flag = worldstage_AI_active } # italy
		}
	}
	
	option = {
		name = worldstage.21.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		hidden_effect = {	6 = { set_temp_variable = { ger_for = world_stage_power_deployed_by^101 } }
							6 = { set_temp_variable = { fra_for = world_stage_power_deployed_by^103 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_westphalia
			custom_effect_tooltip = world_stage_activate_theater_tt
			custom_effect_tooltip = metropolis_scope_france
			subtract_from_variable = {
				103.world_stage_power = fra_for
				tooltip = world_stage_deploy_power_westphalia_space
			}
			custom_effect_tooltip = metropolis_scope_germany
			subtract_from_variable = {	#
				101.world_stage_power = ger_for
				tooltip = world_stage_deploy_power_westphalia_space
			}
		}
	}
	option = {
		name = worldstage.21.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		hidden_effect = {	6 = { set_temp_variable = { ger_for = world_stage_power_deployed_by^101 } }
							6 = { set_temp_variable = { fra_for = world_stage_power_deployed_by^103 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_westphalia
			custom_effect_tooltip = world_stage_activate_theater_tt
			custom_effect_tooltip = metropolis_scope_france
			subtract_from_variable = {
				103.world_stage_power = fra_for
				tooltip = world_stage_deploy_power_westphalia_space
			}
			custom_effect_tooltip = metropolis_scope_germany
			subtract_from_variable = {	#
				101.world_stage_power = ger_for
				tooltip = world_stage_deploy_power_westphalia_space
			}
		}
	}
	option = {
		name = worldstage.21.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		hidden_effect = {	6 = { set_temp_variable = { ger_for = world_stage_power_deployed_by^101 } }
							6 = { set_temp_variable = { fra_for = world_stage_power_deployed_by^103 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_westphalia
			custom_effect_tooltip = world_stage_activate_theater_tt
			custom_effect_tooltip = metropolis_scope_france
			subtract_from_variable = {
				103.world_stage_power = fra_for
				tooltip = world_stage_deploy_power_westphalia_space
			}
			custom_effect_tooltip = metropolis_scope_germany
			subtract_from_variable = {	#
				101.world_stage_power = ger_for
				tooltip = world_stage_deploy_power_westphalia_space
			}
		}
	}
	option = {
		name = worldstage.21.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		hidden_effect = {	6 = { set_temp_variable = { ger_for = world_stage_power_deployed_by^101 } }
							6 = { set_temp_variable = { fra_for = world_stage_power_deployed_by^103 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_westphalia
			custom_effect_tooltip = world_stage_activate_theater_tt
			custom_effect_tooltip = metropolis_scope_france
			subtract_from_variable = {
				103.world_stage_power = fra_for
				tooltip = world_stage_deploy_power_westphalia_space
			}
			custom_effect_tooltip = metropolis_scope_germany
			subtract_from_variable = {	#
				101.world_stage_power = ger_for
				tooltip = world_stage_deploy_power_westphalia_space
			}
		}
	}
}

# Italy Joins the War
news_event = {
	id = worldstage.22
	title = worldstage.22.t
	desc = worldstage.22.d 
	picture = GFX_news_ww2_italy_wide

	is_triggered_only = yes

	major = yes major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			tag = REI tag = OSA tag = KOB
		}
	}
	
	immediate = {
		hidden_effect = {
			set_temp_variable = { england_army = var:102.world_stage_power }
			divide_temp_variable = { england_army = 10 }
			round_temp_variable = england_army
			subtract_from_variable = { var:102.world_stage_power = england_army }
			set_temp_variable = { italy_army = var:109.world_stage_power }
			divide_temp_variable = { italy_army = 3 }
			round_temp_variable = italy_army
			subtract_from_variable = { var:109.world_stage_power = italy_army }
			15 = {
				set_state_flag = theater_is_active
				add_to_variable = { world_stage_power_deployed_by^102 = england_army } log = "Italy joins the war: england_army [?england_army] X italy_army [?italy_army]"
				add_to_variable = { world_stage_power_deployed_by^109 = italy_army }
				set_variable = { coalition_side_attack = 3 }
				world_stage_state_update_current_day = yes
			}
			109 = { set_state_flag = worldstage_AI_active }
		}
	}
	
	option = {
		name = worldstage.22.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			custom_effect_tooltip = world_stage_theater_lybia_is_active_tt
			#custom_effect_tooltip = world_stage_theater_alpes_is_active_tt
			#custom_effect_tooltip = world_stage_theater_ethiopia_is_active_tt
		}
	}
	option = {
		name = worldstage.22.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			custom_effect_tooltip = world_stage_theater_lybia_is_active_tt
			#custom_effect_tooltip = world_stage_theater_alpes_is_active_tt
			#custom_effect_tooltip = world_stage_theater_ethiopia_is_active_tt
		}
	}
	option = {
		name = worldstage.22.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		effect_tooltip = {
			custom_effect_tooltip = world_stage_theater_lybia_is_active_tt
			#custom_effect_tooltip = world_stage_theater_alpes_is_active_tt
			#custom_effect_tooltip = world_stage_theater_ethiopia_is_active_tt
		}
	}
	option = {
		name = worldstage.22.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			custom_effect_tooltip = world_stage_theater_lybia_is_active_tt
			#custom_effect_tooltip = world_stage_theater_alpes_is_active_tt
			#custom_effect_tooltip = world_stage_theater_ethiopia_is_active_tt
		}
	}
}

# The Blitzkrieg!
news_event = {
	id = worldstage.24
	title = worldstage.24.t
	desc = worldstage.24.d 
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes #show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	immediate = {
		hidden_effect = {
			### ACTIVATE AIs
			102 = { set_state_flag = worldstage_AI_active } # england
			103 = { set_state_flag = worldstage_AI_active } # france
			109 = { set_state_flag = worldstage_AI_active } # italy
		}
	}
	
	option = {
		name = worldstage.24.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		hidden_effect = {	5 = { set_temp_variable = { ger_for = world_stage_power_deployed_by^101 } }
							5 = { set_temp_variable = { fra_for = world_stage_power_deployed_by^103 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_alsace
			custom_effect_tooltip = world_stage_activate_theater_tt
			custom_effect_tooltip = metropolis_scope_france
			subtract_from_variable = {
				103.world_stage_power = fra_for
				tooltip = world_stage_deploy_power_alsace_space
			}
			custom_effect_tooltip = metropolis_scope_germany
			subtract_from_variable = {	#
				101.world_stage_power = ger_for
				tooltip = world_stage_deploy_power_alsace_space
			}
		}
	}
	option = {
		name = worldstage.24.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		hidden_effect = {	5 = { set_temp_variable = { ger_for = world_stage_power_deployed_by^101 } }
							5 = { set_temp_variable = { fra_for = world_stage_power_deployed_by^103 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_alsace
			custom_effect_tooltip = world_stage_activate_theater_tt
			custom_effect_tooltip = metropolis_scope_france
			subtract_from_variable = {
				103.world_stage_power = fra_for
				tooltip = world_stage_deploy_power_alsace_space
			}
			custom_effect_tooltip = metropolis_scope_germany
			subtract_from_variable = {	#
				101.world_stage_power = ger_for
				tooltip = world_stage_deploy_power_alsace_space
			}
		}
	}
	option = {
		name = worldstage.24.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		hidden_effect = {	5 = { set_temp_variable = { ger_for = world_stage_power_deployed_by^101 } }
							5 = { set_temp_variable = { fra_for = world_stage_power_deployed_by^103 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_alsace
			custom_effect_tooltip = world_stage_activate_theater_tt
			custom_effect_tooltip = metropolis_scope_france
			subtract_from_variable = {
				103.world_stage_power = fra_for
				tooltip = world_stage_deploy_power_alsace_space
			}
			custom_effect_tooltip = metropolis_scope_germany
			subtract_from_variable = {	#
				101.world_stage_power = ger_for
				tooltip = world_stage_deploy_power_alsace_space
			}
		}
	}
	option = {
		name = worldstage.24.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		hidden_effect = {	5 = { set_temp_variable = { ger_for = world_stage_power_deployed_by^101 } }
							5 = { set_temp_variable = { fra_for = world_stage_power_deployed_by^103 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_alsace
			custom_effect_tooltip = world_stage_activate_theater_tt
			custom_effect_tooltip = metropolis_scope_france
			subtract_from_variable = {
				103.world_stage_power = fra_for
				tooltip = world_stage_deploy_power_alsace_space
			}
			custom_effect_tooltip = metropolis_scope_germany
			subtract_from_variable = {	#
				101.world_stage_power = ger_for
				tooltip = world_stage_deploy_power_alsace_space
			}
		}
	}
}

# The Blitzkrieg - France Falls to Blitzkrieg
country_event = {
	id = worldstage.25
	title = worldstage.25.t
	desc = worldstage.25.d 
	picture = GFX_news_ww2_blitzkrieg

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			clr_global_flag = world_stage_france_exists
			set_global_flag = world_stage_vichy_exists
			every_state = {
				limit = { check_variable = { theater_owner = 103 } }
				set_variable = { theater_owner = 120 }
				set_variable = { theater_owner_coalition = 3 }
				world_stage_end_round_partial = yes
				clr_state_flag = theater_is_active
			}
			8 = { set_variable = { theater_owner = 101 } set_variable = { theater_owner_coalition = 3 } clr_state_flag = theater_is_active }
			every_state = {
				limit = { has_variable = theater_owner }
				set_variable = { world_stage_power_deployed_by^120 = world_stage_power_deployed_by^103 }
				divide_variable = { world_stage_power_deployed_by^120 = 4 }
				set_variable = { world_stage_power_deployed_by^103 = 0 }
			}
			103 = { set_variable = { world_stage_power = 0 } clr_state_flag = worldstage_AI_active }
			every_possible_country = {
				limit = { tag = KOB }
				if = {
					limit = { country_exists = KOB }
					news_event = { id = worldstage_surrender.103 hours = 24 random = 24 }
				} else = { clr_country_flag = tc_kobe_has_access }
			}
			#### PROVISORY! DEBUG! TO-DO! TODO!
			set_global_flag = OSA_operation_overlord_completed	# remove this when OSA gets a rework and proper focuses are added
		}
	}

	option = {
		name = worldstage.25.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	KOB = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis_good
	}
	option = {
		name = worldstage.25.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	KOB = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		custom_effect_tooltip = metropolis_scope_vichy
		if = {
			limit = { has_global_flag = GER_SOV_pact_enabled }
			custom_effect_tooltip = join_coalition_axis_good
		} else = {
			custom_effect_tooltip = join_coalition_axis
		}
	}
	option = {
		name = worldstage.25.kob
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			tag = KOB
		}
		add_war_support = -0.1
		effect_tooltip = {
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis_bad
	}
	option = {
		name = worldstage.25.allies
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			NOT = { tag = KOB }
		}
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		hidden_effect = { add_war_support = -0.05 }
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis_bad
	}
	option = {
		name = worldstage.25.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis
	}
}

# The Blitzkrieg - France Resists
country_event = {
	id = worldstage.26
	title = worldstage.26.t
	desc = worldstage.26.d 
	picture = GFX_news_ww2_french_soldiers

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	option = {
		name = worldstage.26.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	add_war_support = 0.1 }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = 0.05 }
		}
	}
	option = {
		name = worldstage.26.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	add_war_support = 0.1 }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = 0.05 }
		}
	}
	option = {
		name = worldstage.26.kob
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			tag = KOB
		}
		add_war_support = 0.1
		effect_tooltip = {
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = 0.05 }
		}
	}
	option = {
		name = worldstage.26.allies
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			NOT = { tag = KOB }
		}
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	add_war_support = 0.1 }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = 0.05 }
		}
		hidden_effect = { add_war_support = 0.05 }
	}
	option = {
		name = worldstage.26.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	add_war_support = 0.1 }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = 0.05 }
		}
	}
}

# HIDDEN EVENT Barbarossa!
country_event = {
	id = worldstage.32
	title = worldstage.32.t
	desc = worldstage.32.d 
	picture = GFX_news_ww2_starts

	is_triggered_only = yes

	hidden = yes
	
	immediate = {
		# checks if SOV is Allies -> if any TAG is Allies	-> then makes all Comintern TAGS join the Allied TAG's faction (which, hopefully, is the Allies)
		#							 if not					-> declares war on all Axis TAGS
		# checks if SOV is Comintern -> declares war on all Axis TAGS
		# sovietunion_joined_ww2 means SOV joined Allies (coalition #1)
		if = {
			limit = { any_country = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } is_faction_leader = yes } } 
			set_global_flag = there_is_faction_allies
			random_country = {
				limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } is_faction_leader = yes }
				set_temp_variable = { allies_leader_tag = THIS.id }
			}
			var:allies_leader_tag = { log = "worldstage.32: there is an Allies tag ([THIS.GetName])" }
		}
		if = {
			limit = { any_country = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } is_faction_leader = yes } } 
			random_country = {
				limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } is_faction_leader = yes }
				set_temp_variable = { komintern_leader_tag = THIS.id }
			}
			var:komintern_leader_tag = { log = "worldstage.32: there is a Comintern tag ([THIS.GetName])" }
		}
		if = {
			limit = { any_country = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } is_faction_leader = yes } } 
			set_global_flag = there_is_faction_axis
			random_country = {
				limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } is_faction_leader = yes }
				set_temp_variable = { axis_leader_tag = THIS.id }
			}
			var:axis_leader_tag = { log = "worldstage.32: there is an Axis tag ([THIS.GetName])" }
		}
		if = {
			limit = { has_global_flag = there_is_faction_allies has_global_flag = sovietunion_joined_ww2 }	# There is a local Allies faction and SOV will join it
			every_country = {
				limit = { is_in_faction_with = var:komintern_leader_tag }
				leave_faction = yes
				var:allies_leader_tag = { add_to_faction = PREV }
				remove_from_array = { array = global.array_komintern value = THIS.id }
				add_to_array = { global.array_allies = THIS.id }
			}
			var:komintern_leader_tag = {
				dismantle_faction = yes
				var:allies_leader_tag = { add_to_faction = PREV }
				remove_from_array = { array = global.array_komintern value = THIS.id }
				add_to_array = { global.array_allies = THIS.id }
			}
			every_state = {
				limit = { check_variable = { world_stage_coalition = 2 } }
				set_variable = { world_stage_coalition = 1 }
			}
			every_state = {
				limit = { check_variable = { theater_owner_coalition = 2 } }
				set_variable = { theater_owner_coalition = 1 }
			}
			var:axis_leader_tag = {
				declare_war_on = {
						target = var:komintern_leader_tag
						type = annex_everything
					}
			}
			log = "worldstage.32: A) There is a local Allies faction and SOV will join it"
		}
		if = {
			limit = { NOT = { has_global_flag = there_is_faction_allies } has_global_flag = sovietunion_joined_ww2 }	# There is no local Allies faction and SOV will join it
			var:komintern_leader_tag = {
				set_faction_name = coalition_name_allies_short
				set_temp_variable = { allies_leader_tag = THIS.id }
			}
			every_country = {
				limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
				var:allies_leader_tag = { add_to_faction = PREV }
				var:world_stage_metropolis = { set_variable = { world_stage_metropolis = 1 } }
			}
			var:axis_leader_tag = {
				declare_war_on = {
						target = var:komintern_leader_tag
						type = annex_everything
					}
			}
			every_state = {
				limit = { check_variable = { world_stage_coalition = 2 } }
				set_variable = { world_stage_coalition = 1 }
			}
			every_state = {
				limit = { check_variable = { theater_owner_coalition = 2 } }
				set_variable = { theater_owner_coalition = 1 }
			}
			log = "worldstage.32: B) There is no local Allies faction and SOV will join it"
		}
		if = {
			limit = { NOT = { has_global_flag = sovietunion_joined_ww2 } }		# SOV will not join Allies (does not need to check if there's an Allies tag, since FER will not join it)
			if = { 
				limit = { any_country = { tag = var:komintern_leader_tag } }
				var:axis_leader_tag = {
					declare_war_on = {
							target = var:komintern_leader_tag
							type = annex_everything
						}
				}
			}
			log = "worldstage.32: # C) SOV will not join Allies"
		}
		### ACTIVATE AIs
		104 = { set_state_flag = worldstage_AI_active } # russia
	}
}

# Germany Invades Soviet Union! # WW2 ONGOING + MOLOTOV-RIBBENTROP
news_event = {
	id = worldstage.33
	title = worldstage.33.t
	desc = worldstage.33.d 
	picture = GFX_news_ww2_barbarossa_wide

	is_triggered_only = yes
	
	option = {
		name = worldstage.33.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 1
				tooltip = world_stage_add_strategic_advantage_attacker
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.33.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 1
				tooltip = world_stage_add_strategic_advantage_attacker_bad
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.33.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 1
				tooltip = world_stage_add_strategic_advantage_attacker_bad
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.33.other
		trigger = { var:world_stage_metropolis = { NOT = { check_variable = { world_stage_coalition = 1 } check_variable = { world_stage_coalition = 2 } check_variable = { world_stage_coalition = 3 } } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 1
				tooltip = world_stage_add_strategic_advantage_attacker_neutral
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
}

# Germany Invades Soviet Union! # WW2 ENDED + MOLOTOV-RIBBENTROP
news_event = {
	id = worldstage.34
	title = worldstage.34.t
	desc = worldstage.34.d 
	picture = GFX_news_ww2_barbarossa_wide

	is_triggered_only = yes
	
	option = {
		name = worldstage.34.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 1
				tooltip = world_stage_add_strategic_advantage_attacker
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.34.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 1
				tooltip = world_stage_add_strategic_advantage_attacker_bad
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.34.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 1
				tooltip = world_stage_add_strategic_advantage_attacker_neutral
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.34.other
		trigger = { var:world_stage_metropolis = { NOT = { check_variable = { world_stage_coalition = 1 } check_variable = { world_stage_coalition = 2 } check_variable = { world_stage_coalition = 3 } } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 1
				tooltip = world_stage_add_strategic_advantage_attacker_neutral
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
}

# Germany Invades Soviet Union! # WW2 ONGOING + NO PACT
news_event = {
	id = worldstage.35
	title = worldstage.35.t
	desc = worldstage.35.d 
	picture = GFX_news_ww2_barbarossa_wide

	is_triggered_only = yes
	
	option = {
		name = worldstage.35.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 0.5
				tooltip = world_stage_add_strategic_advantage_attacker
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.35.komin	# Comintern will merge with Allies, so this may not even be read. Just in case...
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 0.5
				tooltip = world_stage_add_strategic_advantage_attacker_bad
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
		if = {
			limit = { tag = FER has_idea = FER_international_isolation }
			remove_ideas = FER_international_isolation
		}
	}
	option = {
		name = worldstage.35.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 0.5
				tooltip = world_stage_add_strategic_advantage_attacker_bad
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
		if = {
			limit = { tag = FER has_idea = FER_international_isolation }
			remove_ideas = FER_international_isolation
		}
	}
	option = {
		name = worldstage.35.other
		trigger = { var:world_stage_metropolis = { NOT = { check_variable = { world_stage_coalition = 1 } check_variable = { world_stage_coalition = 2 } check_variable = { world_stage_coalition = 3 } } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 0.5
				tooltip = world_stage_add_strategic_advantage_attacker_neutral
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
}

# Germany Invades Soviet Union! # WW2 ENDED + NO PACT
news_event = {
	id = worldstage.36
	title = worldstage.36.t
	desc = worldstage.36.d 
	picture = GFX_news_ww2_barbarossa_wide

	is_triggered_only = yes
	
	option = {
		name = worldstage.36.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 0.5
				tooltip = world_stage_add_strategic_advantage_attacker
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.36.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 0.5
				tooltip = world_stage_add_strategic_advantage_attacker_bad
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.36.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 0.5
				tooltip = world_stage_add_strategic_advantage_attacker_neutral
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
	option = {
		name = worldstage.36.other
		trigger = { var:world_stage_metropolis = { NOT = { check_variable = { world_stage_coalition = 1 } check_variable = { world_stage_coalition = 2 } check_variable = { world_stage_coalition = 3 } } } }
		effect_tooltip = {
			custom_effect_tooltip = theater_scope_belarus
			custom_effect_tooltip = world_stage_activate_theater_tt
			add_to_variable = {
				9.attacker_strategic_advantage = 0.5
				tooltip = world_stage_add_strategic_advantage_attacker_neutral
			}
			custom_effect_tooltip = metropolis_scope_germany_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				101.world_stage_power = 9.world_stage_power_deployed_by^101
				tooltip = world_stage_deploy_power_belarus_space
			}
			custom_effect_tooltip = metropolis_scope_sovietunion_space
			subtract_from_variable = {	# this operation's tooltip IS the deployment tooltip, actual deployment is hidden to avoid the wrong scope appering in the focus effect
				104.world_stage_power = 9.world_stage_power_deployed_by^104
				tooltip = world_stage_deploy_power_belarus_space
			}
		}
	}
}

# Barbarossa - Germany Overwhelms Soviets in Belarus
news_event = {
	id = worldstage.37
	title = worldstage.37.t
	desc = {
		text = worldstage.37.d1
		trigger = { has_global_flag = GER_SOV_pact_betrayal }
	}
	desc = {
		text = worldstage.37.d2
		trigger = { NOT = { has_global_flag = GER_SOV_pact_betrayal } }
	}
	picture = GFX_news_ww2_barbarossa_success_wide

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			 9 = { world_stage_end_round_axis_victory = yes }
		}
	}
	
	option = {
		name = worldstage.37.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		custom_effect_tooltip = theater_scope_belarus
		custom_effect_tooltip = worldstage.16.tt_green
		custom_effect_tooltip = worldstage.16.tt_inactive
		custom_effect_tooltip = theater_scope_smolensk
		custom_effect_tooltip = world_stage_activate_theater_tt
		
	}
	option = {
		name = worldstage.37.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		custom_effect_tooltip = theater_scope_belarus
		custom_effect_tooltip = worldstage.16.tt_red
		custom_effect_tooltip = worldstage.16.tt_inactive
		custom_effect_tooltip = theater_scope_smolensk
		custom_effect_tooltip = world_stage_activate_theater_tt
	}
	option = {
		name = worldstage.37.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		custom_effect_tooltip = theater_scope_belarus
		custom_effect_tooltip = worldstage.16.tt_red
		custom_effect_tooltip = worldstage.16.tt_inactive
		custom_effect_tooltip = theater_scope_smolensk
		custom_effect_tooltip = world_stage_activate_theater_tt
	}
	option = {
		name = worldstage.37.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		custom_effect_tooltip = theater_scope_belarus
		custom_effect_tooltip = worldstage.16.tt_orange
		custom_effect_tooltip = worldstage.16.tt_inactive
		custom_effect_tooltip = theater_scope_smolensk
		custom_effect_tooltip = world_stage_activate_theater_tt
	}
}

# Barbarossa - German Suprise Attack Fails
news_event = {
	id = worldstage.38
	title = worldstage.38.t
	desc = worldstage.38.d 
	picture = GFX_news_ww2_soviet_soldiers

	is_triggered_only = yes

	immediate = {
		
	}
	
	option = {
		name = worldstage.38.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.38.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.38.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.38.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Barbarossa - Soviets Join Allies (purely cosmetic on WS)
news_event = {
	id = worldstage.39
	title = worldstage.39.t
	desc = {
		text = worldstage.39.d1
		trigger = { has_global_flag = GER_SOV_pact_betrayal }
	}
	desc = {
		text = worldstage.39.d2
		trigger = { NOT = { has_global_flag = GER_SOV_pact_betrayal } }
	}
	picture = GFX_news_ww2_soviets_join_allies_wide

	is_triggered_only = yes

	option = {
		name = worldstage.39.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		custom_effect_tooltip = metropolis_scope_sovietunion
		custom_effect_tooltip = join_coalition_allies_bad
	}
	option = {
		name = worldstage.39.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }	# this option will probably never happen, just in case...
		custom_effect_tooltip = worldstage.39.simpsonsjoke
		custom_effect_tooltip = metropolis_scope_sovietunion
		custom_effect_tooltip = join_coalition_allies_good
	}
	option = {
		name = worldstage.39.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		custom_effect_tooltip = worldstage.39.simpsonsjoke
		custom_effect_tooltip = metropolis_scope_sovietunion
		custom_effect_tooltip = join_coalition_allies_good
	}
	option = {
		name = worldstage.39.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		custom_effect_tooltip = metropolis_scope_sovietunion
		custom_effect_tooltip = join_coalition_allies
	}
}

# HIDDEN EVENT Phoney War Ends!
country_event = {
	id = worldstage.53
	title = worldstage.53.t
	desc = worldstage.53.d 
	picture = GFX_news_ww2_starts

	is_triggered_only = yes

	hidden = yes
	
	immediate = {
		clr_global_flag = phoney_war_rages_on
		if = {
			limit = { has_global_flag = modus_vivendi_pacific }
			clr_global_flag = modus_vivendi_pacific
			country_event = worldstage.80
			if = {
				limit = { country_exists = REI }
				every_country = {
					limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
					REI = {	declare_war_on = { target = PREV type = annex_everything } }
				}
			} else = {
				random_country = {
					limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } is_faction_leader = yes }
					set_temp_variable = { axis_leader = THIS.id }
					every_country = {
						limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
						var:axis_leader = {	declare_war_on = { target = PREV type = annex_everything } }
					}
				}
			}
		}
	}
}

# URSS is expelled from the League of Nations - Invasion of Finland
news_event = {
	id = worldstage.54
	title = worldstage.54.t
	desc = worldstage.54.d 
	picture = GFX_news_lon_ends_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			set_global_flag = SOV_expelled_from_lon
			every_country = {
				limit = { check_variable = { world_stage_metropolis = 104 } }
				set_variable = { world_stage_coalition = 2 }
			}
			every_state = {
				limit = { check_variable = { theater_owner = 104 } }	# proxy for sovietunion
				set_variable = { theater_owner_coalition = 2 }
			}
			### arrays for tag aliases ###
			remove_from_array = { array = global.array_leagueofnations value = FER }
			add_to_array = { global.array_komintern = FER }
		}
	}
	
	option = {
		name = worldstage.54.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.54.tooltip
		}
	}
	option = {
		name = worldstage.54.komin
		trigger = { OR = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } tag = FER } }
		custom_effect_tooltip = worldstage.54.tooltip
		if = {
			limit = { tag = FER has_global_flag = eastereggs_enabled }
			custom_effect_tooltip = worldstage.54.special
		}
	}
	option = {
		name = worldstage.54.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.54.tooltip
		}
	}
	option = {
		name = worldstage.54.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.54.tooltip
		}
	}
}

# URSS is expelled from the League of Nations - Annexation of Baltic States
news_event = {
	id = worldstage.541
	title = worldstage.54.t
	desc = worldstage.541.d 
	picture = GFX_news_lon_ends_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			set_global_flag = SOV_expelled_from_lon
			every_country = {
				limit = { check_variable = { world_stage_metropolis = 104 } }
				set_variable = { world_stage_coalition = 2 }
			}
			every_state = {
				limit = { check_variable = { theater_owner = 104 } }	# proxy for sovietunion
				set_variable = { theater_owner_coalition = 2 }
			}
			### arrays for tag aliases ###
			remove_from_array = { array = global.array_leagueofnations value = FER }
			add_to_array = { global.array_komintern = FER }
		}
	}
	
	option = {
		name = worldstage.54.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.54.tooltip
		}
	}
	option = {
		name = worldstage.54.komin
		trigger = { OR = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } tag = FER } }
		custom_effect_tooltip = worldstage.54.tooltip
		if = {
			limit = { tag = FER has_global_flag = eastereggs_enabled }
			custom_effect_tooltip = worldstage.54.special
		}
	}
	option = {
		name = worldstage.54.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.54.tooltip
		}
	}
	option = {
		name = worldstage.54.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.54.tooltip
		}
	}
}

# The End of the League of Nations
news_event = {
	id = worldstage.55
	title = worldstage.55.t
	desc = worldstage.55.d 
	picture = GFX_news_lon_ends_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			log = "Begone!, League of Nations!"
			every_country = {
				limit = { has_idea = SS_lon_member }
				remove_ideas = SS_lon_member
			}
			every_country = {
				limit = { has_idea = SS_lon_member_japan }
				remove_ideas = SS_lon_member_japan
			}
			clr_global_flag = league_of_nations_exists
			set_global_flag = SOV_already_expelled
			# the 'Great Swithceroo of Coalitions" happens here
			# first: run specific tags
			# second: run tags that may contain relevant infomation
			# third: run proxy metropolis for off-map countries with no tags in game and remaining LoN guys
			# fourth: set up new arrays of tags for tag-aliases
			# first:
			OSA = { set_variable = { world_stage_coalition = 1 } }	#if = { limit = { country_exists = OSA } add_to_array = { global.array_allies = OSA } }
			102 = { set_variable = { world_stage_coalition = 1 } }
			KOB = { set_variable = { world_stage_coalition = 1 } }
			103 = { set_variable = { world_stage_coalition = 1 } }
			FER = { set_variable = { world_stage_coalition = 2 } }		# URSS was already expelled from LoN at this point but we'll run the command again just in case the FER player did not play his part 
			104 = { set_variable = { world_stage_coalition = 2 } }
			REI = { set_variable = { world_stage_coalition = 3 } }
			101 = { set_variable = { world_stage_coalition = 3 } }
			109 = { set_variable = { world_stage_coalition = 3 } }		# Italy starts off map (a port may spawn in the future)
			115 = { set_variable = { world_stage_coalition = 1 } }		# Poland is off map
			120 = { set_variable = { world_stage_coalition = 3 } }		# Vichy France is off map
			# second:
			every_possible_country = {
				limit = { has_country_flag = will_join_allies }
				set_variable = { world_stage_coalition = 1 }
				if = { limit = { has_variable = world_stage_metropolis } var:world_stage_metropolis = { set_variable = { world_stage_coalition = 1 } } }
			}
			every_possible_country = {
				limit = { has_country_flag = will_join_komintern }
				set_variable = { world_stage_coalition = 2 }
				if = { limit = { has_variable = world_stage_metropolis } var:world_stage_metropolis = { set_variable = { world_stage_coalition = 2 } } }
			}
			every_possible_country = {
				limit = { has_country_flag = will_join_axis }
				set_variable = { world_stage_coalition = 3 }
				if = { limit = { has_variable = world_stage_metropolis } var:world_stage_metropolis = { set_variable = { world_stage_coalition = 3 } } }
			}
			every_possible_country = {
				limit = { check_variable = { world_stage_coalition = 6 } }
				set_variable = { world_stage_coalition = 3 }
				if = { limit = { has_variable = world_stage_metropolis } var:world_stage_metropolis = { set_variable = { world_stage_coalition = 6 } } }
			}
			# third:
			# At this point, anyone that should have joined a faction would have done it already
			# the following applies for both metropolises and theaters
			every_state = {
				limit = { has_variable = world_stage_coalition }
				if = {
					limit = {
						NOT = { check_variable = { world_stage_coalition = 1 } }
						NOT = { check_variable = { world_stage_coalition = 2 } }
						NOT = { check_variable = { world_stage_coalition = 3 } }
					}
					set_variable = { world_stage_coalition = 4 }
				}
			}
			every_state = {
				limit = { has_variable = theater_owner }
				var:theater_owner = { set_temp_variable = { new_coalition = world_stage_coalition } }
				set_variable = { theater_owner_coalition = new_coalition }
			}
			# fourth:
			### arrays for tag aliases ###
			clear_array = global.array_komintern	# we set up the whole komintern array twice as a fail-safe
			clear_array = global.array_leagueofnations
			clear_array = global.array_pactofsteel
			every_country = {
				if = {
					limit = { check_variable = { world_stage_coalition = 1 } }
					add_to_array = { global.array_allies = THIS.id }
				}
			}
			every_country = {
				if = {
					limit = { check_variable = { world_stage_coalition = 2 } }
					add_to_array = { global.array_komintern = THIS.id }
				}
			}
			every_country = {
				if = {
					limit = { check_variable = { world_stage_coalition = 3 } }
					add_to_array = { global.array_axis = THIS.id }
				}
			}
			# create on-map factions
			ALY = {
				if = {
					limit = { is_in_faction = yes }
					if = {
						limit = { is_faction_leader = yes }
						set_faction_name = coalition_name_allies_short
					} else = {
						leave_faction = yes
						create_faction = coalition_name_allies_short
					}
				} else = {
					create_faction = coalition_name_allies_short
				}
				every_other_country = {
					limit = { check_variable = { world_stage_coalition = 1 } }
					ALY = { add_to_faction = PREV }
				}			
			}
			COM = {
				if = {
					limit = { is_in_faction = yes }
					if = {
						limit = { is_faction_leader = yes }
						set_faction_name = coalition_name_komintern_short
					} else = {
						leave_faction = yes
						create_faction = coalition_name_komintern_short
					}
				} else = {
					create_faction = coalition_name_komintern_short
				}
				every_other_country = {
					limit = { check_variable = { world_stage_coalition = 2 } }
					COM = { add_to_faction = PREV }
				}			
			}
			AXS = {
				if = {
					limit = { is_in_faction = yes }
					if = {
						limit = { is_faction_leader = yes }
						set_faction_name = coalition_name_axis_short
					} else = {
						leave_faction = yes
						create_faction = coalition_name_axis_short
					}
				} else = {
					create_faction = coalition_name_axis_short
				}
				every_other_country = {
					limit = { check_variable = { world_stage_coalition = 3 } }
					AXS = { add_to_faction = PREV }
				}			
			}
			# Change attacker on Poland
			3 = { set_variable = { coalition_side_attack = 3 } }	
			# Special checks for Portugal's delayed events
			if = {
				limit = { has_global_flag = delayed_event_worldstage73 }
				clr_global_flag = delayed_event_worldstage73 every_possible_country = { limit = { tag = PRT } country_event = { id = worldstage.73 hours = 6 } }	# ask to join war
			}
			if = {
				limit = { has_global_flag = delayed_event_worldstage74 }
				clr_global_flag = delayed_event_worldstage74 every_possible_country = { limit = { tag = PRT } country_event = { id = worldstage.74 hours = 6 } }	# join war
			}
		}
	}
	
	option = {
		name = worldstage.55.allies
		trigger = { OR = { check_variable = { world_stage_coalition = 1 } check_variable = { world_stage_coalition = 5 } } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.55.lon_tt
			custom_effect_tooltip = worldstage.55.allies_tt
		}
	}
	option = {
		name = worldstage.55.komin
		trigger = { check_variable = { world_stage_coalition = 2 } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.55.lon_tt
			if = {
				limit = { NOT = { has_global_flag = SOV_already_expelled } }
				custom_effect_tooltip = worldstage.55.komin_tt
			}
		}
	}
	option = {
		name = worldstage.55.axis
		trigger = { OR = { check_variable = { world_stage_coalition = 3 } check_variable = { world_stage_coalition = 6 } } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.55.lon_tt
			custom_effect_tooltip = worldstage.55.axis_tt
		}
	}
	option = {
		name = worldstage.55.other
		trigger = { OR = { check_variable = { world_stage_coalition = 4 } NOT = { has_variable = world_stage_coalition } } }
		effect_tooltip = {
			custom_effect_tooltip = worldstage.55.lon_tt
		}
	}
}

# Operation Overlord - Preparations
country_event = {
	id = worldstage.56
	title = worldstage.56.t
	desc = worldstage.56.d
	picture = GFX_report_event_military_planning

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
		}
	}

	option = {
		name = worldstage.56.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.56.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.56.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.56.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Overlord - Success
news_event = {
	id = worldstage.57
	title = worldstage.57.t
	desc = worldstage.57.d
	picture = GFX_news_ww2_operation_overlord_wide

	is_triggered_only = yes
	
	major = yes
	
	immediate = {
		8 = {
			set_state_flag = theater_is_active
			if = {
				limit = { has_global_flag = REI_atlantikwall_completed }		# TO-DO TODO make dynamic later
				add_to_variable = { world_stage_power_deployed_by^101 = 60 } 	# GER for France
			} else = {
				add_to_variable = { world_stage_power_deployed_by^101 = 30 }
			}
			add_to_variable = { world_stage_power_deployed_by^102 = global.overlord_strength } 	# ENG in France
			set_variable = { global.overlord_strength = 50 }	# it's "zero" but the decision assumes it's 50 for tooltiping purposes
			set_variable = { coalition_side_attack = 1 }					
			world_stage_state_update_current_day = yes
		}
	}

	option = {
		name = worldstage.57.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.57.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.57.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.57.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Overlord - Failure
news_event = {
	id = worldstage.58
	title = worldstage.58.t
	desc = worldstage.58.d
	picture = GFX_news_ww2_failed_landing_wide

	is_triggered_only = yes
	
	major = yes

	option = {
		name = worldstage.58.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.58.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.58.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.58.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Overlord - Abort
country_event = {
	id = worldstage.59
	title = worldstage.59.t
	desc = worldstage.59.d
	picture = GFX_news_ww2_abort_operation

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
		}
	}
	
	immediate = {
		clr_global_flag = world_stage_sealion_preparing
	}

	option = {
		name = worldstage.59.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.59.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.59.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.59.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Sea Lion - Preparations
country_event = {
	id = worldstage.60
	title = worldstage.60.t
	desc = {
		text = worldstage.60.d1
		trigger = { tag = REI }				### ADD TRIGGER FOR AXIS
	}
	desc = {
		text = worldstage.60.d2
		trigger = { NOT = { tag = REI } }	### ADD TRIGGER FOR NON-AXIS
	}
	picture = GFX_report_event_military_planning

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
		}
	}

	option = {
		name = worldstage.60.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.60.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.60.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.60.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Sea Lion - Success
news_event = {
	id = worldstage.61
	title = worldstage.61.t
	desc = worldstage.61.d
	picture = GFX_news_ww2_operation_sealion_wide

	is_triggered_only = yes
	
	major = yes

	immediate = {
		30 = {
			set_state_flag = theater_is_active
			if = {
				limit = { has_global_flag = OSA_focus_for_home_defense }		# TO-DO TODO make dynamic later /// ADD THIS FOCUS ON LATER UPDATES
				add_to_variable = { world_stage_power_deployed_by^102 = 60 } 	# ENG for England
			} else = {
				add_to_variable = { world_stage_power_deployed_by^102 = 30 }
			}
			add_to_variable = { world_stage_power_deployed_by^101 = global.sealion_strength } 	# GER in England
			set_variable = { global.sealion_strength = 50 }	# it's "zero" but the decision assumes it's 50 for tooltiping purposes
			set_variable = { coalition_side_attack = 3 }					
			world_stage_state_update_current_day = yes
		}
	}
	
	option = {
		name = worldstage.61.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.61.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.61.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.61.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Sea Lion - Failure
news_event = {
	id = worldstage.62
	title = worldstage.62.t
	desc = worldstage.62.d
	picture = GFX_news_ww2_failed_landing_wide

	is_triggered_only = yes
	
	major = yes

	option = {
		name = worldstage.62.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.62.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.62.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.62.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Sea Lion - Abort
country_event = {
	id = worldstage.63
	title = worldstage.63.t
	desc = worldstage.63.d
	picture = GFX_news_ww2_abort_operation

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
		}
	}
	
	immediate = {
		clr_global_flag = world_stage_sealion_preparing
	}

	option = {
		name = worldstage.63.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.63.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.63.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.63.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Husky - Preparations
country_event = {
	id = worldstage.64
	title = worldstage.64.t
	desc = worldstage.64.d
	picture = GFX_report_event_military_planning

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
		}
	}

	option = {
		name = worldstage.64.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.64.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.64.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.64.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Husky - Success
news_event = {
	id = worldstage.65
	title = worldstage.65.t
	desc = worldstage.65.d
	picture = GFX_news_ww2_operation_husky_wide

	is_triggered_only = yes
	
	major = yes
	
	immediate = {
		24 = {
			set_state_flag = theater_is_active
			if = {
				limit = { has_global_flag = REI_help_italy_completed }			# TO-DO TODO make dynamic later /// ADD THIS FOCUS ON LATER UPDATES
				add_to_variable = { world_stage_power_deployed_by^102 = 10 } 	# GER for Italy
				add_to_variable = { world_stage_power_deployed_by^109 = 10 } 	# ITA for Italy
			}
			add_to_variable = { world_stage_power_deployed_by^102 = global.husky_strength } 	# ENG for Italy
			set_variable = { global.husky_strength = 50 }	# it's "zero" but the decision assumes it's 50 for tooltiping purposes
			set_variable = { coalition_side_attack = 1 }					
			world_stage_state_update_current_day = yes
		}
	}

	option = {
		name = worldstage.65.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.65.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.65.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.65.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Husky - Failure
news_event = {
	id = worldstage.66
	title = worldstage.66.t
	desc = worldstage.66.d
	picture = GFX_news_ww2_failed_landing_wide

	is_triggered_only = yes
	
	major = yes

	option = {
		name = worldstage.66.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.66.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.66.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.66.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Husky - Abort
country_event = {
	id = worldstage.67
	title = worldstage.67.t
	desc = worldstage.67.d
	picture = GFX_news_ww2_abort_operation

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
		}
	}
	
	immediate = {
		clr_global_flag = world_stage_sealion_preparing
	}

	option = {
		name = worldstage.67.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.67.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.67.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.67.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Torch - Preparations
country_event = {
	id = worldstage.68
	title = worldstage.68.t
	desc = worldstage.68.d
	picture = GFX_report_event_military_planning

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
		}
	}

	option = {
		name = worldstage.68.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.68.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.68.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.68.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Torch - Success
news_event = {
	id = worldstage.69
	title = worldstage.69.t
	desc = worldstage.69.d
	picture = GFX_news_ww2_operation_torch_wide

	is_triggered_only = yes
	
	major = yes
	
	immediate = {
		14 = {	# Add Western Magreb later
			set_state_flag = theater_is_active
			# no deployed forces since Afrikakorps does that already
			add_to_variable = { world_stage_power_deployed_by^102 = global.torch_strength } 	# ENG for Lybia
			set_variable = { global.torch_strength = 50 }	# it's "zero" but the decision assumes it's 50 for tooltiping purposes
			set_variable = { coalition_side_attack = 1 }					
			world_stage_state_update_current_day = yes
		}
	}

	option = {
		name = worldstage.69.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.69.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.69.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.69.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Torch - Failure
news_event = {
	id = worldstage.70
	title = worldstage.70.t
	desc = worldstage.70.d
	picture = GFX_news_ww2_failed_landing_wide

	is_triggered_only = yes
	
	major = yes

	option = {
		name = worldstage.70.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.70.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.70.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.70.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Torch - Abort
country_event = {
	id = worldstage.71
	title = worldstage.71.t
	desc = worldstage.71.d
	picture = GFX_news_ww2_abort_operation

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
		}
	}
	
	immediate = {
		clr_global_flag = world_stage_sealion_preparing
	}

	option = {
		name = worldstage.71.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		
	}
	option = {
		name = worldstage.71.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		
	}
	option = {
		name = worldstage.71.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		
	}
	option = {
		name = worldstage.71.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		
	}
}

# Operation Typhoon (REI focus REI_thrust_to_moscow) - Cosmetic Event
country_event = {
	id = worldstage.72
	title = worldstage.72.t
	desc = {
		text = worldstage.72.d1
		trigger = { NOT = { REI = { has_government = autocracy } } }	# normal event
	}
	desc = {
		text = worldstage.72.d2
		trigger = { REI = { has_government = autocracy } } 			# monarchist event (cannot use 2nd leader text)
	}
	picture = GFX_news_ww2_taifun

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			AND = {
				has_global_flag = sovietunion_joined_ww2
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			}
			AND = {
				NOT = { has_global_flag = sovietunion_joined_ww2 }
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } }
			}
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
		}
	}
	
	option = {
		name = worldstage.72.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		if = {
			limit = { 11 = { has_state_flag = theater_is_active } }	# Moscow (always attacker, dont need to check ownership)
			custom_effect_tooltip = theater_scope_russia
			effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker } }
		} else = {	# if else, action is in Smolensk
			custom_effect_tooltip = theater_scope_smolensk
			if = {
				limit = { 10 = { check_variable = { theater_owner_coalition = 3 } } }	# Germans are defending in Smolensk
				effect_tooltip = { add_to_variable = { defender_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_defender } }
			} else = {	# if else, Germans are attacking in Smolensk
				effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker } }
			}
		}
	}
	option = {
		name = worldstage.72.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		if = {
			limit = { 11 = { has_state_flag = theater_is_active } }	# Moscow (always attacker, dont need to check ownership)
			custom_effect_tooltip = theater_scope_russia
			effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker_bad } }
		} else = {	# if else, action is in Smolensk
			custom_effect_tooltip = theater_scope_smolensk
			if = {
				limit = { 10 = { check_variable = { theater_owner_coalition = 3 } } }	# Germans are defending in Smolensk
				effect_tooltip = { add_to_variable = { defender_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_defender_bad } }
			} else = {	# if else, Germans are attacking in Smolensk
				effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker_bad } }
			}
		}
	}
	option = {
		name = worldstage.72.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		if = {
			limit = { has_global_flag = sovietunion_joined_ww2 }
			if = {
				limit = { 11 = { has_state_flag = theater_is_active } }	# Moscow (always attacker, dont need to check ownership)
				custom_effect_tooltip = theater_scope_russia
				effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker_bad } }
			} else = {	# if else, action is in Smolensk
				custom_effect_tooltip = theater_scope_smolensk
				if = {
					limit = { 10 = { check_variable = { theater_owner_coalition = 3 } } }	# Germans are defending in Smolensk
					effect_tooltip = { add_to_variable = { defender_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_defender_bad } }
				} else = {	# if else, Germans are attacking in Smolensk
					effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker_bad } }
				}
			}
		} else = {
			if = {
				limit = { 11 = { has_state_flag = theater_is_active } }	# Moscow (always attacker, dont need to check ownership)
				custom_effect_tooltip = theater_scope_russia
				effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker_neutral } }
			} else = {	# if else, action is in Smolensk
				custom_effect_tooltip = theater_scope_smolensk
				if = {
					limit = { 10 = { check_variable = { theater_owner_coalition = 3 } } }	# Germans are defending in Smolensk
					effect_tooltip = { add_to_variable = { defender_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_defender_neutral } }
				} else = {	# if else, Germans are attacking in Smolensk
					effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker_neutral } }
				}
			}
		}
	}
	option = {
		name = worldstage.72.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		if = {
			limit = { 11 = { has_state_flag = theater_is_active } }	# Moscow (always attacker, dont need to check ownership)
			custom_effect_tooltip = theater_scope_russia
			effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker_neutral } }
		} else = {	# if else, action is in Smolensk
			custom_effect_tooltip = theater_scope_smolensk
			if = {
				limit = { 10 = { check_variable = { theater_owner_coalition = 3 } } }	# Germans are defending in Smolensk
				effect_tooltip = { add_to_variable = { defender_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_defender_neutral } }
			} else = {	# if else, Germans are attacking in Smolensk
				effect_tooltip = { add_to_variable = { attacker_strategic_advantage = 1 tooltip = world_stage_add_strategic_advantage_attacker_neutral } }
			}
		}
	}
}

# Portugal: Join Allies when Macau is siezed?
country_event = {
	id = worldstage.73
	title = worldstage.73.t
	desc = worldstage.73.d
	picture = GFX_report_event_portugal_attacked

	is_triggered_only = yes
	
	option = {	# Do not join war
		name = worldstage.73.a
		add_stability = -0.05
		set_truce = {
			target = ROC
			days = 180
		}
	}
	option = {	# Join the Allies!
		name = worldstage.73.b
		world_stage_join_allies = yes
		if = {
			limit = { country_exists = ROC }
			ROC = {
				declare_war_on = {
					target = PRT
					type = annex_everything
				}
			}
		}
		add_war_support = 0.05
		hidden_effect = {
			ALY = {
				add_ai_strategy = {
					type = alliance
					id = PRT
					value = 100
				}
			}
			country_event = worldstage.74
		}
		custom_effect_tooltip = worldstage.73.b2
		hidden_effect = { 108 = { set_variable = { world_stage_coalition = 1 } } PRT = { set_variable = { world_stage_coalition = 1 } } }	# there is redundancy with the next event, I'll keep both as a fail-safe
	}
	option = {	# We fight alone
		name = worldstage.73.c
		trigger = { country_exists = ROC 106 = { check_variable = { world_stage_coalition = 4 } } }
		ROC = {
			declare_war_on = {
				target = PRT
				type = annex_everything
			}
		}
		add_war_support = 0.05
		hidden_effect = {
			add_ai_strategy = { type = alliance id = OSA value = -100 }
			add_ai_strategy = { type = alliance id = KOB value = -100 }
			OSA = { add_ai_strategy = { type = alliance id = PRT value = -100 } }
			KOB = { add_ai_strategy = { type = alliance id = PRT value = -100 } }
		}
		custom_effect_tooltip = worldstage.73.b2
	}
}

# Portugal: Join Allies after China invaded Macau
country_event = {
	id = worldstage.74
	title = worldstage.74.t
	desc = worldstage.74.d
	picture = GFX_report_event_portugal_attacked

	is_triggered_only = yes
	
	major = yes
	
	immediate = { hidden_effect = { 108 = { set_variable = { world_stage_coalition = 1 } } PRT = { set_variable = { world_stage_coalition = 1 } } } }
	
	show_major = {
		OR = {
			NOT = { has_country_flag = hide_worldstage_notification }
			tag = PRT
			tag = ROC
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
			is_neighbor_of = PRT
		}
	}
	
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } NOT = { tag = PRT } }
		name = worldstage.74.allies
		custom_effect_tooltip = metropolis_scope_portugal
		custom_effect_tooltip = world_stage_join_allies_tt_good
	}
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } NOT = { tag = ROC } }
		name = worldstage.74.axis
		custom_effect_tooltip = metropolis_scope_portugal
		custom_effect_tooltip = world_stage_join_allies_tt_bad
	}
	option = {
		trigger = { tag = PRT }
		name = worldstage.74.prt
		custom_effect_tooltip = metropolis_scope_portugal
		custom_effect_tooltip = world_stage_join_allies_tt
	}
	option = {
		trigger = { tag = ROC }
		name = worldstage.74.roc
		custom_effect_tooltip = metropolis_scope_portugal
		custom_effect_tooltip = world_stage_join_allies_tt_bad
	}
	option = {
		trigger = {
			NOT = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
			NOT = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
			NOT = { tag = PRT }
			NOT = { tag = ROC }
		}
		name = worldstage.74.other
		custom_effect_tooltip = metropolis_scope_portugal
		custom_effect_tooltip = world_stage_join_allies_tt
	}
}

# GENERIC EVENT FOR JOINING FACTION
country_event = {
	id = worldstage.75
	title = worldstage.75.t
	desc = worldstage.75.d
	picture = GFX_report_event_military_planning

	is_triggered_only = yes
	
	major = yes	# this one is shown to everyone
	
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = global.worldstage75 } } NOT = { tag = ROOT } }
		name = worldstage.75.a
	}
	option = {
		trigger = {
			var:world_stage_metropolis = {
				NOT = { check_variable = { world_stage_coalition = global.worldstage75 } }
				NOT = { check_variable = { world_stage_coalition = 4 } }
			}
			NOT = { tag = ROOT }
		}
		name = worldstage.75.b
	}
	option = {
		trigger = { OR = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } NOT = { has_variable = world_stage_coalition } } NOT = { tag = ROOT } }
		name = worldstage.75.c
	}
	option = {
		trigger = { tag = ROOT }
		name = worldstage.75.self
		add_political_power = var:global.worldstage75
	}
}

# United States Join the Allies: Abandon Neutrality focus
news_event = {
	id = worldstage.76
	title = worldstage.76.t
	desc = worldstage.76.d
	picture = GFX_news_ww2_usa_joins_war

	is_triggered_only = yes
	
	major = yes	# this one is shown to everyone
	
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } NOT = { tag = AMC tag = OKI } }
		name = worldstage.76.allies
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt_good
	}
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		name = worldstage.76.komintern
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt
	}
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		name = worldstage.76.axis
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt_bad
	}
	option = {
		trigger = { OR = { tag = AMC tag = OKI } }
		name = worldstage.76.usa
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt
	}
	option = {
		trigger = {
			NOT = {
				tag = AMC tag = OKI
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } }
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
			}
		}
		name = worldstage.76.other
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt
	}
}

# United States Join the Allies: China Invaded Formosa
news_event = {
	id = worldstage.77
	title = worldstage.77.t
	desc = worldstage.77.d
	picture = GFX_news_ww2_usa_attacked

	is_triggered_only = yes
	
	major = yes	# this one is shown to everyone
	
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } NOT = { tag = AMC tag = OKI } }
		name = worldstage.77.allies
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt_good
	}
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		name = worldstage.77.komintern
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt
	}
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } NOT = { tag = ROC }}
		name = worldstage.77.axis
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt_bad
	}
	option = {
		trigger = { OR = { tag = AMC tag = OKI } }
		name = worldstage.77.usa
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt
	}
	option = {
		trigger = { tag = ROC }
		name = worldstage.77.roc
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt_bad
	}
	option = {
		trigger = {
			NOT = {
				tag = AMC tag = OKI
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } }
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
			}
		}
		name = worldstage.77.other
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = world_stage_join_allies_tt
	}
	
}

# United States pledges to join the Allies
news_event = {
	id = worldstage.78
	title = worldstage.78.t
	desc = worldstage.78.d
	picture = GFX_news_ww2_usa_joins_war

	is_triggered_only = yes
	
	major = yes	# this one is shown to everyone
	
	option = {
		trigger = {
			NOT = { tag = AMC tag = OKI }
			OR = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 5 } } }
		}
		name = worldstage.78.lon
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = will_join_allies_tt
	}
	option = {
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		name = worldstage.78.komintern
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = will_join_allies_tt
	}
	option = {
		trigger = { OR = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 6 } } } }
		name = worldstage.78.pactofsteel
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = will_join_allies_tt
	}
	option = {
		trigger = { OR = { tag = AMC tag = OKI } }
		name = worldstage.78.usa
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = will_join_allies_tt
	}
	option = {
		trigger = {
			NOT = {
				tag = AMC tag = OKI
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } }
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 5 } }
				var:world_stage_metropolis = { check_variable = { world_stage_coalition = 6 } }
			}
		}
		name = worldstage.78.other
		custom_effect_tooltip = metropolis_scope_usa
		custom_effect_tooltip = will_join_allies_tt
	}
}

# WW2 does not reaches Pacific - Cosmetic
country_event = {
	id = worldstage.79
	title = worldstage.79.t
	desc = worldstage.79.d
	picture = GFX_report_event_military_planning
	
	is_triggered_only = yes
	major = yes	# this one is shown to everyone
	
	option = { name = worldstage.79.a custom_effect_tooltip = worldstage.79.a2 }
}

# WW2 reaches Pacific - Cosmetic
country_event = {
	id = worldstage.80
	title = worldstage.80.t
	desc = worldstage.80.d
	picture = GFX_report_event_military_planning
	
	is_triggered_only = yes
	major = yes	# this one is shown to everyone
	
	option = { name = worldstage.80.a }
}

# WW2 ends! Settled peace: Germany surrenders to Western Allies
# WW2 ends! Settled peace: Germany surrenders to Soviets
# WW2 ends! Germany totally defeated
# WW2 ends! Settled peace: England surrenders, Soviets didn't participate
# WW2 ends! Settled peace: England surrenders, Soviets already surrendered
# WW2 ends! England totally defeated, Soviets didn't participate
# WW2 ends! England totally defeated, Soviets already surrendered
# WW2 ends! Settled peace: Soviets surrender, (UK necessarily participated and already quit the war)
# WW2 ends! Soviets totally defeated (UK necessarily participated and already quit the war)

########################################################################
########################## worldstage_automatic ########################
########################################################################

# theater ended: defender won (defender event)
state_event = {
	id = worldstage_automatic.1
	title = worldstage_automatic.1.t
	desc = worldstage_automatic.1.d 
	picture = GFX_news_ww2_battle

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		AND = { check_variable = { ROOT.theater_owner_coalition = THIS.world_stage_coalition } }	### add rules for kominter/allies friendship
	}
	
	option = { name = worldstage_automatic.1.a custom_effect_tooltip = worldstage_automatic.1.tt }
}

# theater ended: defender won (attacker event)
state_event = {
	id = worldstage_automatic.2
	title = worldstage_automatic.2.t
	desc = worldstage_automatic.2.d 
	picture = GFX_news_ww2_dead_soldiers

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		AND = { check_variable = { ROOT.coalition_side_attack = THIS.world_stage_coalition } }	### add rules for kominter/allies friendship
	}
	
	immediate = {	# closes window, if it is open
		if = {
			limit = { check_variable = { ROOT.theater_id = current_theater } }
			set_variable = { current_theater = 0 }
		}
	}
	
	option = { name = worldstage_automatic.2.a custom_effect_tooltip = worldstage_automatic.2.tt }
}

# theater ended: defender won (neutral event)
state_event = {
	id = worldstage_automatic.3
	title = worldstage_automatic.3.t
	desc = worldstage_automatic.3.d 
	picture = GFX_news_ww2_dead_soldiers

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		NOT = {
			NOT = { has_country_flag = hide_worldstage_notification }
			AND = { check_variable = { ROOT.theater_owner_coalition = THIS.world_stage_coalition } }	### add rules for kominter/allies friendship
			AND = { check_variable = { ROOT.coalition_side_attack = THIS.world_stage_coalition } }	### add rules for kominter/allies friendship
		}
	}
	
	immediate = {	# closes window, if it is open
		if = {
			limit = { check_variable = { ROOT.theater_id = current_theater } }
			set_variable = { current_theater = 0 }
		}
	}
	
	option = { name = worldstage_automatic.3.a custom_effect_tooltip = worldstage_automatic.3.tt }
}

# theater ended: attacker won (defender event)
state_event = {
	id = worldstage_automatic.4
	title = worldstage_automatic.4.t
	desc = worldstage_automatic.4.d 
	picture = GFX_news_ww2_dead_soldiers

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		AND = { check_variable = { ROOT.theater_owner_coalition = THIS.world_stage_coalition } }	### add rules for kominter/allies friendship
	}
	
	immediate = {	# closes window, if it is open
		if = {
			limit = { check_variable = { ROOT.theater_id = current_theater } }
			set_variable = { current_theater = 0 }
		}
	}
	
	option = { name = worldstage_automatic.4.a custom_effect_tooltip = worldstage_automatic.4.tt }
}

# theater ended: attacker won (attacker event)
state_event = {
	id = worldstage_automatic.5
	title = worldstage_automatic.5.t
	desc = worldstage_automatic.5.d 
	picture = GFX_news_ww2_battle

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		AND = { check_variable = { ROOT.coalition_side_attack = THIS.world_stage_coalition } }	### add rules for kominter/allies friendship
	}
	
	immediate = {	# closes window, if it is open
		if = {
			limit = { check_variable = { ROOT.theater_id = current_theater } }
			set_variable = { current_theater = 0 }
		}
	}
	
	option = { name = worldstage_automatic.5.a custom_effect_tooltip = worldstage_automatic.5.tt }
}

# theater ended: attacker won (neutral event)
state_event = {
	id = worldstage_automatic.6
	title = worldstage_automatic.6.t
	desc = worldstage_automatic.6.d 
	picture = GFX_news_ww2_dead_soldiers

	is_triggered_only = yes
	
	major = yes
	
	show_major = {
		NOT = {
			NOT = { has_country_flag = hide_worldstage_notification }
			AND = { check_variable = { ROOT.theater_owner_coalition = THIS.world_stage_coalition } }	### add rules for kominter/allies friendship
			AND = { check_variable = { ROOT.coalition_side_attack = THIS.world_stage_coalition } }	### add rules for kominter/allies friendship
		}
	}
	
	immediate = {	# closes window, if it is open
		if = {
			limit = { check_variable = { ROOT.theater_id = current_theater } }
			set_variable = { current_theater = 0 }
		}
	}
	
	option = { name = worldstage_automatic.6.a custom_effect_tooltip = worldstage_automatic.6.tt }
}

# Berlin is taken, Germany falls
news_event = {
	id = worldstage_automatic.101
	title = worldstage_automatic.101.t
	desc = worldstage_automatic.101.d 
	picture = GFX_news_ww2_germany_capitulates_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			101 = { set_temp_variable = { occupier_coalition = theater_owner_coalition } }# figure out if Berlin was taken by Allies or Comintern
			101 = { set_state_flag = metropolis_capitulated }	# set_global_flag = world_stage_england_capitulated
			every_state = {
				limit = { check_variable = { theater_owner = 101 } }
				set_variable = { theater_owner_coalition = occupier_coalition }
				world_stage_end_round_partial = yes
				clr_state_flag = theater_is_active
			}
			every_state = {
				limit = { has_variable = theater_owner }
				divide_variable = { world_stage_power_deployed_by^101 = 4 }
				round_variable = world_stage_power_deployed_by^101
			}
			101 = { set_variable = { world_stage_power = 0 } }
			every_possible_country = {									# this effect is convoluted but necessary in order to cut resources from REI if Germany is defeated while REI is annexed
				limit = { tag = REI }
				if = {
					limit = { country_exists = REI }
					news_event = { id = worldstage_surrender.101 hours = 24 random = 24 }
				} else = { clr_country_flag = tc_yawatahama_has_access }
			}
		}
	}

	option = {
		name = worldstage_automatic.102.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			if = { limit = { country_exists = REI }	REI = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = REI } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			if = { limit = { country_exists = REI }	REI = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = REI } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.rei
		trigger = { tag = REI }
		add_war_support = -0.1
		effect_tooltip = {
			every_country = { limit = { NOT = { tag = REI } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.allies
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			NOT = { tag = REI }
		}
		effect_tooltip = {
			if = { limit = { country_exists = REI }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = REI } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
		hidden_effect = { add_war_support = -0.05 }
	}
	option = {
		name = worldstage_automatic.102.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			if = { limit = { country_exists = REI }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = REI } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
}

# London is taken, England falls
news_event = {
	id = worldstage_automatic.102
	title = worldstage_automatic.102.t
	desc = worldstage_automatic.102.d 
	picture = GFX_news_ww2_england_capitulates_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			102 = { set_state_flag = metropolis_capitulated }
			every_state = {
				limit = { check_variable = { theater_owner = 102 } }
				set_variable = { theater_owner_coalition = 3 }
				world_stage_end_round_partial = yes
				clr_state_flag = theater_is_active
			}
			every_state = {
				limit = { has_variable = theater_owner }
				divide_variable = { world_stage_power_deployed_by^102 = 4 }
				round_variable = world_stage_power_deployed_by^102
			}
			102 = { set_variable = { world_stage_power = 0 } }
			every_possible_country = {									# this effect is convoluted but necessary in order to cut resources from OSA if England is defeated while OSA is annexed
				limit = { tag = OSA }
				if = {
					limit = { country_exists = OSA }
					news_event = { id = worldstage_surrender.102 hours = 24 random = 24 }
				} else = { clr_country_flag = tc_osaka_has_access }
			}
		}
	}

	option = {
		name = worldstage_automatic.102.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			if = { limit = { country_exists = OSA }	OSA = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = OSA } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			if = { limit = { country_exists = OSA }	OSA = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = OSA } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		custom_effect_tooltip = metropolis_scope_england
		if = {
			limit = { has_global_flag = GER_SOV_pact_enabled }
			custom_effect_tooltip = join_coalition_axis_good
		} else = {
			custom_effect_tooltip = join_coalition_axis
		}
	}
	option = {
		name = worldstage_automatic.102.osa
		trigger = { tag = OSA }
		add_war_support = -0.1
		effect_tooltip = {
			every_country = { limit = { NOT = { tag = OSA } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.allies
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			NOT = { tag = OSA }
		}
		effect_tooltip = {
			if = { limit = { country_exists = OSA }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = OSA } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		hidden_effect = { add_war_support = -0.05 }
	}
	option = {
		name = worldstage_automatic.102.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			if = { limit = { country_exists = OSA }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = OSA } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
	}
}

# Paris is taken, France falls
news_event = {
	id = worldstage_automatic.103
	title = worldstage_automatic.103.t
	desc = worldstage_automatic.103.d 
	picture = GFX_news_ww2_france_capitulates_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			103 = { set_state_flag = metropolis_capitulated }
			#clr_global_flag = world_stage_france_exists
			set_global_flag = world_stage_vichy_exists
			120 = { 103 = { set_variable = { PREV.doctrine_bonus_land = doctrine_bonus_land } } }
			every_state = {
				limit = { check_variable = { theater_owner = 103 } }
				set_variable = { theater_owner = 120 }
				set_variable = { theater_owner_coalition = 3 }
				world_stage_end_round_partial = yes
				clr_state_flag = theater_is_active
			}
			8 = { set_variable = { theater_owner = 101 } set_variable = { theater_owner_coalition = 3 } }
			every_state = {
				limit = { has_variable = theater_owner }
				set_variable = { world_stage_power_deployed_by^120 = world_stage_power_deployed_by^103 }
				divide_variable = { world_stage_power_deployed_by^120 = 4 }
				round_variable = world_stage_power_deployed_by^120
				set_variable = { world_stage_power_deployed_by^103 = 0 }
			}
			103 = { set_variable = { world_stage_power = 0 } }
			every_possible_country = {									# this effect is convoluted but necessary in order to cut resources from KOB if France is defeated while KOB is annexed
				limit = { tag = KOB }
				if = {
					limit = { country_exists = KOB }
					news_event = { id = worldstage_surrender.103 hours = 24 random = 24 }
				} else = { clr_country_flag = tc_kobe_has_access }
			}
		}
	}

	option = {
		name = worldstage_automatic.103.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	KOB = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis_good
	}
	option = {
		name = worldstage_automatic.103.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	KOB = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		custom_effect_tooltip = metropolis_scope_vichy
		if = {
			limit = { has_global_flag = GER_SOV_pact_enabled }
			custom_effect_tooltip = join_coalition_axis_good
		} else = {
			custom_effect_tooltip = join_coalition_axis
		}
	}
	option = {
		name = worldstage_automatic.103.kob
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			tag = KOB
		}
		add_war_support = -0.1
		effect_tooltip = {
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis_bad
	}
	option = {
		name = worldstage_automatic.103.allies
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			NOT = { tag = KOB }
		}
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		hidden_effect = { add_war_support = -0.05 }
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis_bad
	}
	option = {
		name = worldstage_automatic.103.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			if = { limit = { country_exists = KOB }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = KOB } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } } add_war_support = -0.05 }
		}
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis
	}
}

# Moscow is taken, Soviet Union falls
news_event = {
	id = worldstage_automatic.104
	title = worldstage_automatic.104.t
	desc = worldstage_automatic.104.d 
	picture = GFX_news_ww2_sovietunion_capitulades_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			104 = { set_state_flag = metropolis_capitulated }
			every_state = {
				limit = { check_variable = { theater_owner = 104 } }
				set_variable = { theater_owner_coalition = 3 }
				world_stage_end_round_partial = yes
				clr_state_flag = theater_is_active
			}
			every_state = {
				limit = { has_variable = theater_owner }
				divide_variable = { world_stage_power_deployed_by^104 = 4 }
				round_variable = world_stage_power_deployed_by^104
			}
			104 = { set_variable = { world_stage_power = 0 } }
			every_possible_country = {									# this effect is convoluted but necessary in order to cut resources from FER if SovietUnion is defeated while FER is annexed
				limit = { tag = FER }
				if = {
					limit = { country_exists = FER }
					news_event = { id = worldstage_surrender.104 hours = 24 random = 24 }
				} else = { clr_country_flag = tc_yawatahama_has_access }
			}
		}
	}

	option = {
		name = worldstage_automatic.102.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			if = { limit = { country_exists = FER }	FER = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = FER } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			if = { limit = { country_exists = FER }	FER = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = FER } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.fer
		trigger = { tag = FER }
		add_war_support = -0.1
		effect_tooltip = {
			every_country = { limit = { NOT = { tag = FER } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.allies
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			NOT = { tag = FER }
		}
		effect_tooltip = {
			if = { limit = { country_exists = FER }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = FER } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
		hidden_effect = { add_war_support = -0.05 }
	}
	option = {
		name = worldstage_automatic.102.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			if = { limit = { country_exists = FER }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = FER } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
}

# no "Washington is taken, USA falls" event... yet?

# Beijing is taken, China falls
news_event = {
	id = worldstage_automatic.106
	title = worldstage_automatic.106.t
	desc = worldstage_automatic.106.d 
	picture = GFX_news_ww2_china_capitulades_wide

	is_triggered_only = yes

	major = yes
	
	immediate = {
		hidden_effect = {
			101 = { set_temp_variable = { occupier_coalition = theater_owner_coalition } }# figure out if Beijing was taken by Allies, Axis or Comintern
			106 = { set_state_flag = metropolis_capitulated }
			every_state = {
				limit = { check_variable = { theater_owner = 106 } }
				set_variable = { theater_owner_coalition = metropolis_capitulated }
				world_stage_end_round_partial = yes
				clr_state_flag = theater_is_active
			}
			every_state = {
				limit = { has_variable = theater_owner }
				divide_variable = { world_stage_power_deployed_by^106 = 4 }
				round_variable = world_stage_power_deployed_by^106
			}
			106 = { set_variable = { world_stage_power = 0 } }
			every_possible_country = {									# this effect is convoluted but necessary in order to cut resources from ROC if China is defeated while ROC is annexed
				limit = { tag = ROC }
				if = {
					limit = { country_exists = ROC }
					news_event = { id = worldstage_surrender.106 hours = 24 random = 24 }
				} else = { clr_country_flag = tc_fengtian_has_access }
			}
		}
	}

	option = {
		name = worldstage_automatic.102.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			if = { limit = { country_exists = ROC }	ROC = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = ROC } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			if = { limit = { country_exists = ROC }	ROC = { add_war_support = -0.1 } }
			every_country = { limit = { NOT = { tag = ROC } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.roc
		trigger = { tag = ROC }
		add_war_support = -0.1
		effect_tooltip = {
			every_country = { limit = { NOT = { tag = ROC } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
	option = {
		name = worldstage_automatic.102.allies
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } }
			NOT = { tag = ROC }
		}
		effect_tooltip = {
			if = { limit = { country_exists = ROC }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = ROC } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
		hidden_effect = { add_war_support = -0.05 }
	}
	option = {
		name = worldstage_automatic.102.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			if = { limit = { country_exists = ROC }	add_war_support = -0.1 }
			every_country = { limit = { NOT = { tag = ROC } var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } } add_war_support = -0.05 }
		}
	}
}

########################################################################
########################## worldstage_surrender ########################
########################################################################

# these events are for Western Exclaves or China, when deciding whether or not to capitulate or fight

# GERMANY SURRENDERS
country_event = {
	id = worldstage_surrender.101
	title = worldstage_surrender.101.t
	desc = worldstage_surrender.101.d 
	picture = GFX_news_ww2_germany_capitulates

	is_triggered_only = yes

	major = no	# this is REI-only
	
	immediate = { hidden_effect = { 101 = { set_state_flag = metropolis_capitulated clr_state_flag = worldstage_AI_active } every_possible_country = { limit = { tag = REI } set_cosmetic_tag = REI_AOZ } } }	#AOZ Allied Occupied Zone
	
	option = {
		name = worldstage_surrender.101.a	# fight, prefered human option
		trigger = { is_subject = no }		# puppets don't get to decide
		every_possible_country = {
			limit = { tag = REI }
			custom_effect_tooltip = lose_access_to_trade_resources_yawatahama
			clr_country_flag = tc_yawatahama_has_access
		}
		hidden_effect = {
			if = {
				limit = { country_exists = REI }
				country_event = worldstage_surrender.1011
			}
			every_character = {
				limit = { can_be_country_leader = yes }
				dual_leader_clear_secondary_leader = yes
				#if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
				#if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
				#if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
				#if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
				#if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
				#if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
			}
		}
		ai_chance = { base = 0 } log = "GERMANY SURRENDERS, option: worldstage_surrender.101.a	# fight, prefered human option"
	}
}

# ENGLAND SURRENDERS
country_event = {
	id = worldstage_surrender.102
	title = worldstage_surrender.102.t
	desc = worldstage_surrender.102.d 
	picture = GFX_news_ww2_england_capitulates

	is_triggered_only = yes

	major = no	# this is OSA-only
	
	immediate = { hidden_effect = { 102 = { set_state_flag = metropolis_capitulated clr_state_flag = worldstage_AI_active } every_possible_country = { limit = { tag = OSA } set_cosmetic_tag = OSA_EXL } } }	# EXL: Exiled
	
	option = {
		name = worldstage_surrender.102.a	# fight, prefered human option
		trigger = { is_subject = no }		# puppets don't get to decide
		every_possible_country = {
			limit = { tag = OSA }
			custom_effect_tooltip = lose_access_to_trade_resources_osaka
			clr_country_flag = tc_osaka_has_access
		}
		hidden_effect = {
			if = {
				limit = { country_exists = OSA }
				country_event = worldstage_surrender.1021
			}
			every_character = {
				limit = { can_be_country_leader = yes }
				dual_leader_clear_secondary_leader = yes
				if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
				if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
				if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
				if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
				if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
				if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
			}
		}
		ai_chance = { base = 0 } log = "ENGLAND SURRENDERS, option: worldstage_surrender.102.a	# fight, prefered human option"
	}
	option = {
		name = worldstage_surrender.102.b	# surrender, prefered AI option
		trigger = { is_subject = no }		# puppets don't get to decide
		hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }			# the faction here SHOULD be the Allies. Let's hope for the best
		every_possible_country = {
			limit = { tag = REI }
			set_temp_variable = { new_ideology = current_party_ideology_group }
		}
		every_possible_country = {
			limit = { tag = OSA }
			set_politics = {
				ruling_party = var:new_ideology?neutrality
				elections_allowed = no
				last_election = "1939.09.1"
				election_frequency = 48
			}
		}
		hidden_effect = {
			if = {
				limit = { country_exists = OSA }
				country_event = worldstage_surrender.1022
				add_ai_strategy = {
					type = alliance
					id = REI
					value = 50
				}
				every_other_country = {
					limit = { has_country_flag = is_not_japan }
					OSA = {
						add_ai_strategy = {
							type = alliance
							id = PREV
							value = -100
						}
					}
				}
				every_character = {
					limit = { can_be_country_leader = yes }
					dual_leader_clear_secondary_leader = yes
					if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
					if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
					if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
				}
			}	
		}
		if = {
			limit = { country_exists = OSA }
			random_country = {
				limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } is_faction_leader = yes }
				white_peace = {
					tag = OSA
					message = worldstage_surrender.102.whitepeace
				}
				add_to_faction = OSA
			}
			set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
		}
		ai_chance = { base = 100 } log = "ENGLAND SURRENDERS, option: worldstage_surrender.102.b	# surrender, prefered AI option"
	}
	option = {
		name = worldstage_surrender.102.c
		trigger = { is_subject = yes }		# puppets don't get to decide
		if = {
			limit = { OVERLORD = { OR = { has_government = fascism has_government = neutrality has_government = autocracy } } }
			every_possible_country = {
				limit = { tag = OSA }
				custom_effect_tooltip = lose_access_to_trade_resources_osaka
				clr_country_flag = tc_osaka_has_access
			}
			hidden_effect = {
				if = {
					limit = { country_exists = OSA }
					country_event = worldstage_surrender.1021
				}
				every_character = {
					limit = { can_be_country_leader = yes }
					dual_leader_clear_secondary_leader = yes
					if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
					if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
					if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
				}
			}
		} else = {
			hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }			# the faction here SHOULD be the Allies. Let's hope for the best
			every_possible_country = {
				limit = { tag = REI }
				set_temp_variable = { new_ideology = current_party_ideology_group }
			}
			every_possible_country = {
				limit = { tag = OSA }
				set_politics = {
					ruling_party = var:new_ideology?neutrality
					elections_allowed = no
					last_election = "1939.09.1"
					election_frequency = 48
					#long_name = TAG_party_long
					#name = TAG_party
				}
			}
			hidden_effect = {
				if = {
					limit = { country_exists = OSA }
					country_event = worldstage_surrender.1022
					add_ai_strategy = {
						type = alliance
						id = REI
						value = 50
					}
					every_other_country = {
						limit = { has_country_flag = is_not_japan }
						OSA = {
							add_ai_strategy = {
								type = alliance
								id = PREV
								value = -100
							}
						}
					}
					every_character = {
						limit = { can_be_country_leader = yes }
						dual_leader_clear_secondary_leader = yes
						if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
						if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
						if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_bernard_montgomery set_character_flag = dual_leader_second_title_prime_minister_exile }
						if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
						if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
						if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_franz_von_papen set_character_flag = dual_leader_second_title_reichskomissar }
					}
				}	
			}
			if = {
				limit = { country_exists = OSA }
				random_country = {
					limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } is_faction_leader = yes }
					white_peace = {
						tag = OSA
						message = worldstage_surrender.102.whitepeace
					}
					add_to_faction = OSA
				}
				set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
			}
		}
		ai_chance = { base = 999 } log = "ENGLAND SURRENDERS, option: worldstage_surrender.102.c # puppets don't get to decide"
	}
}

# OSAKA RESISTS
country_event = {
	id = worldstage_surrender.1021
	title = worldstage_surrender.1021.t
	desc = worldstage_surrender.1021.d 
	picture = GFX_news_ww2_montgomery

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1021.osa
		trigger = { tag = OSA }
	}
	option = {
		name = worldstage_surrender.1021.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } NOT = { tag = OSA } }
	}
	option = {
		name = worldstage_surrender.1221.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
	}
	option = {
		name = worldstage_surrender.1021.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
	}
	option = {
		name = worldstage_surrender.1021.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
	}
}

# OSAKA SURRENDERS
country_event = {
	id = worldstage_surrender.1022
	title = worldstage_surrender.1022.t
	desc = worldstage_surrender.1022.d 
	picture = GFX_news_ww2_von_papen

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1022.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
	}
	option = {
		name = worldstage_surrender.1022.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
	}
	option = {
		name = worldstage_surrender.1022.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } NOT = { tag = OSA } }
	}
	option = {
		name = worldstage_surrender.1022.osa
		trigger = { tag = OSA }
	}
	option = {
		name = worldstage_surrender.1022.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
	}
}

# FRANCE SURRENDERS # imagine my shock!
country_event = {
	id = worldstage_surrender.103
	title = worldstage_surrender.103.t
	desc = worldstage_surrender.103.d 
	picture = GFX_news_ww2_france_capitulates

	is_triggered_only = yes

	major = no	# this is KOB-only

	immediate = {
		hidden_effect = {
			103 = { set_state_flag = metropolis_capitulated clr_state_flag = worldstage_AI_active } every_possible_country = { limit = { tag = KOB } set_cosmetic_tag = KOB_FVF }	#FVF Free/Vichy France	# set_global_flag = world_stage_france_capitulated
			every_character = {
				limit = { can_be_country_leader = yes }
				dual_leader_clear_secondary_leader = yes
				if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_charles_de_gaulle set_character_flag = dual_leader_second_title_chief_of_provisional_government }
				if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_charles_de_gaulle set_character_flag = dual_leader_second_title_chief_of_provisional_government }
				if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_charles_de_gaulle set_character_flag = dual_leader_second_title_chief_of_provisional_government }
				if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_philippe_petain set_character_flag = dual_leader_second_title_prime_minister }
				if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_philippe_petain set_character_flag = dual_leader_second_title_prime_minister }
				if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_philippe_petain set_character_flag = dual_leader_second_title_prime_minister }
				# chancing AI behaviour
				103 = { set_variable = { ai_prefers_retreat = 1 } }	# no more running from now on!
				103 = { set_variable = { ai_save_strength = 5 } }	# default
			}
		}
	}
	
	option = {
		name = worldstage_surrender.103.a	# fight, prefered human option
		trigger = { is_subject = no }		# puppets don't get to decide
		every_possible_country = {
			limit = { tag = KOB }
			custom_effect_tooltip = lose_access_to_trade_resources_kobe
			clr_country_flag = tc_kobe_has_access
		}
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis
		hidden_effect = {
			if = {
				limit = { country_exists = KOB }
				country_event = worldstage_surrender.1031
			}
		}
		if = {
			limit = { has_global_flag = eastereggs_enabled }	#	has_game_rule = { rule = allow_easteregg_characters option = EASTERGG_ALLOWED }
			KOB_louis_renault = {	# Casablanca
				add_country_leader_role = {
					promote_leader = yes
					country_leader = {
						ideology = despotism
						expire = "1965.1.1.1"
						traits = { corrupt_policeman }
					}
				}
				set_character_flag = dual_leader_first_title_police_chief
				set_character_flag = dual_leader_id_philippe_petain
				set_character_flag = dual_leader_second_title_prime_minister
			}
		}
		ai_chance = { base = 0 } log = "FRANCE SURRENDERS, imagine my shock! option: worldstage_surrender.103.a	# fight, prefered human option"
	}
	option = {
		name = worldstage_surrender.103.b	# surrender, prefered AI option
		trigger = { is_subject = no }		# puppets don't get to decide
		hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }			# the faction here SHOULD be the Allies. Let's hope for the best
		every_possible_country = {
			limit = { tag = REI }
			set_temp_variable = { new_ideology = current_party_ideology_group }
		}
		every_possible_country = {
			limit = { tag = KOB }
			set_politics = {
				ruling_party = var:new_ideology?neutrality
				elections_allowed = no
				last_election = "1939.09.1"
				election_frequency = 48
			}
			set_variable = { world_stage_metropolis = 120 }	# Vichy France
			add_ideas = SS_restricted_foreign_policy
		}
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis
		hidden_effect = {
			if = {
				limit = { country_exists = KOB }
				country_event = worldstage_surrender.1032
				if = {
					limit = { country_exists = AXS }
					add_ai_strategy = {
						type = alliance
						id = AXS
						value = 100
					}
				}
				every_other_country = {
					limit = { has_country_flag = is_not_japan }
					KOB = {
						add_ai_strategy = {
							type = alliance
							id = PREV
							value = -100
						}
					}
				}
			}
		}
		if = {
			limit = { has_global_flag = eastereggs_enabled }	#	has_game_rule = { rule = allow_easteregg_characters option = EASTERGG_ALLOWED }
			KOB_louis_renault = {	# Casablanca
				add_country_leader_role = {
					promote_leader = yes
					country_leader = {
						ideology = despotism
						expire = "1965.1.1.1"
						traits = { corrupt_policeman }
					}
				}
				set_character_flag = dual_leader_first_title_police_chief
				set_character_flag = dual_leader_id_philippe_petain
				set_character_flag = dual_leader_second_title_prime_minister
			}
		}		
		if = {
			limit = { country_exists = KOB }
			#random_country = {
			#	limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } is_faction_leader = yes }
			#	white_peace = {
			#		tag = KOB
			#		message = worldstage_surrender.103.whitepeace
			#	}
			#	add_to_faction = KOB
			#}
			if = {
				limit = { country_exists = AXS AXS = { has_war_with = KOB} }	# they SHOULD be at war but I'll throw a check anyway as a failsafe (and coding is free)
				AXS = {
					white_peace = {
						tag = KOB
						message = worldstage_surrender.103.whitepeace
					}
				}
			}
			world_stage_join_axis = yes
			set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
		}
		ai_chance = { base = 100 } log = "FRANCE SURRENDERS, imagine my shock! option: worldstage_surrender.103.b	# surrender, prefered AI option"
	}
	option = {
		name = worldstage_surrender.103.c
		trigger = { is_subject = yes }		# puppets don't get to decide
		if = {
			limit = { OVERLORD = { OR = { has_government = fascism has_government = neutrality has_government = autocracy } } }
			hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }			# the faction here SHOULD be the Allies. Let's hope for the best
			every_possible_country = {
				limit = { tag = REI }
				set_temp_variable = { new_ideology = current_party_ideology_group }
			}
			every_possible_country = {
				limit = { tag = KOB }
				set_politics = {
					ruling_party = var:new_ideology?neutrality
					elections_allowed = no
					last_election = "1939.09.1"
					election_frequency = 48
					#long_name = TAG_party_long
					#name = TAG_party
				}
				set_variable = { world_stage_metropolis = 120 }	# Vichy France
				add_ideas = SS_restricted_foreign_policy
			}
			if = {
				limit = { country_exists = KOB }
				#random_country = {
				#	limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } is_faction_leader = yes }
				#	white_peace = {
				#		tag = KOB
				#		message = worldstage_surrender.103.whitepeace
				#	}
				#	add_to_faction = KOB
				#}
				if = {
					limit = { country_exists = AXS AXS = { has_war_with = KOB} }	# they SHOULD be at war but I'll throw a check anyway as a failsafe (and coding is free)
					AXS = {
						white_peace = {
							tag = KOB
							message = worldstage_surrender.103.whitepeace
						}
					}
				}
				world_stage_join_axis = yes
				set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
			}
			hidden_effect = {
				if = {
					limit = { country_exists = KOB }
					country_event = worldstage_surrender.1032
				}
				if = {
					limit = { country_exists = AXS }
					add_ai_strategy = {
						type = alliance
						id = AXS
						value = 100
					}
				}
				every_other_country = {
					limit = { has_country_flag = is_not_japan }
					KOB = {
						add_ai_strategy = {
							type = alliance
							id = PREV
							value = -100
						}
					}
				}
			}
		} else = {
			every_possible_country = {
			limit = { tag = KOB }
				custom_effect_tooltip = lose_access_to_trade_resources_kobe
				clr_country_flag = tc_kobe_has_access
			}
			hidden_effect = {
				if = {
					limit = { country_exists = KOB }
					country_event = worldstage_surrender.1031
				}	
			}
		}
		custom_effect_tooltip = metropolis_scope_vichy
		custom_effect_tooltip = join_coalition_axis
		if = {
			limit = { has_global_flag = eastereggs_enabled }	#	has_game_rule = { rule = allow_easteregg_characters option = EASTERGG_ALLOWED }
			KOB_louis_renault = {	# Casablanca
				add_country_leader_role = {
					promote_leader = yes
					country_leader = {
						ideology = despotism
						expire = "1965.1.1.1"
						traits = { corrupt_policeman }
					}
				}
				set_character_flag = dual_leader_first_title_police_chief
				set_character_flag = dual_leader_id_philippe_petain
				set_character_flag = dual_leader_second_title_prime_minister
			}
		}
		ai_chance = { base = 999 } log = "FRANCE SURRENDERS, imagine my shock! option: worldstage_surrender.103.c # puppets don't get to decide"
	}
}

# KOBE IS FREE FRANCE
country_event = {
	id = worldstage_surrender.1031
	title = worldstage_surrender.1031.t
	desc = worldstage_surrender.1031.d 
	picture = GFX_news_ww2_chad_de_gaulle

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1031.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } NOT = { tag = KOB } }
	}
	option = {
		name = worldstage_surrender.1031.kob
		trigger = { tag = KOB }
	}
	option = {
		name = worldstage_surrender.1031.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
	}
	option = {
		name = worldstage_surrender.1031.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
	}
	option = {
		name = worldstage_surrender.1031.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
	}
}

# KOBE IS VICHY FRANCE
country_event = {
	id = worldstage_surrender.1032
	title = worldstage_surrender.1032.t
	desc = worldstage_surrender.1032.d 
	picture = GFX_news_ww2_virgin_petain

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1032.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
	}
	option = {
		name = worldstage_surrender.1032.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
	}
	option = {
		name = worldstage_surrender.1032.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } NOT = { tag = KOB } }
	}
	option = {
		name = worldstage_surrender.1032.kob
		trigger = { tag = KOB }
	}
	option = {
		name = worldstage_surrender.1032.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
	}
}

# SOVIET UNION SURRENDERS
country_event = {
	id = worldstage_surrender.104
	title = worldstage_surrender.104.t
	desc = {
		text = worldstage_surrender.104.d1
		trigger = { NOT = { 106 = { check_variable = { world_stage_coalition = 3 } } } }
	}
	desc = {
		text = worldstage_surrender.104.d2
		trigger = { 106 = { check_variable = { world_stage_coalition = 3 } } }	# the difference of loosing to Axis with or without China in it is that if China is Axis, then they puppet FER instead of REI
	}
	picture = GFX_news_ww2_sovietunion_capitulades

	is_triggered_only = yes

	major = no	# this is FER-only
	
	immediate = { 104 = { set_state_flag = metropolis_capitulated clr_state_flag = worldstage_AI_active } }	# set_global_flag = world_stage_sovietunion_capitulated	# Cosmetic tag is applied later

	option = {
		name = worldstage_surrender.104.a	# fight, prefered human option
		trigger = { is_subject = no }		# puppets don't get to decide
		every_possible_country = {
			limit = { tag = FER }
			custom_effect_tooltip = lose_access_to_trade_resources_khabarovsky
			clr_country_flag = tc_khabarovsky_has_access
		}
		hidden_effect = {
			if = {
				limit = { country_exists = FER }
				country_event = worldstage_surrender.1041
			}	
		}
		every_character = {
			limit = { can_be_country_leader = yes }
			dual_leader_clear_secondary_leader = yes
			if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_nobody set_character_flag = dual_leader_second_title_none }
			if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_mikhail_kalinin set_character_flag = dual_leader_second_title_general_secretary }
			if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_nezhek_iecifovich set_character_flag = dual_leader_second_title_chancellor }
			if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_mikhail_kalinin set_character_flag = dual_leader_second_title_general_secretary }
			if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_kuritsa_vasilievich set_character_flag = dual_leader_second_title_minister_of_interior }
			if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_pyotr_krilof set_character_flag = dual_leader_second_title_minister_of_interior }
			FER_terenty_shtykov = { clr_character_flag = dual_leader_first_title_governor set_character_flag = dual_leader_first_title_president }
			FER_nezhek_iecifovich = { clr_character_flag = dual_leader_first_title_governor set_character_flag = dual_leader_first_title_president }
		}
		ai_chance = { base = 0 } log = "SOVIET UNION SURRENDERS option: worldstage_surrender.104.a	# fight, prefered human option"
	}
	option = {
		name = worldstage_surrender.104.b	# surrender, prefered AI option
		trigger = { is_subject = no }		# puppets don't get to decide
		hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }	# the faction here SHOULD be the Allies or Comintern. Let's hope for the best
		if = {
			limit = { country_exists = FER }
			random_country = {
				limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } is_faction_leader = yes }
				white_peace = {
					tag = FER
					message = worldstage_surrender.104.whitepeace
				}
				add_to_faction = FER
			}
			set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
		}
		if = {
			limit = { 106 = { check_variable = { world_stage_coalition = 3 } } }			# surrender to ROC
			every_possible_country = {
				limit = { tag = ROC }
				set_temp_variable = { new_ideology = current_party_ideology_group }
			}
			every_possible_country = {
				limit = { tag = FER }
				set_politics = {
					ruling_party = var:new_ideology?neutrality
					elections_allowed = no
					last_election = "1939.09.1"
					election_frequency = 48
					#long_name = TAG_party_long
					#name = TAG_party
				}
				add_ideas = SS_restricted_foreign_policy
				if = {
					limit = { check_variable = { new_ideology = neutrality } }
					add_country_leader_role = {	character = FER_feng_guozhang promote_leader = yes country_leader = { ideology = despotism expire = "1965.1.1.1" } }
				}
				if = {
					limit = { check_variable = { new_ideology = fascism } }
					add_country_leader_role = {	character = FER_feng_guozhang promote_leader = yes country_leader = { ideology = fascism_ideology expire = "1965.1.1.1" } }
				}
				if = {
					limit = { check_variable = { new_ideology = autocracy } }
					add_country_leader_role = {	character = FER_feng_guozhang promote_leader = yes country_leader = { ideology = autocracy_subtype expire = "1965.1.1.1" } }
				}
			}
			hidden_effect = {
				if = {
					limit = { country_exists = FER }
					country_event = worldstage_surrender.1042
					add_ai_strategy = {
						type = alliance
						id = REI
						value = 50
					}
					add_ai_strategy = {
						type = alliance
						id = ROC
						value = 50
					}
					every_other_country = {
						limit = { has_country_flag = is_not_japan NOT = { tag = ROC } }
						FER = {
							add_ai_strategy = {
								type = alliance
								id = PREV
								value = -100
							}
						}
					}
				}	
			}
			if = {
				limit = { country_exists = ROC country_exists = FER }
				ROC = { puppet = FER }
			}
			set_cosmetic_tag = FER_CHINA
		} else = {	#	- - - - - - - - - - - - - - - - - - - - - - - - - - - - - -	# surrenders to REI instead
			every_possible_country = {
				limit = { tag = REI }
				set_temp_variable = { new_ideology = current_party_ideology_group }
			}
			every_possible_country = {
				limit = { tag = FER }
				set_politics = {
					ruling_party = var:new_ideology?neutrality
					elections_allowed = no
					last_election = "1939.09.1"
					election_frequency = 48
					#long_name = TAG_party_long
					#name = TAG_party
				}
				add_ideas = SS_restricted_foreign_policy
				if = {
					limit = { check_variable = { new_ideology = neutrality } }
					add_country_leader_role = {	character = FER_ferdinand_von_bredow promote_leader = yes country_leader = { ideology = despotism expire = "1965.1.1.1" } }
				}
				if = {
					limit = { check_variable = { new_ideology = fascism } }
					add_country_leader_role = {	character = FER_ferdinand_von_bredow promote_leader = yes country_leader = { ideology = fascism_ideology expire = "1965.1.1.1" } }
				}
				if = {
					limit = { check_variable = { new_ideology = autocracy } }
					add_country_leader_role = {	character = FER_ferdinand_von_bredow promote_leader = yes country_leader = { ideology = autocracy_subtype expire = "1965.1.1.1" } }
				}
			}
			hidden_effect = {
				if = {
					limit = { country_exists = FER }
					country_event = worldstage_surrender.1043
					add_ai_strategy = {
						type = alliance
						id = REI
						value = 50
					}
					every_other_country = {
						limit = { has_country_flag = is_not_japan }
						FER = {
							add_ai_strategy = {
								type = alliance
								id = PREV
								value = -100
							}
						}
					}
				}	
			}
			if = {
				limit = { country_exists = REI country_exists = FER }
				REI = { puppet = FER }
			}
			set_cosmetic_tag = FER_REICH
		}
		hidden_effect = {
			104 = { set_variable = { world_stage_coalition = 3 } }
		}
		ai_chance = { base = 100 } log = "SOVIET UNION SURRENDERS option: worldstage_surrender.104.b	# surrender, prefered AI option"
	}
	option = {
		name = worldstage_surrender.104.c
		trigger = { is_subject = yes }		# puppets don't get to decide
		if = {
			limit = { OVERLORD = { OR = { has_government = fascism has_government = neutrality has_government = autocracy } } }
			hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }			# the faction here SHOULD be the Allies or Comintern. Let's hope for the best
			if = {
				limit = { country_exists = FER }
				random_country = {
					limit = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } is_faction_leader = yes }
					white_peace = {
						tag = FER
						message = worldstage_surrender.104.whitepeace
					}
					add_to_faction = FER
				}
				set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
			}
		}
		if = {
			limit = { 106 = { check_variable = { world_stage_coalition = 3 } } }			# surrender to ROC
			every_possible_country = {
				limit = { tag = ROC }
				set_temp_variable = { new_ideology = current_party_ideology_group }
			}
			every_possible_country = {
				limit = { tag = FER }
				set_politics = {
					ruling_party = var:new_ideology?neutrality
					elections_allowed = no
					last_election = "1939.09.1"
					election_frequency = 48
					#long_name = TAG_party_long
					#name = TAG_party
				}
				add_ideas = SS_restricted_foreign_policy
				if = {
					limit = { check_variable = { new_ideology = neutrality } }
					add_country_leader_role = {	character = FER_feng_guozhang promote_leader = yes country_leader = { ideology = despotism expire = "1965.1.1.1" } }
				}
				if = {
					limit = { check_variable = { new_ideology = fascism } }
					add_country_leader_role = {	character = FER_feng_guozhang promote_leader = yes country_leader = { ideology = fascism_ideology expire = "1965.1.1.1" } }
				}
				if = {
					limit = { check_variable = { new_ideology = autocracy } }
					add_country_leader_role = {	character = FER_feng_guozhang promote_leader = yes country_leader = { ideology = autocracy_subtype expire = "1965.1.1.1" } }
				}
			}
			hidden_effect = {
				if = {
					limit = { country_exists = FER }
					country_event = worldstage_surrender.1042
					add_ai_strategy = {
						type = alliance
						id = REI
						value = 50
					}
					add_ai_strategy = {
						type = alliance
						id = ROC
						value = 50
					}
					every_other_country = {
						limit = { has_country_flag = is_not_japan NOT = { tag = ROC } }
						FER = {
							add_ai_strategy = {
								type = alliance
								id = PREV
								value = -100
							}
						}
					}
				}	
			}
			if = {
				limit = { country_exists = ROC country_exists = FER }
				ROC = { puppet = FER }
			}
			set_cosmetic_tag = FER_CHINA
		} else = {	#	- - - - - - - - - - - - - - - - - - - - - - - - - - - - - -	# surrenders to REI instead
			every_possible_country = {
				limit = { tag = REI }
				set_temp_variable = { new_ideology = current_party_ideology_group }
			}
			every_possible_country = {
				limit = { tag = FER }
				set_politics = {
					ruling_party = var:new_ideology?neutrality
					elections_allowed = no
					last_election = "1939.09.1"
					election_frequency = 48
					#long_name = TAG_party_long
					#name = TAG_party
				}
				add_ideas = SS_restricted_foreign_policy
				if = {
					limit = { check_variable = { new_ideology = neutrality } }
					add_country_leader_role = {	character = FER_ferdinand_von_bredow promote_leader = yes country_leader = { ideology = despotism expire = "1965.1.1.1" } }
				}
				if = {
					limit = { check_variable = { new_ideology = fascism } }
					add_country_leader_role = {	character = FER_ferdinand_von_bredow promote_leader = yes country_leader = { ideology = fascism_ideology expire = "1965.1.1.1" } }
				}
				if = {
					limit = { check_variable = { new_ideology = autocracy } }
					add_country_leader_role = {	character = FER_ferdinand_von_bredow promote_leader = yes country_leader = { ideology = autocracy_subtype expire = "1965.1.1.1" } }
				}
			}
			hidden_effect = {
				if = {
					limit = { country_exists = FER }
					country_event = worldstage_surrender.1043
					add_ai_strategy = {
						type = alliance
						id = REI
						value = 50
					}
					every_other_country = {
						limit = { has_country_flag = is_not_japan }
						FER = {
							add_ai_strategy = {
								type = alliance
								id = PREV
								value = -100
							}
						}
					}
				}	
			}
			if = {
				limit = { country_exists = REI country_exists = FER }
				REI = { puppet = FER }
				set_cosmetic_tag = FER_REICH
				hidden_effect = {
					104 = { set_variable = { world_stage_coalition = 3 } }
				}
			} else = {
				every_possible_country = {
					limit = { tag = FER }
					custom_effect_tooltip = lose_access_to_trade_resources_khabarovsky
					clr_country_flag = tc_khabarovsky_has_access
				}
				hidden_effect = {
					if = {
						limit = { country_exists = FER }
						country_event = worldstage_surrender.1041
					}	
				}
				every_character = {
					limit = { can_be_country_leader = yes }
					dual_leader_clear_secondary_leader = yes
					if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_nobody set_character_flag = dual_leader_second_title_none }
					if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_mikhail_kalinin set_character_flag = dual_leader_second_title_general_secretary }
					if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_nezhek_iecifovich set_character_flag = dual_leader_second_title_chancellor }
					if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_mikhail_kalinin set_character_flag = dual_leader_second_title_general_secretary }
					if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_kuritsa_vasilievich set_character_flag = dual_leader_second_title_minister_of_interior }
					if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_pyotr_krilof set_character_flag = dual_leader_second_title_minister_of_interior }
					FER_terenty_shtykov = { clr_character_flag = dual_leader_first_title_governor set_character_flag = dual_leader_first_title_president }
					FER_nezhek_iecifovich = { clr_character_flag = dual_leader_first_title_governor set_character_flag = dual_leader_first_title_president }
				}
			}
		}
		ai_chance = { base = 999 } log = "SOVIET UNION SURRENDERS option: worldstage_surrender.104.c"	# puppets don't get to decide
	}
}

# FAR EASTERN REPUBLIC IS INDEPENDENT
country_event = {
	id = worldstage_surrender.1041
	title = worldstage_surrender.1041.t
	desc = worldstage_surrender.1041.d 
	picture = GFX_news_ww2_fer_resists

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1041.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } NOT = { tag = FER } }
	}
	option = {
		name = worldstage_surrender.1041.fer
		trigger = { tag = FER }
	}
	option = {
		name = worldstage_surrender.1041.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
	}
	option = {
		name = worldstage_surrender.1041.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
	}
	option = {
		name = worldstage_surrender.1041.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
	}
}

# FAR EASTERN REPUBLIC IS PUPPETED SIBERIA
country_event = {
	id = worldstage_surrender.1042
	title = worldstage_surrender.1042.t
	desc = worldstage_surrender.1042.d 
	picture = GFX_news_ww2_fer_surrenders

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1042.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
	}
	option = {
		name = worldstage_surrender.1042.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
	}
	option = {
		name = worldstage_surrender.1042.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } NOT = { tag = FER } }
	}
	option = {
		name = worldstage_surrender.1042.fer
		trigger = { tag = FER }
	}
	option = {
		name = worldstage_surrender.1042.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
	}
}

# CHINA SURRENDERS!
country_event = {
	id = worldstage_surrender.106
	title = worldstage_surrender.106.t
	desc = {
		text = worldstage_surrender.106.d1
		trigger = { 19 = { OR = { check_variable = { theather_owner_coalition = 2 } check_variable = { main_attacker_metropolis = 104 } var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 2 } } } } }
	}
	desc = {
		text = worldstage_surrender.106.d2
		trigger = {
			19 = { NOT = { check_variable = { theather_owner_coalition = 2 } check_variable = { main_attacker_metropolis = 104 } var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 2 } } } }
			19 = { NOT = { check_variable = { theather_owner_coalition = 3 } var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 3 } } } }
		}
	}
	desc = {
		text = worldstage_surrender.106.d3
		trigger = { 19 = { OR = { check_variable = { theather_owner_coalition = 3 } var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 3 } } } } }
	}
	picture = GFX_news_ww2_china_capitulates

	is_triggered_only = yes

	major = no	# this is ROC-only

	immediate = {
		hidden_effect = {
			106 = {
				set_state_flag = metropolis_capitulated clr_state_flag = worldstage_AI_active # ROC only changes tag if it recgnizes the occupation government
			}
			if = {
				limit = { 19 = { OR = { check_variable = { theather_owner_coalition = 2 } check_variable = { main_attacker_metropolis = 104 } var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 2 } } } } }	# lost to Soviets
				set_global_flag = china_left_is_rng	# left: communist/democratic-socialism // rng: reorganized national government
				if = {
					limit = { has_global_flag = sovietunion_joined_ww2 }	# Soviets are Allies
					set_global_flag = china_center_is_rng	# center: democratic/neutrality // rng: reorganized national government
				}
			} else_if = {		# lost to NOT-Axis (and no soviets, therefore Allies/Rio Treaty)
				limit = { 19 = { NOT = { check_variable = { theather_owner_coalition = 3 } var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 3 } } } } }
				set_global_flag = china_center_is_rng	# center: democratic/neutrality // rng: reorganized national government
				if = {
					limit = { has_global_flag = sovietunion_joined_ww2 }	# Soviets are Allies
					set_global_flag = china_left_is_rng	# left: communist/democratic-socialism // rng: reorganized national government
				}
			} else = {	# Lost to Axis
				set_global_flag = china_right_is_rng	# center: fascism/autocracy // rng: reorganized national government
			}
		}
	}
	
	option = {
		name = worldstage_surrender.106.a	# fight, prefered human option
		trigger = {
			is_subject = no		# puppets don't get to decide
			19 = { NOT = { check_variable = { theather_owner_coalition = 2 } check_variable = { main_attacker_metropolis = 104  var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 2 } } } } }	# China did not loose to Soviets
		}
		every_possible_country = {
			limit = { tag = ROC }
			custom_effect_tooltip = lose_access_to_trade_resources_fengtian
			clr_country_flag = tc_fengtian_has_access
			if = {
				limit = { has_government = fascism }
				ROC_wu_peifu = {
					add_country_leader_role = {
						promote_leader = yes
						country_leader = {
							ideology = fascism_type
							expire = "1965.1.1.1"
							traits = { ROC_jade_marshal }
						}
					}
				}
			} else = {
				if = {
					limit = { has_government = neutrality }
					ROC_wu_peifu = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = fascism_type
								expire = "1965.1.1.1"
								traits = { ROC_jade_marshal }
							}
						}
					}
				} else = { hidden_effect = { ROC_wu_peifu = { add_country_leader_role = { promote_leader = yes country_leader = { ideology = fascism_type  expire = "1965.1.1.1" traits = { ROC_jade_marshal } } } } } }
			}
		}
		if = {
			limit = { country_exists = ROC }
			hidden_effect = { country_event = worldstage_surrender.1061 }
		}
		ai_chance = { base = 0 } log = "CHINA SURRENDER! option: worldstage_surrender.106.a	# fight, prefered human option"
	}
	option = {
		name = worldstage_surrender.106.a	# fight, prefered human option
		trigger = {
			is_subject = no		# puppets don't get to decide
			19 = { OR = { check_variable = { theather_owner_coalition = 2 } check_variable = { main_attacker_metropolis = 104 } var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 2 } } } }	# China lost to Soviets
		}
		every_possible_country = {
			limit = { tag = ROC }
			custom_effect_tooltip = lose_access_to_trade_resources_fengtian
			clr_country_flag = tc_fengtian_has_access
			if = {
				limit = { has_government = fascism }
				ROC_wu_peifu = {
					add_country_leader_role = {
						promote_leader = yes
						country_leader = {
							ideology = fascism_type
							expire = "1965.1.1.1"
							traits = { ROC_jade_marshal }
						}
					}
				}
			} else = {
				if = {
					limit = { has_government = neutrality }
					ROC_wu_peifu = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = fascism_type
								expire = "1965.1.1.1"
								traits = { ROC_jade_marshal }
							}
						}
					}
				} else = { hidden_effect = { ROC_wu_peifu = { add_country_leader_role = { promote_leader = yes country_leader = { ideology = fascism_type  expire = "1965.1.1.1" traits = { ROC_jade_marshal } } } } } }
			}
		}
		if = {
			limit = { country_exists = ROC }
			hidden_effect = { country_event = worldstage_surrender.1061 }
		}
		ai_chance = { base = 0 } log = "CHINA SURRENDER! option: worldstage_surrender.106.a	# fight, prefered human option"
	}
	option = {
		name = worldstage_surrender.106.b	# surrender, preferred AI option
		trigger = { 19 = { NOT = { check_variable = { theather_owner_coalition = 2 } check_variable = { main_attacker_metropolis = 104 } var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 2 } } } } }	# China did not loose to Soviets (so it was Allies)
		every_character = {
			limit = { can_be_country_leader = yes }
			dual_leader_clear_secondary_leader = yes
			if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_mao_zedong set_character_flag = dual_leader_second_title_president }
			if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_mao_zedong set_character_flag = dual_leader_second_title_president }
			if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_chiang_kai_shek set_character_flag = dual_leader_second_title_president }
			if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_chiang_kai_shek set_character_flag = dual_leader_second_title_president }
			if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_aishinkakura_hiro set_character_flag = dual_leader_second_title_empress }
			if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_wang_jingwei set_character_flag = dual_leader_second_title_president }
		}
		hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }			# the faction here SHOULD be the Axis. Let's hope for the best
		ALY = {
			set_temp_variable = { new_ideology = current_party_ideology_group }
		}
		every_possible_country = {
			limit = { tag = ROC }
			set_politics = {
				ruling_party = var:new_ideology?democratic
				elections_allowed = no
				last_election = "1939.09.1"
				election_frequency = 48
			}
			set_cosmetic_tag = ROC_RNG	# Reorganized National Government
			add_ideas = SS_restricted_foreign_policy
			hidden_character = { promote_character = ROC_prince_pujie }
		}
		hidden_effect = {
			if = {
				limit = { country_exists = ROC }
				country_event = worldstage_surrender.1062
				add_ai_strategy = {
					type = alliance
					id = ALY
					value = 50
				}
				every_other_country = {
					limit = { has_country_flag = is_not_japan }
					ROC = {
						add_ai_strategy = {
							type = alliance
							id = PREV
							value = -100
						}
					}
				}
			}
		}	
		if = {
			limit = { country_exists = ROC country_exists = ALY }
			ALY = {
				white_peace = {
					tag = ROC
					message = worldstage_surrender.106.whitepeace
				}
				add_to_faction = ROC
			}
			set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
		}
		ai_chance = { base = 100 } log = "CHINA SURRENDER! option: worldstage_surrender.106.a	# surrender, preferred AI option
	}
	option = {
		name = worldstage_surrender.106.b	# surrender, preferred AI option
		trigger = { 19 = { OR = { check_variable = { theather_owner_coalition = 2 } check_variable = { main_attacker_metropolis = 104 } var:main_attacker_metropolis = { check_variable = {  world_stage_coalition = 2 } } } } }	# China lost to Soviets
		every_character = {
			limit = { can_be_country_leader = yes }
			dual_leader_clear_secondary_leader = yes
			if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_mao_zedong set_character_flag = dual_leader_second_title_president }
			if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_mao_zedong set_character_flag = dual_leader_second_title_president }
			if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_chiang_kai_shek set_character_flag = dual_leader_second_title_president }
			if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_chiang_kai_shek set_character_flag = dual_leader_second_title_president }
			if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_aishinkakura_hiro set_character_flag = dual_leader_second_title_empress }
			if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_wang_jingwei set_character_flag = dual_leader_second_title_president }
		}
		hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }			# the faction here SHOULD be the Axis. Let's hope for the best
		COM = {
			set_temp_variable = { new_ideology = current_party_ideology_group }
		}
		every_possible_country = {
			limit = { tag = ROC }
			set_politics = {
				ruling_party = var:new_ideology?communism
				elections_allowed = no
				last_election = "1939.09.1"
				election_frequency = 48
			}
			set_cosmetic_tag = ROC_RNG	# Reorganized National Government
			add_ideas = SS_restricted_foreign_policy
			hidden_character = { promote_character = ROC_prince_pujie }
		}
		hidden_effect = {
			if = {
				limit = { country_exists = ROC }
				country_event = worldstage_surrender.1062
				add_ai_strategy = {
					type = alliance
					id = COM
					value = 50
				}
				every_other_country = {
					limit = { has_country_flag = is_not_japan }
					ROC = {
						add_ai_strategy = {
							type = alliance
							id = PREV
							value = -100
						}
					}
				}
			}
		}	
		if = {
			limit = { country_exists = ROC country_exists = COM }
			COM = {
				white_peace = {
					tag = ROC
					message = worldstage_surrender.106.whitepeace
				}
				add_to_faction = ROC
			}
			set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
		}
		ai_chance = { base = 100 } log = "CHINA SURRENDER! option: worldstage_surrender.106.a	# surrender, preferred AI option
	}
}

# MANCHURIA REFUSES TO SURRENDER
country_event = {
	id = worldstage_surrender.1061
	title = worldstage_surrender.1061.t
	desc = worldstage_surrender.1061.d 
	picture = [ROOT.GetChineseLeadersPicture]

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1061.roc
		trigger = { tag = ROC }
	}
	option = {
		name = worldstage_surrender.1061.friend
		trigger = { is_in_faction_with = ROC NOT = { tag = ROC } }
	}
	option = {
		name = worldstage_surrender.1061.enemy
		trigger = { has_war_with = ROC NOT = { tag = ROC } }
	}
	option = {
		name = worldstage_surrender.1061.other
		trigger = { NOT = { is_in_faction_with = ROC has_war_with = ROC TAG = ROC } }
	}
}

# MANCHURIA ACCEPTS REORGANIZED GOVERNMENT
country_event = {
	id = worldstage_surrender.1062
	title = worldstage_surrender.1062.t
	desc = worldstage_surrender.1062.d 
	picture = [ROOT.GetChineseLeadersPicture]

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1062.roc
		trigger = { tag = ROC }
	}
	option = {
		name = worldstage_surrender.1062.friend
		trigger = { is_in_faction_with = ROC NOT = { tag = ROC } }
	}
	option = {
		name = worldstage_surrender.1062.enemy
		trigger = { has_war_with = ROC NOT = { tag = ROC } }
	}
	option = {
		name = worldstage_surrender.1062.other
		trigger = { NOT = { is_in_faction_with = ROC has_war_with = ROC TAG = ROC } }
	}
}

# NETHERLANDS SURRENDER
country_event = {
	id = worldstage_surrender.107
	title = worldstage_surrender.107.t
	desc = {
		text = worldstage_surrender.107.d_axis
		trigger = { 107 = { check_variable = { world_stage_coalition = 3 } } }
	}
	desc = {
		text = worldstage_surrender.107.d_allies1
		trigger = { 107 = { check_variable = { world_stage_coalition = 1 } } has_country_flag = will_join_allies }
	}
	desc = {
		text = worldstage_surrender.107.d_allies2	# default, no trigger needed
	}
	picture = GFX_news_ww2_netherlands_capitulates

	is_triggered_only = yes

	major = no	# this is HIR-only

	immediate = {
		hidden_effect = {
			# first thing is to figure out on which side HIR is, which is given by who is conquering the country	# cosmetic tag: AON: Axis-Opposing Netherlands and ALN: Axis-Algined Netherlands, flags are the same but the names change
			107 = { set_state_flag = metropolis_capitulated clr_state_flag = worldstage_AI_active }
			worldstage_get_HIR_leaders_before_capitulation = yes
			if = {
				limit = { 27 = { check_variable = { theater_owner_coalition = 3 } } }	# Netherlands conquered by Axis
				every_possible_country = { limit = { tag = HIR } set_cosmetic_tag = HIR_AON }	# Axis-Opposing Netherlands
				every_character = {
					limit = { can_be_country_leader = yes }
					dual_leader_clear_secondary_leader = yes
					if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_hendrikus_colijn set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_hendrikus_colijn set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_hendrikus_colijn set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_nobody set_character_flag = dual_leader_second_title_none }
					if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_anton_mussert set_character_flag = dual_leader_second_title_reichskomissar }
					if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_anton_mussert set_character_flag = dual_leader_second_title_reichskomissar }
				}
			} else_if = {
				limit = { 27 = { check_variable = { theater_owner_coalition = 2 } } }	# Netherlands conquered by Comintern
				every_possible_country = { limit = { tag = HIR } set_cosmetic_tag = HIR_ALN }	# Axis-Aligned Netherlands
				every_character = {
					limit = { can_be_country_leader = yes }
					dual_leader_clear_secondary_leader = yes
					if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_louis_beel set_character_flag = dual_leader_second_title_president }
					if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_louis_beel set_character_flag = dual_leader_second_title_president }
					if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_louis_beel set_character_flag = dual_leader_second_title_president }
					if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_nobody set_character_flag = dual_leader_second_title_none }
					if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_anton_mussert set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_anton_mussert set_character_flag = dual_leader_second_title_prime_minister_exile }
				}
			} else = {	# Netherlands conquered by Allies, TIAR or someone else
				every_possible_country = { limit = { tag = HIR } set_cosmetic_tag = HIR_AON }
				every_character = {
					limit = { can_be_country_leader = yes }
					dual_leader_clear_secondary_leader = yes
					if = { limit = { has_ideology_group = communism } set_character_flag = dual_leader_id_hendrikus_colijn set_character_flag = dual_leader_second_title_prime_minister }
					if = { limit = { has_ideology_group = democratic } set_character_flag = dual_leader_id_hendrikus_colijn set_character_flag = dual_leader_second_title_prime_minister }
					if = { limit = { has_ideology_group = democratic_socialism } set_character_flag = dual_leader_id_hendrikus_colijn set_character_flag = dual_leader_second_title_prime_minister }
					if = { limit = { has_ideology_group = autocracy } set_character_flag = dual_leader_id_nobody set_character_flag = dual_leader_second_title_none }
					if = { limit = { has_ideology_group = fascism } set_character_flag = dual_leader_id_anton_mussert set_character_flag = dual_leader_second_title_prime_minister_exile }
					if = { limit = { has_ideology_group = neutrality } set_character_flag = dual_leader_id_anton_mussert set_character_flag = dual_leader_second_title_prime_minister_exile }
				}
			}
		}
	}
	
	option = {
		name = worldstage_surrender.107.a_axis	# fight, prefered human option
		trigger = {
			NOT = {
				27 = { check_variable = { theater_owner_coalition = 2 } }	# Netherlands was conquered by Allies or TIAR
				27 = { check_variable = { theater_owner_coalition = 3 } }
			}
			is_subject = no													# puppets don't get to decide
		}
		every_possible_country = {
			limit = { tag = HIR }
			custom_effect_tooltip = lose_access_to_trade_resources_hirado
			clr_country_flag = tc_hirado_has_access
		}
		hidden_effect = {
			if = {
				limit = { country_exists = HIR }
				country_event = worldstage_surrender.1071
			}
		}
		ai_chance = { base = 0 } log = "NETHERLANDS SURRENDER! option: worldstage_surrender.107.a	# fight, prefered human option"
	}
	option = {
		name = worldstage_surrender.107.a_axis	# fight, prefered human option
		trigger = {
			27 = { check_variable = { theater_owner_coalition = 2 } }	# Netherlands was conquered by Comintern	# I'm not sure it needs a separated option, I'll keep it here just in case...
			is_subject = no												# puppets don't get to decide
		}
		every_possible_country = {
			limit = { tag = HIR }
			custom_effect_tooltip = lose_access_to_trade_resources_hirado
			clr_country_flag = tc_hirado_has_access
		}
		hidden_effect = {
			if = {
				limit = { country_exists = HIR }
				country_event = worldstage_surrender.1071
			}
		}
		ai_chance = { base = 0 } log = "NETHERLANDS SURRENDER! option: worldstage_surrender.107.a	# fight, prefered human option"
	}
	option = {
		name = worldstage_surrender.107.b_axis	# surrender, prefered AI option
		trigger = {
			NOT = {
				27 = { check_variable = { theater_owner_coalition = 2 } }	# Netherlands was conquered by Allies or TIAR
				27 = { check_variable = { theater_owner_coalition = 3 } }
			}
			is_subject = no													# puppets don't get to decide
		}
		hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }			# the faction here SHOULD be the Allies. Let's hope for the best
		ALY = {
			set_temp_variable = { new_ideology = current_party_ideology_group }
		}
		every_possible_country = {
			limit = { tag = HIR }
			set_politics = {
				ruling_party = var:new_ideology?democratic
				elections_allowed = no
				last_election = "1939.09.1"
				election_frequency = 48
			}
			add_ideas = SS_restricted_foreign_policy
		}
		hidden_effect = {
			if = {
				limit = { country_exists = HIR }
				country_event = worldstage_surrender.1072
				add_ai_strategy = {
					type = alliance
					id = ALY
					value = 50
				}
				every_other_country = {
					limit = { has_country_flag = is_not_japan }
					HIR = {
						add_ai_strategy = {
							type = alliance
							id = PREV
							value = -100
						}
					}
				}
			}
		}	
		if = {
			limit = { country_exists = HIR country_exists = ALY }
			ALY = {
				white_peace = {
					tag = HIR
					message = worldstage_surrender.107.whitepeace
				}
				add_to_faction = HIR
			}
			set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
		}
		ai_chance = { base = 100 } log = "NETHERLANDS SURRENDER, option: worldstage_surrender.107.b	# surrender, prefered AI option"
	}
	option = {
		name = worldstage_surrender.107.b_axis	# surrender, prefered AI option
		trigger = {
			27 = { check_variable = { theater_owner_coalition = 2 } }		# Netherlands was conquered by Comintern
			is_subject = no													# puppets don't get to decide
		}
		hidden_effect = { if = { limit = { is_in_faction = yes } leave_faction = yes } }			# the faction here SHOULD be the Allies. Let's hope for the best
		COM = {
			set_temp_variable = { new_ideology = current_party_ideology_group }
		}
		every_possible_country = {
			limit = { tag = HIR }
			set_politics = {
				ruling_party = var:new_ideology?communism
				elections_allowed = no
				last_election = "1939.09.1"
				election_frequency = 48
			}
			add_ideas = SS_restricted_foreign_policy
		}
		hidden_effect = {
			if = {
				limit = { country_exists = HIR }
				country_event = worldstage_surrender.1072
				add_ai_strategy = {
					type = alliance
					id = COM
					value = 50
				}
				every_other_country = {
					limit = { has_country_flag = is_not_japan }
					HIR = {
						add_ai_strategy = {
							type = alliance
							id = PREV
							value = -100
						}
					}
				}
			}
		}	
		if = {
			limit = { country_exists = HIR country_exists = COM }
			COM = {
				white_peace = {
					tag = HIR
					message = worldstage_surrender.107.whitepeace
				}
				add_to_faction = HIR
			}
			set_country_flag = lost_original_focus_tree load_focus_tree = generic_focus
		}
		ai_chance = { base = 100 } log = "NETHERLANDS SURRENDER, option: worldstage_surrender.107.b	# surrender, prefered AI option"
	}
}

# HIRADO DOES NOT SURRENDER
country_event = {
	id = worldstage_surrender.1071
	title = worldstage_surrender.1071.t
	desc = {
		text = worldstage_surrender.1071.d1
		trigger = { NOT = { HIR = { has_government = autocracy } } }
	}
	desc = {
		text = worldstage_surrender.1071.d2
		trigger = { HIR = { has_government = autocracy } }
	}
	picture = [ROOT.GetDutchLeadersPicture]

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1071.hir
		trigger = { tag = HIR }
	}
	option = {
		name = worldstage_surrender.1071.friend
		trigger = { is_in_faction_with = HIR NOT = { tag = HIR } }
	}
	option = {
		name = worldstage_surrender.1071.enemy
		trigger = { has_war_with = HIR NOT = { tag = HIR } }
	}
	option = {
		name = worldstage_surrender.1071.other
		trigger = { NOT = { is_in_faction_with = HIR has_war_with = HIR TAG = HIR } }
	}
}

# HIRADO SURRENDERS
country_event = {
	id = worldstage_surrender.1072
	title = worldstage_surrender.1072.t
	desc = {
		text = worldstage_surrender.1072.d1
		trigger = { NOT = { HIR = { has_government = autocracy } } }
	}
	desc = {
		text = worldstage_surrender.1072.d2
		trigger = { HIR = { has_government = autocracy } }
	}
	picture = [ROOT.GetDutchPuppetPicture]

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage_surrender.1072.hir
		trigger = { tag = HIR }
	}
	option = {
		name = worldstage_surrender.1072.friend
		trigger = { is_in_faction_with = HIR NOT = { tag = HIR } }
	}
	option = {
		name = worldstage_surrender.1072.enemy
		trigger = { has_war_with = HIR NOT = { tag = HIR } }
	}
	option = {
		name = worldstage_surrender.1072.other
		trigger = { NOT = { is_in_faction_with = HIR has_war_with = HIR TAG = HIR } }
	}
}

#########################
######################### THE ONES BELLOW MAY BE DEPRICATED
#########################
#########################
#########################

### MONGOLIA MEDDLING
# ROC completes 'ROC_aid_mongolia'
news_event = {
	id = worldstage.1
	title = worldstage.1.t
	desc = worldstage.1.d 
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes
	
	option = {
		name = worldstage.1.axis
		trigger = {
			OR = { tag = ROC has_government = fascism }
		}
	}
	option = {
		name = worldstage.1.komin
		trigger = {
			OR = { tag = FER has_government = communism }
		}
	}
	option = {
		name = worldstage.1.other
		trigger = {
			NOT = {
				has_government = fascism
				has_government = communism
				tag = ROC
				tag = FER
			}
		}
	}
}

### SPANISH CIVIL War

# Spanish Civil War - Italian Help
news_event = {
	id = worldstage.5
	title = worldstage.5.t
	desc = worldstage.5.d 
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	#immediate = {
	#	add_to_variable = { global.FAL_strength_spain_bonus = 5 }
	#}
	
	option = {
		name = worldstage.5.axis
		trigger = {
			has_government = fascism
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.FAL_strength_spain_bonus = 5
				# tooltip = world_stage_add_help_fal_power
			# }
		# }
	}
	option = {
		name = worldstage.5.komin
		trigger = {
			has_government = communism
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.FAL_strength_spain_bonus = 5
				# tooltip = world_stage_add_help_fal_power
			# }
		# }
	}
	option = {
		name = worldstage.5.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.FAL_strength_spain_bonus = 5
				# tooltip = world_stage_add_help_fal_power
			# }
		# }
	}
}

# Spanish Civil War - International Brigades
news_event = {
	id = worldstage.6
	title = worldstage.6.t
	desc = worldstage.6.d 
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	# immediate = {
		# add_to_variable = { global.REP_strength_spain_bonus = 5 }
	# }
	
	option = {
		name = worldstage.6.axis
		trigger = {
			has_government = fascism
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.FAL_strength_spain = 5
				# tooltip = world_stage_add_help_rep_power
			# }
		# }
	}
	option = {
		name = worldstage.6.komin
		trigger = {
			has_government = communism
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.FAL_strength_spain = 5
				# tooltip = world_stage_add_help_rep_power
			# }
		# }
	}
	option = {
		name = worldstage.6.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.FAL_strength_spain = 5
				# tooltip = world_stage_add_help_rep_power
			# }
		# }
	}
}

# Spanish Civil War - German Assistance
news_event = {
	id = worldstage.7
	title = worldstage.7.t
	desc = worldstage.7.d 
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	# immediate: none, effect handled by focus
	
	option = {
		name = worldstage.7.axis
		trigger = {
			has_government = fascism
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.FAL_strength_spain_bonus = 10
				# tooltip = world_stage_add_help_fal_power
			# }
		# }
	}
	option = {
		name = worldstage.7.komin
		trigger = {
			has_government = communism
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.FAL_strength_spain_bonus = 10
				# tooltip = world_stage_add_help_fal_power
			# }
		# }
	}
	option = {
		name = worldstage.7.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.FAL_strength_spain_bonus = 10
				# tooltip = world_stage_add_help_fal_power
			# }
		# }
	}
}

# Spanish Civil War - Republican Desertion
news_event = {
	id = worldstage.8
	title = worldstage.8.t
	desc = worldstage.8.d 
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	# immediate = {
		# add_to_variable = { global.FAL_strength_spain = 1 }
		# add_to_variable = { global.REP_strength_spain = -1 }
	# }
	
	option = {
		name = worldstage.8.axis
		trigger = {
			has_government = fascism
		}
		# effect_tooltip = {
			# custom_effect_tooltip = country_name_falange
			# add_to_variable = {
				# global.FAL_strength_spain = 1
				# tooltip = world_stage_add_local_power
			# }
			# custom_effect_tooltip = country_name_republica
			# add_to_variable = {
				# global.REP_strength_spain = -1
				# tooltip = world_stage_add_local_power
			# }
		# }
	}
	option = {
		name = worldstage.8.komin
		trigger = {
			has_government = communism
		}
		# effect_tooltip = {
			# custom_effect_tooltip = country_name_falange
			# add_to_variable = {
				# global.FAL_strength_spain = 1
				# tooltip = world_stage_add_local_power
			# }
			# custom_effect_tooltip = country_name_republica
			# add_to_variable = {
				# global.REP_strength_spain = -1
				# tooltip = world_stage_add_local_power
			# }
		# }
	}
	option = {
		name = worldstage.8.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		# effect_tooltip = {
			# custom_effect_tooltip = country_name_falange
			# add_to_variable = {
				# global.FAL_strength_spain = 1
				# tooltip = world_stage_add_local_power
			# }
			# custom_effect_tooltip = country_name_republica
			# add_to_variable = {
				# global.REP_strength_spain = -1
				# tooltip = world_stage_add_local_power
			# }
		# }
	}
}

# Spanish Civil War - Republican Infighting 
news_event = {
	id = worldstage.9
	title = worldstage.9.t
	desc = worldstage.9.d 
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	# immediate = {
		# add_to_variable = { global.REP_strength_spain = -1 }
	# }
	
	option = {
		name = worldstage.9.axis
		trigger = {
			has_government = fascism
		}
		# effect_tooltip = {
			# custom_effect_tooltip = country_name_republica
			# add_to_variable = {
				# global.REP_strength_spain = -1
				# tooltip = world_stage_add_local_power
			# }
		# }
	}
	option = {
		name = worldstage.9.komin
		trigger = {
			has_government = communism
		}
		# effect_tooltip = {
			# custom_effect_tooltip = country_name_republica
			# add_to_variable = {
				# global.REP_strength_spain = -1
				# tooltip = world_stage_add_local_power
			# }
		# }
	}
	option = {
		name = worldstage.9.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		# effect_tooltip = {
			# custom_effect_tooltip = country_name_republica
			# add_to_variable = {
				# global.REP_strength_spain = -1
				# tooltip = world_stage_add_local_power
			# }
		# }
	}
}

# Spanish Civil War - Another Round
country_event = {
	id = worldstage.11
	title = worldstage.11.t
	desc = worldstage.11.d 
	picture = GFX_news_ww2_starts

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	option = {
		name = worldstage.11.axis
		trigger = {
			has_government = fascism
		}
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_falange }
			# army_experience = 5
		# }
	}
	option = {
		name = worldstage.11.komin
		trigger = {
			has_government = communism
		}
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_republica }
			# army_experience = 5
		# }
	}
	option = {
		name = worldstage.11.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_republica }
			# army_experience = 5
		# }
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_falange }
			# army_experience = 5
		# }
	}
}

# Spanish Civil War - Repblica Wins
country_event = {
	id = worldstage.13
	title = worldstage.13.t
	desc = worldstage.13.d 
	picture = GFX_news_ww2_starts

	is_triggered_only = yes

	major = yes
	
	immediate = { set_variable = { global.theater_owner_spain = 0 } }
	
	option = {
		name = worldstage.13.axis
		trigger = {
			has_government = fascism
		}
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_falange }	# maybe check a tag....
			# GETS EXILED FALANGIST GENERALS
		# }
	}
	option = {
		name = worldstage.13.komin
		trigger = {
			has_government = communism
		}
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_republica }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = air_doctrine
			# }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = land_doctrine
			# }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = naval_doctrine
			# }
		# }
	}
	option = {
		name = worldstage.13.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		# if = {
			# limit = { has_country_flag = world_stage_spanish_cw_helped_republica }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = air_doctrine
			# }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = land_doctrine
			# }
			# add_doctrine_cost_reduction = {
				# cost_reduction = 0.99
				# category = naval_doctrine
			# }
		# }
	}
}

# Spanish Civil War - Soviet Assistance
news_event = {
	id = worldstage.14
	title = worldstage.14.t
	desc = worldstage.14.d 
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	# immediate: none, effect handled by focus
	
	option = {
		name = worldstage.14.axis
		trigger = {
			has_government = fascism
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.REP_strength_spain_bonus = 10
				# tooltip = world_stage_add_help_rep_power
			# }
		# }
	}
	option = {
		name = worldstage.14.komin
		trigger = {
			has_government = communism
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.REP_strength_spain_bonus = 10
				# tooltip = world_stage_add_help_rep_power
			# }
		# }
	}
	option = {
		name = worldstage.14.other
		trigger = {
			NOT = {
				has_government = communism
				has_government = fascism
			}
		}
		# effect_tooltip = {
			# add_to_variable = {
				# global.REP_strength_spain_bonus = 10
				# tooltip = world_stage_add_help_rep_power
			# }
		# }
	}
}

# Invasion of Poland - Poland Resists		#### CURRENTLY NOT USED IN GAME
country_event = {
	id = worldstage.17
	title = worldstage.17.t
	desc = worldstage.17.d 
	picture = GFX_news_ww2_starts

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	immediate = { log = "THIS EVENT SHOULD NOT APPEAR!"	}
	
	option = {
		name = worldstage.17.axis1
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
			NOT = { has_global_flag = GER_SOV_pact_enabled }
		}
	}
	option = {
		name = worldstage.17.axis2
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } }
			has_global_flag = GER_SOV_pact_enabled
		}
	}
	option = {
		name = worldstage.17.komin1
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } }
			NOT = { has_global_flag = GER_SOV_pact_enabled }
		}
	}
	option = {
		name = worldstage.17.komin2
		trigger = {
			var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } }
			has_global_flag = GER_SOV_pact_enabled
		}
	}
	option = {
		name = worldstage.17.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
	}
	option = {
		name = worldstage.17.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
	}
}



# Invasion of Poland - The Emp... the French! Strike Back		#### CURRENTLY NOT USED IN GAME
country_event = {
	id = worldstage.20
	title = worldstage.20.t
	desc = worldstage.20.d 
	picture = GFX_news_ww2_starts

	is_triggered_only = yes
	
	immediate = { log = "THIS EVENT SHOULD NOT APPEAR!"	}

	option = {
		name = worldstage.20.a1				# Attack!
		custom_effect_tooltip = "not from devs: this event does not have effects"
	}
	option = {
		name = worldstage.20.a2				# Hold!
		custom_effect_tooltip = "not from devs: this event does not have effects"
	}
}


# Invasion of Norway! # Operation Weserbung
news_event = {
	id = worldstage.45
	title = worldstage.45.t
	desc = worldstage.45.d 
	picture = GFX_news_ww2_starts_wide

	is_triggered_only = yes

	major = yes show_major = { NOT = { has_country_flag = hide_worldstage_notification } }
	
	immediate = {
		set_variable = { global.theater_owner_norway = 1 }
	}
	
	option = {
		name = worldstage.45.axis
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 3 } } }
		effect_tooltip = {
			if = {
				limit = { NOT = { tag = REI } }
				custom_effect_tooltip = world_stage_theater_norway_is_active_tt
				custom_effect_tooltip = country_name_germany
				add_to_variable = {
					placeholder_var = 60
					tooltip = world_stage_deploy_power_norway
				}
				add_to_variable = {
					placeholder_var = 30
					tooltip = world_stage_bonus_power_norway
				}
			}
#			custom_effect_tooltip = country_name_france
#			add_to_variable = {
#				placeholder_var = 5
#				tooltip = world_stage_bonus_power_norway
#			}
#			custom_effect_tooltip = country_name_england
#			add_to_variable = {
#				placeholder_var = 5
#				tooltip = world_stage_bonus_power_norway
#			}
		}
	}
	option = {
		name = worldstage.45.komin
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 2 } } }
		effect_tooltip = {
			custom_effect_tooltip = world_stage_theater_norway_is_active_tt
			custom_effect_tooltip = country_name_germany
			add_to_variable = {
				placeholder_var = 60
				tooltip = world_stage_deploy_power_norway
			}
			add_to_variable = {
				placeholder_var = 30
				tooltip = world_stage_bonus_power_norway
			}
#			custom_effect_tooltip = country_name_france
#			add_to_variable = {
#				placeholder_var = 5
#				tooltip = world_stage_bonus_power_norway
#			}
#			custom_effect_tooltip = country_name_england
#			add_to_variable = {
#				placeholder_var = 5
#				tooltip = world_stage_bonus_power_norway
#			}
		}
	}
	option = {
		name = worldstage.45.allies
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 1 } } }
		effect_tooltip = {
			custom_effect_tooltip = world_stage_theater_norway_is_active_tt
			custom_effect_tooltip = country_name_germany
			add_to_variable = {
				placeholder_var = 60
				tooltip = world_stage_deploy_power_norway
			}
			add_to_variable = {
				placeholder_var = 30
				tooltip = world_stage_bonus_power_norway
			}
#			custom_effect_tooltip = country_name_france
#			add_to_variable = {
#				placeholder_var = 5
#				tooltip = world_stage_bonus_power_norway
#			}
#			custom_effect_tooltip = country_name_england
#			add_to_variable = {
#				placeholder_var = 5
#				tooltip = world_stage_bonus_power_norway
#			}
		}
	}
	option = {
		name = worldstage.45.other
		trigger = { var:world_stage_metropolis = { check_variable = { world_stage_coalition = 4 } } }
		effect_tooltip = {
			custom_effect_tooltip = world_stage_theater_norway_is_active_tt
			custom_effect_tooltip = country_name_germany
			add_to_variable = {
				placeholder_var = 60
				tooltip = world_stage_deploy_power_norway
			}
			add_to_variable = {
				placeholder_var = 30
				tooltip = world_stage_bonus_power_norway
			}
#			custom_effect_tooltip = country_name_france
#			add_to_variable = {
#				placeholder_var = 5
#				tooltip = world_stage_bonus_power_norway
#			}
#			custom_effect_tooltip = country_name_england
#			add_to_variable = {
#				placeholder_var = 5
#				tooltip = world_stage_bonus_power_norway
#			}
		}
	}
}